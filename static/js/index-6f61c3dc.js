var j=(b,_,l)=>new Promise((w,o)=>{var m=r=>{try{u(l.next(r))}catch(p){o(p)}},q=r=>{try{u(l.throw(r))}catch(p){o(p)}},u=r=>r.done?w(r.value):Promise.resolve(r.value).then(m,q);u((l=l.apply(b,_)).next())});import{d as F,$ as z,j as R,aT as B,J,a as s,o as A,D as P,w as t,b as e,n as H,e as c,t as v,u as a,h as G,bh as Z,O as K,a1 as W,bb as X,bz as Y,c as ee,bZ as E,bs as te,ae as O,bt as ae}from"./index-20fb0306.js";import{i as oe}from"./icon-cb727678.js";import{S as T}from"./SettingItem-11e342fe.js";import{S as I}from"./SettingItemBox-6e9bb9c5.js";import"./chartEditStore-eb4e0443.js";/* empty css                                                                      */import{u as L}from"./useTargetData.hook-5df848dd.js";import{R as ne,a as se}from"./pondIndex.vue_vue_type_style_index_0_scoped_bc18493e_lang-b0fac76f.js";import{u as le}from"./useSync.hook-b03903fa.js";import"./index-70c15a63.js";import"./EditorWorker-26637c3c.js";import"./editorWorker-43a98755.js";import"./chartLayoutStore-b4f2137a.js";import"./index-63f16b81.js";import{C as re}from"./index-210c33dd.js";import"./plugin-2033e7b2.js";import"./project.api-bcdd5979.js";import"./index-e3d67d15.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-561b5bfa.js";import"./chart-169a825c.js";import"./fileTypeEnum-21359a08.js";import"./file-84751f49.js";const ce={class:"go-pr-3"},ue=c("—— "),de=F({__name:"index",props:{modelShow:Boolean,targetData:Object,saveBtnText:String||null},emits:["update:modelShow","sendHandle"],setup(b,{emit:_}){const l=b,{targetData:w}=L(),{dataSyncUpdate:o}=le(),{chartConfig:m}=z(l.targetData),{requestContentType:q}=z(l.targetData.request),u=R(!1),r={[B.DEFAULT]:"普通请求",[B.SQL]:"SQL 请求"};J(()=>l.modelShow,i=>{u.value=i},{immediate:!0});const p=()=>{_("update:modelShow",!1),_("sendHandle"),o()};return(i,f)=>{const h=s("n-space"),S=s("n-scrollbar"),g=s("n-text"),U=s("n-tag"),x=s("n-button"),k=s("n-card"),d=s("n-modal");return A(),P(d,{class:"go-chart-data-request",show:u.value,"onUpdate:show":f[0]||(f[0]=n=>u.value=n),"mask-closable":!1,closeOnEsc:!1},{default:t(()=>[e(k,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(h,{justify:"space-between"},{default:t(()=>[H("div",null,[e(g,null,{default:t(()=>[c("「 "+v(a(m).categoryName)+" 」",1)]),_:1}),e(g,null,{default:t(()=>[ue]),_:1}),e(U,{type:"primary",bordered:!1,style:{"border-radius":"5px"}},{default:t(()=>[c(v(r[a(q)]),1)]),_:1})]),e(x,{type:"primary",onClick:p},{default:t(()=>[c(v(b.saveBtnText||"保存 & 发送请求"),1)]),_:1})]),_:1})]),default:t(()=>[e(S,{style:{"max-height":"718px"}},{default:t(()=>[H("div",ce,[e(h,{vertical:""},{default:t(()=>{var n;return[e(a(ne)),e(a(se),{"target-data-request":(n=a(w))==null?void 0:n.request},null,8,["target-data-request"])]}),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),ie=G(de,[["__scopeId","data-v-3ec3a7fe"]]),pe={class:"go-chart-configurations-data-ajax"},_e={class:"go-absolute-center"},me=c("编辑配置"),fe=c(" 测试 "),he=c(" 默认赋值给 dataset 字段 "),ge=c(" 发送请求 "),ve=F({__name:"index",setup(b){Z(d=>({"272613bc":a(k)}));const{HelpOutlineIcon:_,FlashIcon:l,PulseIcon:w}=oe.ionicons5,{targetData:o,chartEditStore:m}=L(),{requestOriginUrl:q,requestInterval:u,requestIntervalUnit:r}=z(m.getRequestGlobalConfig),p=K(),i=R(!1),f=R(!1),h=R(!1);let S=0,g;const U=()=>{f.value=!0},x=()=>j(this,null,function*(){var d;if((d=o.value)!=null&&d.request){i.value=!0;try{const n=yield te(O(o.value.request),O(m.getRequestGlobalConfig));if(i.value=!1,n){const{data:C}=n;if(!C&&!o.value.filter){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),h.value=!0;return}o.value.option.dataset=ae(C,n,o.value.filter),h.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(n){console.error(n),i.value=!1,window.$message.warning("数据异常，请检查参数！")}}}),k=W(()=>p.getAppTheme);return X(()=>{var n;const d=(n=o.value)==null?void 0:n.filter;g!==d&&S&&(g=d,x()),S++}),Y(()=>{g=null}),(d,n)=>{const C=s("n-tag"),y=s("n-input"),D=s("n-icon"),$=s("n-button"),N=s("n-card"),V=s("n-tooltip"),M=s("go-skeleton");return A(),ee("div",pe,[e(N,{class:"n-card-shallow"},{default:t(()=>[e(a(I),{name:"请求配置"},{default:t(()=>[e(a(T),{name:"类型"},{default:t(()=>[e(C,{bordered:!1,type:"primary",style:{"border-radius":"5px"}},{default:t(()=>[c(v(a(o).request.requestContentType===a(B).DEFAULT?"普通请求":"SQL请求"),1)]),_:1})]),_:1}),e(a(T),{name:"方式"},{default:t(()=>[e(y,{size:"small",placeholder:a(o).request.requestHttpType||"暂无",disabled:!0},null,8,["placeholder"])]),_:1}),e(a(T),{name:"组件间隔"},{default:t(()=>[e(y,{size:"small",placeholder:`${a(o).request.requestInterval||"暂无"}`,disabled:!0},{suffix:t(()=>[c(v(a(E)[a(o).request.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]),_:1}),e(a(T),{name:"全局间隔（默认）"},{default:t(()=>[e(y,{size:"small",placeholder:`${a(u)||"暂无"} `,disabled:!0},{suffix:t(()=>[c(v(a(E)[a(r)]),1)]),_:1},8,["placeholder"])]),_:1})]),_:1}),e(a(I),{name:"源地址",alone:!0},{default:t(()=>[e(y,{size:"small",placeholder:a(q)||"暂无",disabled:!0},{prefix:t(()=>[e(D,{component:a(w)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),e(a(I),{name:"组件地址",alone:!0},{default:t(()=>[e(y,{size:"small",placeholder:a(o).request.requestUrl||"暂无",disabled:!0},{prefix:t(()=>[e(D,{component:a(l)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),H("div",{class:"edit-text",onClick:U},[H("div",_e,[e($,{type:"primary",secondary:""},{default:t(()=>[me]),_:1})])])]),_:1}),e(a(I),{alone:!0},{name:t(()=>[fe,e(V,{trigger:"hover"},{trigger:t(()=>[e(D,{size:"21",depth:3},{default:t(()=>[e(a(_))]),_:1})]),default:t(()=>[he]),_:1})]),default:t(()=>[e($,{type:"primary",ghost:"",onClick:x},{icon:t(()=>[e(D,null,{default:t(()=>[e(a(l))]),_:1})]),default:t(()=>[ge]),_:1})]),_:1}),e(a(re),{show:h.value&&!i.value,ajax:!0},null,8,["show"]),e(M,{load:i.value,repeat:3},null,8,["load"]),e(a(ie),{modelShow:f.value,"onUpdate:modelShow":n[0]||(n[0]=Q=>f.value=Q),targetData:a(o),onSendHandle:x},null,8,["modelShow","targetData"])])}}});const Le=G(ve,[["__scopeId","data-v-688badbe"]]);export{Le as default};
