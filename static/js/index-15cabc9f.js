var d=(v,f,i)=>new Promise((S,u)=>{var g=a=>{try{n(i.next(a))}catch(c){u(c)}},r=a=>{try{n(i.throw(a))}catch(c){u(c)}},n=a=>a.done?S(a.value):Promise.resolve(a.value).then(g,r);n((i=i.apply(v,f)).next())});import{M as B}from"./EditorWorker-26637c3c.js";import"./editorWorker-43a98755.js";import{d as D,j as L,aK as w,aL as M,ao as R,aM as E,aN as j,aO as A,c as J,b as t,w as o,aH as F,a as s,o as y,n as H,u as m,D as O,a9 as x,e as p,h as K}from"./index-20fb0306.js";import{g as z}from"./storage-b3762883.js";import"./querySelectorAll-a1c431d2.js";import{g as b}from"./plugin-2033e7b2.js";import{i as G}from"./icon-cb727678.js";import{u as U}from"./useSync.hook-b03903fa.js";import{u as q,P as Q}from"./chartEditStore-eb4e0443.js";import"./project.api-bcdd5979.js";import"./chartLayoutStore-b4f2137a.js";import"./index-63f16b81.js";import"./SettingItem-11e342fe.js";/* empty css                                                                      */import"./SettingItemBox-6e9bb9c5.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-561b5bfa.js";import"./chart-169a825c.js";const W={class:"go-edit"},X=p("页面在线编辑器"),Y=p(" 导入 "),Z=p(" 「Ctrl + S 更新视图」 "),ee=p(" 保存 "),oe=D({__name:"index",setup(v){const f=q(),{dataSyncUpdate:i}=U(),{ChevronBackOutlineIcon:S,DownloadIcon:u,AnalyticsIcon:g}=G.ionicons5,r=window.showOpenFilePicker,n=L("");window.$message.warning("请不要刷新此窗口！");function a(){return d(this,null,function*(){const e=yield z();F(`编辑-${e.editCanvasConfig.projectName}`),n.value=E(e)})}setTimeout(a);function c(){b({message:"导入数据将覆盖内容，此操作不可撤回，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>d(this,null,function*(){try{const _=yield(yield r())[0].getFile(),l=new FileReader;l.readAsText(_),l.onloadend=()=>{n.value=(l.result||"").toString()},window.$message.success("导入成功！")}catch(e){window.$message.error("导入失败，请检查文件是否损坏！"),console.log(e)}})})}window.opener.addEventListener(w.CHART,e=>{window.$message.success("正在进行更新..."),M(R.GO_CHART_STORAGE_LIST,[e.detail]),n.value=E(e.detail)}),document.addEventListener("keydown",function(e){e.keyCode==83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),C())});function C(){return d(this,null,function*(){if(!window.opener)return window.$message.error("源窗口已关闭，视图同步失败！");b({message:"是否覆盖源视图内容? 此操作不可撤！",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>d(this,null,function*(){try{const e=j(n.value);delete e.id,i&&(f.setProjectInfo(Q.PROJECT_ID,A()),yield i()),window.opener.dispatchEvent(new CustomEvent(w.JSON,{detail:e})),window.$message.success("正在同步内容...")}catch(e){window.$message.error("内容格式有误"),console.log(e)}})})})}return window.onbeforeunload=()=>{window.opener&&window.opener.dispatchEvent(new CustomEvent(w.CLOSE))},(e,_)=>{const l=s("n-text"),h=s("n-icon"),k=s("n-button"),N=s("n-tag"),P=s("n-space"),I=s("n-layout-header"),T=s("n-layout-content"),$=s("n-layout");return y(),J("div",W,[t($,null,{default:o(()=>[t(I,{class:"go-edit-header go-px-5 go-flex-items-center",bordered:""},{default:o(()=>[H("div",null,[t(l,{class:"go-edit-title go-mr-4"},{default:o(()=>[X]),_:1}),m(r)?(y(),O(k,{key:0,class:"go-mr-3",size:"medium",onClick:c},{icon:o(()=>[t(h,null,{default:o(()=>[t(m(u))]),_:1})]),default:o(()=>[Y]),_:1})):x("",!0)]),t(P,null,{default:o(()=>[t(N,{bordered:!1,type:"warning"},{default:o(()=>[Z]),_:1}),m(r)?(y(),O(k,{key:0,class:"go-mr-3",size:"medium",onClick:C},{icon:o(()=>[t(h,null,{default:o(()=>[t(m(g))]),_:1})]),default:o(()=>[ee]),_:1})):x("",!0)]),_:1})]),_:1}),t(T,null,{default:o(()=>[t(m(B),{modelValue:n.value,"onUpdate:modelValue":_[0]||(_[0]=V=>n.value=V),language:"json",editorOptions:{lineNumbers:"on",minimap:{enabled:!0}}},null,8,["modelValue"])]),_:1})]),_:1})])}}});const Se=K(oe,[["__scopeId","data-v-55a05ce0"]]);export{Se as default};
