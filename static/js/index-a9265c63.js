var an=Object.defineProperty,rn=Object.defineProperties;var cn=Object.getOwnPropertyDescriptors;var Ce=Object.getOwnPropertySymbols;var ln=Object.prototype.hasOwnProperty,un=Object.prototype.propertyIsEnumerable;var we=(s,t,e)=>t in s?an(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,F=(s,t)=>{for(var e in t||(t={}))ln.call(t,e)&&we(s,e,t[e]);if(Ce)for(var e of Ce(t))un.call(t,e)&&we(s,e,t[e]);return s},Tt=(s,t)=>rn(s,cn(t));var ht=(s,t,e)=>new Promise((n,o)=>{var a=c=>{try{g(e.next(c))}catch(i){o(i)}},r=c=>{try{g(e.throw(c))}catch(i){o(i)}},g=c=>c.done?n(c.value):Promise.resolve(c.value).then(a,r);g((e=e.apply(s,t)).next())});import{n as ie,a1 as Ue,b0 as dn,ak as S,cB as Fe,cC as We,cD as Ee,bb as st,aX as Xt,cA as hn,aE as Zt,cE as q,al as xe,b3 as zt,c as _t,d as pt,b2 as Bt,m as Nt,a0 as A,o as b,e as at,f as ce,F as St,s as Mt,ag as vt,af as it,u as C,a3 as Yt,q as Y,aw as Be,E as Z,w as $,G as Et,aq as Qt,ar as $t,as as te,at as Ne,$ as Ye,p as le,am as Se,L as mt,Z as ue,l as z,cF as Te,z as de,A as he,g as G,r as dt,Q as Rt,R as At,an as Ge,I as fn,X as gn,h as Ht,M as qt,ch as Vt,aN as bt,aO as ke,B as Ke,J as Me,aB as It,aH as Xe,ba as Le,t as Dt,b7 as vn,cG as pn,bh as mn,x as _n,S as yn}from"./index-cc3f641a.js";import{u as fe,d as Cn}from"./index-f631d064.js";import{u as ct,E as ot,a as wn,C as En,e as xn}from"./chartEditStore-b2e1c320.js";import{d as ge,f as ze,c as qe,ai as Sn,aj as Tn}from"./index-1eac586a.js";import{a as Ve,b as ee,l as je,g as kn}from"./plugin-e0f5e76b.js";import{l as xt}from"./lodash-4f1239dc.js";import{C as Mn}from"./index-033d2110.js";import{u as Je,C as ne}from"./chartLayoutStore-095228af.js";import{c as be}from"./components-94986955.js";import{G as Ln}from"./index-ac17e1b4.js";import{i as Ze}from"./icon-8d2f24cd.js";import{F as De}from"./fileTypeEnum-21359a08.js";import{r as bn}from"./file-84751f49.js";import{u as Dn}from"./packagesStore-c5f10d2e.js";import{h as Qe}from"./http-f6bc01f2.js";import"./SettingItem-669cc95c.js";/* empty css                                                                   */import"./SettingItemBox-5419f377.js";import"./CollapseItem-31a86cf3.js";import"./index.esm.min-4eff5bcb.js";const kt=ct(),Pn=()=>{ie(()=>{kt.setEditCanvas(ot.EDIT_LAYOUT_DOM,document.getElementById("go-chart-edit-layout")),kt.setEditCanvas(ot.EDIT_CONTENT_DOM,document.getElementById("go-chart-edit-content"));const s=kt.listenerScale();Ue(()=>{kt.setEditCanvas(ot.EDIT_LAYOUT_DOM,null),kt.setEditCanvas(ot.EDIT_CONTENT_DOM,null),s()})})};var se={},On={get exports(){return se},set exports(s){se=s}};(function(s){(function(t){var e,n={},o={16:!1,18:!1,17:!1,91:!1},a="all",r={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},g={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},c=function(d){return g[d]||d.toUpperCase().charCodeAt(0)},i=[];for(e=1;e<20;e++)g["f"+e]=111+e;function l(d,_){for(var E=d.length;E--;)if(d[E]===_)return E;return-1}function u(d,_){if(d.length!=_.length)return!1;for(var E=0;E<d.length;E++)if(d[E]!==_[E])return!1;return!0}var h={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function v(d){for(e in o)o[e]=d[h[e]]}function f(d){var _,E,x,U,R,lt;if(_=d.keyCode,l(i,_)==-1&&i.push(_),(_==93||_==224)&&(_=91),_ in o){o[_]=!0;for(x in r)r[x]==_&&(w[x]=!0);return}if(v(d),!!w.filter.call(this,d)&&_ in n){for(lt=X(),U=0;U<n[_].length;U++)if(E=n[_][U],E.scope==lt||E.scope=="all"){R=E.mods.length>0;for(x in o)(!o[x]&&l(E.mods,+x)>-1||o[x]&&l(E.mods,+x)==-1)&&(R=!1);(E.mods.length==0&&!o[16]&&!o[18]&&!o[17]&&!o[91]||R)&&E.method(d,E)===!1&&(d.preventDefault?d.preventDefault():d.returnValue=!1,d.stopPropagation&&d.stopPropagation(),d.cancelBubble&&(d.cancelBubble=!0))}}}function p(d){var _=d.keyCode,E,x=l(i,_);if(x>=0&&i.splice(x,1),(_==93||_==224)&&(_=91),_ in o){o[_]=!1;for(E in r)r[E]==_&&(w[E]=!1)}}function y(){for(e in o)o[e]=!1;for(e in r)w[e]=!1}function w(d,_,E){var x,U;x=T(d),E===void 0&&(E=_,_="all");for(var R=0;R<x.length;R++)U=[],d=x[R].split("+"),d.length>1&&(U=Q(d),d=[d[d.length-1]]),d=d[0],d=c(d),d in n||(n[d]=[]),n[d].push({shortcut:x[R],scope:_,method:E,key:x[R],mods:U})}function M(d,_){var E,x,U=[],R,lt,D;for(E=T(d),lt=0;lt<E.length;lt++){if(x=E[lt].split("+"),x.length>1&&(U=Q(x),d=x[x.length-1]),d=c(d),_===void 0&&(_=X()),!n[d])return;for(R=0;R<n[d].length;R++)D=n[d][R],D.scope===_&&u(D.mods,U)&&(n[d][R]={})}}function W(d){return typeof d=="string"&&(d=c(d)),l(i,d)!=-1}function L(){return i.slice(0)}function I(d){var _=(d.target||d.srcElement).tagName;return!(_=="INPUT"||_=="SELECT"||_=="TEXTAREA")}for(e in r)w[e]=!1;function B(d){a=d||"all"}function X(){return a||"all"}function K(d){var _,E,x;for(_ in n)for(E=n[_],x=0;x<E.length;)E[x].scope===d?E.splice(x,1):x++}function T(d){var _;return d=d.replace(/\s/g,""),_=d.split(","),_[_.length-1]==""&&(_[_.length-2]+=","),_}function Q(d){for(var _=d.slice(0,d.length-1),E=0;E<_.length;E++)_[E]=r[_[E]];return _}function k(d,_,E){d.addEventListener?d.addEventListener(_,E,!1):d.attachEvent&&d.attachEvent("on"+_,function(){E(window.event)})}k(document,"keydown",function(d){f(d)}),k(document,"keyup",p),k(window,"focus",y);var P=t.key;function O(){var d=t.key;return t.key=P,d}t.key=w,t.key.setScope=B,t.key.getScope=X,t.key.deleteScope=K,t.key.filter=I,t.key.isPressed=W,t.key.getPressedKeyCodes=L,t.key.noConflict=O,t.key.unbind=M,s.exports=w})(dn)})(On);const tt=se,et=ct(),rt=s=>`${Fe.CTRL}+${s}`,Pt=s=>`${Fe.SHIFT}+${s}`,j={[S.ARROW_UP]:rt("up"),[S.ARROW_RIGHT]:rt("right"),[S.ARROW_DOWN]:rt("down"),[S.ARROW_LEFT]:rt("left"),[S.COPY]:rt("c"),[S.CUT]:rt("x"),[S.PARSE]:rt("v"),[S.DELETE]:"delete",[S.BACK]:rt("z"),[S.FORWORD]:rt(Pt("z")),[S.GROUP]:rt("g"),[S.UN_GROUP]:rt(Pt("g")),[S.LOCK]:rt("l"),[S.UNLOCK]:rt(Pt("l")),[S.HIDE]:rt("h"),[S.SHOW]:rt(Pt("h"))},nt=s=>`${We.CTRL}+${s}`,Ot=s=>`${We.SHIFT}+${s}`,J={[S.ARROW_UP]:nt("arrowup"),[S.ARROW_RIGHT]:nt("arrowright"),[S.ARROW_DOWN]:nt("arrowdown"),[S.ARROW_LEFT]:nt("arrowleft"),[S.COPY]:nt("c"),[S.CUT]:nt("x"),[S.PARSE]:nt("v"),[S.DELETE]:nt("backspace"),[S.BACK]:nt("z"),[S.FORWORD]:nt(Ot("z")),[S.GROUP]:nt("g"),[S.UN_GROUP]:nt(Ot("g")),[S.LOCK]:nt("l"),[S.UNLOCK]:nt(Ot("l")),[S.HIDE]:nt("h"),[S.SHOW]:nt(Ot("h"))},Rn=[j.up,j.right,j.down,j.left,j.delete,j.copy,j.cut,j.parse,j.back,j.forward,j.group,j.unGroup,j.lock,j.unLock,j.hide,j.show],An=[J.up,J.right,J.down,J.left,J.delete,J.copy,J.cut,J.parse,J.back,J.forward,J.group,J.unGroup,J.lock,J.unLock,J.hide,J.show],In=()=>{window.$KeyboardActive={ctrl:!1,space:!1},document.onkeydown=s=>{const{keyCode:t}=s;if(t==32&&s.target==document.body&&s.preventDefault(),[17,32].includes(t)&&window.$KeyboardActive)switch(Ee(s.keyCode),t){case 17:window.$KeyboardActive.ctrl=!0;break;case 32:window.$KeyboardActive.space=!0;break}},document.onkeyup=s=>{const{keyCode:t}=s;if(t==32&&s.target==document.body&&s.preventDefault(),[17,32].includes(t)&&window.$KeyboardActive)switch(Ee(),t){case 17:window.$KeyboardActive.ctrl=!1;break;case 32:window.$KeyboardActive.space=!1;break}}},$n=()=>{const t=(e,n)=>{switch(n){case e.up:tt(n,st(()=>(et.setMove(S.ARROW_UP),!1),50));break;case e.right:tt(n,st(()=>(et.setMove(S.ARROW_RIGHT),!1),50));break;case e.down:tt(n,st(()=>(et.setMove(S.ARROW_DOWN),!1),50));break;case e.left:tt(n,st(()=>(et.setMove(S.ARROW_LEFT),!1),50));break;case e.delete:tt(n,Xt(()=>(et.removeComponentList(),!1),50));break;case e.copy:tt(n,Xt(()=>(et.setCopy(),!1),50));break;case e.cut:tt(n,Xt(()=>(et.setCut(),!1),50));break;case e.parse:tt(n,st(()=>(et.setParse(),!1),50));break;case e.back:tt(n,st(()=>(et.setBack(),!1),50));break;case e.forward:tt(n,st(()=>(et.setForward(),!1),50));break;case e.group:tt(n,st(()=>(et.setGroup(),!1),50));break;case e.unGroup:tt(n,st(()=>(et.setUnGroup(),!1),50));break;case e.lock:tt(n,st(()=>(et.setLock(),!1),50));break;case e.unLock:tt(n,st(()=>(et.setUnLock(),!1),50));break;case e.hide:tt(n,st(()=>(et.setHide(),!1),50));break;case e.show:tt(n,st(()=>(et.setShow(),!1),50));break}};Rn.forEach(e=>{t(j,e)}),An.forEach(e=>{t(J,e)}),In()},m=ct(),{onClickOutSide:Pe}=fe(),Hn=s=>ht(void 0,null,function*(){s.preventDefault();try{Ve();const t=s.dataTransfer.getData(hn.DRAG_KEY);if(!t){ee();return}m.setEditCanvas(ot.IS_CREATE,!1);const e=Zt(t);let n=yield ge(e);const o=["Backgrounds","Rabbits","Clothing","Informations","Other"];let a=0,r=0;switch(n.chartConfig.package){case"Backgrounds":a=0,r=382;break;case"Rabbits":a=382,r=0;break;case"Clothing":a=300,r=0;break;case"Jewelry":a=382,r=0;break;case"Decoration":a=618,r=382;break;case"Line":a=618,r=0;break;case"Informations":a=0,r=0;break;case"Other":a=0,r=0;break;default:a=s.offsetX-n.attr.w/2,r=s.offsetY-n.attr.h/2;break}q(n,a,r),m.addComponentList(n,!1,!0),m.setTargetSelectChart(n.id),o.includes(n.chartConfig.package)&&m.setLock(!0,!0),ee()}catch(t){je(),window.$message.warning("图表正在研发中, 敬请期待...")}}),Oe=s=>{s.preventDefault(),s.stopPropagation(),s.dataTransfer&&(s.dataTransfer.dropEffect="copy")},tn=(s,t)=>{if(t){m.setTargetSelectChart(t.id);return}m.setTargetSelectChart(void 0)},Un=(s,t)=>{var i;if(s.which==2||(i=window.$KeyboardActive)!=null&&i.space)return;tn();const e=s.offsetX,n=s.offsetY,o=s.screenX,a=s.screenY,r=m.getEditCanvas.scale;m.setMousePosition(void 0,void 0,e,n);const g=xt.throttle(l=>{m.setTargetSelectChart(),m.setEditCanvas(ot.IS_SELECT,!0);const u=e+l.screenX-o,h=n+l.screenY-a;m.setMousePosition(u,h);const v={x1:0,y1:0,x2:0,y2:0};u>e&&h>n?(v.x1=e,v.y1=n,v.x2=Math.round(e+(l.screenX-o)/r),v.y2=Math.round(n+(l.screenY-a)/r)):u>e&&h<n?(v.x1=e,v.y1=Math.round(n-(a-l.screenY)/r),v.x2=Math.round(e+(l.screenX-o)/r),v.y2=n):u<e&&h>n?(v.x1=Math.round(e-(o-l.screenX)/r),v.y1=n,v.x2=e,v.y2=Math.round(n+(l.screenY-a)/r)):(v.x1=Math.round(e-(o-l.screenX)/r),v.y1=Math.round(n-(a-l.screenY)/r),v.x2=e,v.y2=n),m.getComponentList.forEach(f=>{if(!m.getTargetChart.selectId.includes(f.id)){const{x:p,y,w,h:M}=f.attr,W={x1:p,y1:y,x2:p+w,y2:y+M};W.x1-v.x1>=0&&W.y1-v.y1>=0&&W.x2-v.x2<=0&&W.y2-v.y2<=0&&!f.status.lock&&!f.status.hide&&m.setTargetSelectChart(f.id,!0)}})},30),c=()=>{g.cancel(),m.setEditCanvas(ot.IS_SELECT,!1),m.setMousePosition(0,0,0,0),document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",c)},ve=()=>({mouseClickHandle:(a,r)=>{var g;if(a.preventDefault(),a.stopPropagation(),!r.status.lock&&(g=window.$KeyboardActive)!=null&&g.ctrl)if(m.targetChart.selectId.includes(r.id)){const c=m.targetChart.selectId.filter(i=>i!==r.id);m.setTargetSelectChart(c)}else m.setTargetSelectChart(r.id,!0)},mousedownHandle:(a,r)=>{var w;if(a.preventDefault(),a.stopPropagation(),r.status.lock||(Pe(),a.buttons===zt.LEFT&&((w=window.$KeyboardActive)!=null&&w.ctrl)))return;const g=m.getTargetChart.selectId;if(a.buttons===zt.RIGHT&&g.length>1&&g.includes(r.id)||(m.setTargetSelectChart(r.id),a.buttons===zt.RIGHT))return;const c=m.getEditCanvas.scale,i=m.getEditCanvasConfig.width,l=m.getEditCanvasConfig.height,u=new Map;m.getTargetChart.selectId.forEach(M=>{const W=m.fetchTargetIndex(M);if(W!==-1){const{x:L,y:I,w:B,h:X}=xe(m.getComponentList[W]).attr;u.set(M,{x:L,y:I,w:B,h:X})}});const h=a.screenX,v=a.screenY;let f=[];m.getTargetChart.selectId.forEach(M=>{if(!u.has(M))return;const W=m.fetchTargetIndex(M);f.push(xt.cloneDeep(m.getComponentList[W]))}),m.setMousePosition(void 0,void 0,h,v);const p=xt.throttle(M=>{m.setEditCanvas(ot.IS_DRAG,!0),m.setMousePosition(M.screenX,M.screenY);let W=(M.screenX-h)/c,L=(M.screenY-v)/c;m.getTargetChart.selectId.forEach(I=>{if(!u.has(I))return;const B=m.fetchTargetIndex(I),{x:X,y:K,w:T,h:Q}=u.get(I),k=m.getComponentList[B];let P=Math.round(X+W),O=Math.round(K+L);const d=50;P=P<-T+d?-T+d:P,O=O<-Q+d?-Q+d:O,P=P>i-d?i-d:P,O=O>l-d?l-d:O,k&&(k.attr=Object.assign(k.attr,{x:P,y:O}))})},20),y=()=>{try{m.setMousePosition(0,0,0,0),m.setEditCanvas(ot.IS_DRAG,!1),f.length&&(m.getTargetChart.selectId.forEach(M=>{if(!u.has(M))return;const W=m.fetchTargetIndex(M),L=m.getComponentList[W];f.forEach(I=>{I.id===M&&(I.attr=Object.assign(I.attr,{offsetX:L.attr.x-I.attr.x,offsetY:L.attr.y-I.attr.y}))})}),m.moveComponentList(f)),document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",y)}catch(M){console.log(M)}};document.addEventListener("mousemove",p),document.addEventListener("mouseup",y)},mouseenterHandle:(a,r)=>{a.preventDefault(),a.stopPropagation(),m.getEditCanvas.isSelect||m.setTargetHoverChart(r.id)},mouseleaveHandle:(a,r)=>{a.preventDefault(),a.stopPropagation(),m.setEditCanvas(ot.IS_DRAG,!1),m.setTargetHoverChart(void 0)},useMouseHandle:ve,touchstartHandle:(a,r)=>{if(console.log("e =>",a),console.log("item =>",r),a.preventDefault(),a.stopPropagation(),r.status.lock)return;Pe();const g=new Map;m.getTargetChart.selectId.forEach(v=>{const f=m.fetchTargetIndex(v);if(f!==-1){const{x:p,y,w,h:M}=xe(m.getComponentList[f]).attr;g.set(v,{x:p,y,w,h:M})}}),m.setTargetSelectChart(r.id);const c=a.touches[0].screenX,i=a.touches[0].screenY;let l=[];m.getTargetChart.selectId.forEach(v=>{if(!g.has(v))return;const f=m.fetchTargetIndex(v);l.push(xt.cloneDeep(m.getComponentList[f]))}),m.setMousePosition(void 0,void 0,c,i);const u=xt.throttle(v=>{m.setEditCanvas(ot.IS_DRAG,!0),m.setMousePosition(v.touches[0].screenX,v.touches[0].screenY);const f=(v.touches[0].screenX-c)/m.getEditCanvas.scale,p=(v.touches[0].screenY-i)/m.getEditCanvas.scale;m.getTargetChart.selectId.forEach(y=>{if(!g.has(y))return;const w=m.fetchTargetIndex(y),{x:M,y:W,w:L,h:I}=g.get(y),B=m.getComponentList[w];let X=Math.round(M+f),K=Math.round(W+p);const T=50;X=X<-L+T?-L+T:X,K=K<-I+T?-I+T:K,X=X>m.getEditCanvasConfig.width-T?m.getEditCanvasConfig.width-T:X,K=K>m.getEditCanvasConfig.height-T?m.getEditCanvasConfig.height-T:K,B&&(B.attr=Object.assign(B.attr,{x:X,y:K}))})},20),h=()=>{try{m.setMousePosition(0,0,0,0),m.setEditCanvas(ot.IS_DRAG,!1),l.length&&(m.getTargetChart.selectId.forEach(v=>{if(!g.has(v))return;const f=m.fetchTargetIndex(v),p=m.getComponentList[f];l.forEach(y=>{y.id===v&&(y.attr=Object.assign(y.attr,{offsetX:p.attr.x-y.attr.x,offsetY:p.attr.y-y.attr.y}))})}),m.moveComponentList(l))}catch(v){console.log(v)}};document.addEventListener("touchmove",u,{passive:!1}),document.addEventListener("touchend",h)}}),Fn=(s,t,e)=>{s.stopPropagation(),s.preventDefault(),m.setEditCanvas(ot.IS_DRAG,!0);const n=m.getEditCanvas.scale,o=e.x,a=e.y,r=e.w,g=e.h,c=s.screenX,i=s.screenY;m.setMousePosition(c,i);const l=xt.throttle(h=>{m.setMousePosition(h.screenX,h.screenY);let v=Math.round((h.screenX-c)/n),f=Math.round((h.screenY-i)/n);const p=/t/.test(t),y=/b/.test(t),w=/l/.test(t),M=/r/.test(t),W=g+(p?-f:y?f:0),L=r+(w?-v:M?v:0);e.h=W>0?W:0,e.w=L>0?L:0,e.x=o+(w?v:0),e.y=a+(p?f:0)},50),u=()=>{m.setEditCanvas(ot.IS_DRAG,!1),m.setMousePosition(0,0,0,0),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",u)},Ut=(s,t)=>s?{zIndex:s.zIndex===-1?t+1:s.zIndex+t+1,left:`${s.x}px`,top:`${s.y}px`}:{},Ct=(s,t)=>s?{width:`${t?t*s.w:s.w}px`,height:`${t?t*s.h:s.h}px`}:{},Wn=(s,t,e,n)=>{const{w:o,h:a}=e,r=/t/.test(s),g=/b/.test(s),c=/l/.test(s),i=/r/.test(s);let l=0,u=0;return s.length===2?(l=c?0:o,u=r?0:a):((r||g)&&(l=o/2,u=r?0:a),(c||i)&&(l=c?0:o,u=Math.floor(a/2))),{left:`${l}px`,top:`${u}px`,cursor:n[t]+"-resize"}};const Bn=["onMousedown"],Nn=pt({__name:"index",props:{item:{type:Object,required:!0},hiddenPoint:{type:Boolean,required:!1}},setup(s){const t=s;Bt(u=>({"6f41483b":r.value}));const e=Nt(),n=ct(),o=["t","r","b","l","lt","rt","lb","rb"],a=["n","e","s","w","nw","ne","sw","se"],r=A(()=>e.getAppTheme),g=A(()=>t.item.status.lock?!1:t.item.id===n.getTargetChart.hoverId),c=A(()=>{const u=t.item.id;return t.item.status.lock?!1:n.getTargetChart.selectId.find(h=>h===u)}),i=A(()=>t.item.status.lock),l=A(()=>t.item.status.hide);return(u,h)=>(b(),at("div",{class:vt(["go-shape-box",{lock:i.value,hide:l.value}])},[ce(u.$slots,"default",{},void 0,!0),s.hiddenPoint?Yt("",!0):(b(!0),at(St,{key:0},Mt(c.value?o:[],(v,f)=>(b(),at("div",{class:vt(`shape-point ${v}`),key:f,style:it(C(Wn)(v,f,s.item.attr,a)),onMousedown:p=>C(Fn)(p,v,s.item.attr)},null,46,Bn))),128)),Y("div",{class:"shape-modal",style:it(C(Ct)(s.item.attr))},[Y("div",{class:vt(["shape-modal-select",{active:c.value}])},null,2),Y("div",{class:vt(["shape-modal-change",{selectActive:c.value,hoverActive:g.value}])},null,2)],4)],2))}}),oe=_t(Nn,[["__scopeId","data-v-f03fb462"]]),Yn={class:"go-edit-group-box"},Gn=pt({__name:"index",props:{groupData:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(s){const t=ct(),{handleContextMenu:e}=fe(),{mouseenterHandle:n,mouseleaveHandle:o,mousedownHandle:a,mouseClickHandle:r}=ve(),g=(l,u,h)=>{const v=f=>u.filter(p=>f.includes(p.key));if(t.getTargetChart.selectId.length>1)return v([S.GROUP,S.DELETE]);{const f=[];h.status.lock?f.push(S.LOCK):f.push(S.UNLOCK),h.status.hide?f.push(S.HIDE):f.push(S.SHOW);const p=[S.UN_GROUP];return[...v(p),Cn(),...l.filter(y=>!f.includes(y.key))]}},c=A(()=>Be(t.getEditCanvasConfig.chartCustomThemeColorInfo)[t.getEditCanvasConfig.chartThemeColor]),i=A(()=>t.getEditCanvasConfig.chartThemeSetting);return(l,u)=>(b(),at("div",Yn,[(b(),Z(C(oe),{key:s.groupData.id,"data-id":s.groupData.id,index:s.groupIndex,item:s.groupData,hiddenPoint:!0,class:vt(C(Qt)(s.groupData.styles.animations)),style:it(F(F(F(F(F({},C(Ut)(s.groupData.attr,s.groupIndex)),C(Ct)(s.groupData.attr)),C($t)(s.groupData.styles)),C(te)(s.groupData.styles)),C(Ne)(s.groupData.styles))),onClick:u[0]||(u[0]=h=>C(r)(h,s.groupData)),onMousedown:u[1]||(u[1]=h=>C(a)(h,s.groupData)),onMouseenter:u[2]||(u[2]=h=>C(n)(h,s.groupData)),onMouseleave:u[3]||(u[3]=h=>C(o)(h,s.groupData)),onContextmenu:u[4]||(u[4]=h=>C(e)(h,s.groupData,g))},{default:$(()=>[(b(!0),at(St,null,Mt(s.groupData.groupList,h=>(b(),Z(C(oe),{key:h.id,"data-id":h.id,index:s.groupIndex,item:h,hiddenPoint:!0,style:it(F({},C(Ut)(h.attr,s.groupIndex)))},{default:$(()=>[(b(),Z(Et(h.chartConfig.chartKey),{class:vt(["edit-content-chart",C(Qt)(h.styles.animations)]),chartConfig:h,themeSetting:i.value,themeColor:c.value,style:it(F(F(F({},C(Ct)(h.attr)),C($t)(h.styles)),C(te)(h.styles)))},null,8,["class","chartConfig","themeSetting","themeColor","style"]))]),_:2},1032,["data-id","index","item","style"]))),128))]),_:1},8,["data-id","index","item","class","style"]))]))}});const Kn={class:"go-edit-align-line"},Xn=pt({__name:"index",setup(s){Bt(f=>({42514545:r.value}));const t=Nt(),e=ct(),n=Ye(),o=le({lineArr:["rowt","rowc","rowb","coll","colc","colr"],select:new Map,sorptioned:{x:!1,y:!1}}),a=f=>f?{left:`${f.x?f.x:0}px`,top:`${f.y?f.y:0}px`}:{},r=A(()=>t.getAppTheme),g=A(()=>n.getChartAlignRange),c=A(()=>e.getEditCanvas[ot.IS_DRAG]),i=(f,p)=>Math.abs(f-p)<=g.value,l=A(()=>e.getTargetChart.selectId),u=A(()=>e.getComponentList[e.fetchTargetIndex()]),h=A(()=>{var f;return((f=u.value)==null?void 0:f.attr)||{}}),v=A(()=>({id:"0",attr:{w:Se(e.getEditCanvasConfig.width),h:Se(e.getEditCanvasConfig.height),x:0,y:0,offsetX:0,offsetY:0,zIndex:0}}));return mt(()=>e.getMousePosition,st(()=>{try{if(!c.value||l.value.length!==1)return;const f=h.value.w,p=h.value.h,y=h.value.x,w=y+f/2,M=y+f,W=[y,w,M],L=h.value.y,I=L+p/2,B=L+p,X=[L,I,B];o.select.clear(),o.sorptioned.y=!1;const K=e.getComponentList.map(T=>({id:T.id,attr:T.attr}));K.push(v.value),o.lineArr.forEach(T=>{K.forEach(Q=>{if(l.value[0]===Q.id)return;const k=Q.attr.w,P=Q.attr.h,O=Q.attr.x,d=O+k/2,_=O+k,E=[O,d,_],x=Q.attr.y,U=x+P/2,R=x+P,lt=[x,U,R];T.includes("rowt")&&(i(L,x)&&(o.select.set(T,{y:x}),q(u.value,y,x)),i(L,U)&&(o.select.set(T,{y:U}),q(u.value,y,U)),i(L,R)&&(o.select.set(T,{y:R}),q(u.value,y,R))),T.includes("rowc")&&(i(I,x)&&(o.select.set(T,{y:x}),q(u.value,y,x-p/2)),i(I,U)&&(o.select.set(T,{y:U}),q(u.value,y,U-p/2)),i(I,R)&&(o.select.set(T,{y:R}),q(u.value,y,R-p/2))),T.includes("rowb")&&(i(B,x)&&(o.select.set(T,{y:x}),q(u.value,y,x-p)),i(B,U)&&(o.select.set(T,{y:U}),q(u.value,y,U-p)),i(B,R)&&(o.select.set(T,{y:R}),q(u.value,y,R-p))),T.includes("coll")&&(i(y,O)&&(o.select.set(T,{x:O}),q(u.value,O,L)),i(y,d)&&(o.select.set(T,{x:d}),q(u.value,d,L)),i(y,_)&&(o.select.set(T,{x:_}),q(u.value,_,L))),T.includes("colc")&&(i(w,O)&&(o.select.set(T,{x:O}),q(u.value,O-f/2,L)),i(w,d)&&(o.select.set(T,{x:d}),q(u.value,d-f/2,L)),i(w,_)&&(o.select.set(T,{x:_}),q(u.value,_-f/2,L))),T.includes("colr")&&(i(M,O)&&(o.select.set(T,{x:O}),q(u.value,O-f,L)),i(M,d)&&(o.select.set(T,{x:d}),q(u.value,d-f,L)),i(M,_)&&(o.select.set(T,{x:_}),q(u.value,_-f,L)))})})}catch(f){console.log(f)}},200),{deep:!0}),mt(()=>c.value,f=>{f||(o.select.clear(),o.sorptioned.y=!1)}),(f,p)=>(b(),at("div",Kn,[(b(!0),at(St,null,Mt(o.lineArr,y=>(b(),at("div",{class:vt(["line",[y.includes("row")?"row":"col",o.select.has(y)&&"visible"]]),key:y,style:it(a(o.select.get(y)))},null,6))),128))]))}}),zn=_t(Xn,[["__scopeId","data-v-403a9eed"]]);const en=s=>(de("data-v-71d41248"),s=s(),he(),s),qn=en(()=>Y("div",{class:"select-background"},null,-1)),Vn=en(()=>Y("div",{class:"select-border"},null,-1)),jn=[qn,Vn],Jn=pt({__name:"index",setup(s){Bt(g=>({c29aca42:a.value}));const t=Nt(),e=ct(),{isSelect:n,scale:o}=ue(e.getEditCanvas),a=A(()=>t.getAppTheme),r=z();return mt(()=>e.getMousePosition,g=>{if(!n.value)return;const{startX:c,startY:i,x:l,y:u}=g,h={zIndex:Te,x:0,y:0,w:0,h:0,offsetX:0,offsetY:0};l>c&&u>i?(h.x=c,h.y=i,h.w=Math.round((l-c)/o.value),h.h=Math.round((u-i)/o.value)):l>c&&u<i?(h.x=c,h.w=Math.round((l-c)/o.value),h.h=Math.round((i-u)/o.value),h.y=i-h.h):l<c&&u>i?(h.y=i,h.w=Math.round((c-l)/o.value),h.h=Math.round((u-i)/o.value),h.x=c-h.w):(h.w=Math.round((c-l)/o.value),h.h=Math.round((i-u)/o.value),h.x=c-h.w,h.y=i-h.h),r.value=F(F({},Ut(h,Te)),Ct(h))},{deep:!0}),(g,c)=>C(n)?(b(),at("div",{key:0,class:"go-edit-select",style:it(r.value)},jn,4)):Yt("",!0)}}),Zn=_t(Jn,[["__scopeId","data-v-71d41248"]]);const Qn=pt({__name:"index",setup(s){const t=ct(),{getEditCanvasConfig:e,getEditCanvas:n}=ue(t),o=A(()=>({w:e.value.width,h:e.value.height})),a=A(()=>{const g={transform:`scale(${n.value.scale})`};return F(F({},Ct(o.value)),g)}),r=A(()=>{const g=n.value.isCreate&&{"z-index":99999};return F(F({},Ct(o.value)),g)});return(g,c)=>(b(),at("div",{class:"go-edit-range go-transition",style:it(a.value),onMousedown:c[0]||(c[0]=i=>C(Un)(i,void 0))},[ce(g.$slots,"default",{},void 0,!0),G(C(zn)),G(C(Zn)),Y("div",{class:"go-edit-range-model",style:it(r.value)},null,4)],36))}}),ts=_t(Qn,[["__scopeId","data-v-00f6546e"]]),nn=!!(typeof window!="undefined"&&window.document&&window.document.createElement);var ae=!1,re=!1;try{var jt={get passive(){return ae=!0},get once(){return re=ae=!0}};nn&&(window.addEventListener("test",jt,jt),window.removeEventListener("test",jt,!0))}catch(s){}function es(s,t,e,n){if(n&&typeof n!="boolean"&&!re){var o=n.once,a=n.capture,r=e;!re&&o&&(r=e.__once||function g(c){this.removeEventListener(t,g,a),e.call(this,c)},e.__once=r),s.addEventListener(t,r,ae?n:a)}s.addEventListener(t,e,n)}function ns(s,t,e,n){var o=n&&typeof n!="boolean"?n.capture:n;s.removeEventListener(t,e,o),e.__once&&s.removeEventListener(t,e.__once,o)}function Re(s,t,e,n){return es(s,t,e,n),function(){ns(s,t,e,n)}}var Ae=new Date().getTime();function ss(s){var t=new Date().getTime(),e=Math.max(0,16-(t-Ae)),n=setTimeout(s,e);return Ae=t,n}var os=["","webkit","moz","o","ms"],Ie=ss,$e=function(t,e){return t+(t?e[0].toUpperCase()+e.substr(1):e)+"AnimationFrame"};nn&&os.some(function(s){var t=$e(s,"request");return t in window&&($e(s,"cancel"),Ie=function(n){return window[t](n)}),!!Ie});Function.prototype.bind.call(Function.prototype.call,[].slice);Function.prototype.bind.call(Function.prototype.call,[].slice);const as={class:"go-sketch-rule"},rs={key:0,class:"fix-edit-screens-block"},Jt=20,is=pt({__name:"index",setup(s){Bt(k=>({"16f39c63":L.value,"393c6a8e":M.value,bb12685c:u.value}));const t=ct(),e=Je(),n=Nt();let o=[0,0],a=[0,0];const r=z(),g=z(!0),c=z(),i=z(),l=z(!1),u=z("auto"),{width:h,height:v}=ue(t.getEditCanvasConfig),f=z(0),p=z(0),y=le({h:[],v:[]}),w=A(()=>t.getEditCanvas.scale),M=A(()=>`${v.value*2}px`),W=A(()=>n.getDarkTheme?{bgColor:"#18181c",longfgColor:"#4d4d4d",shortfgColor:"#4d4d4d",fontColor:"#4d4d4d",shadowColor:"#18181c",borderColor:"#18181c",cornerActiveColor:"#18181c"}:{}),L=A(()=>n.getAppTheme),I=k=>{if(k.ctrlKey||k.metaKey){k.preventDefault();let P=w.value;if(k.wheelDelta>=0&&w.value<2){P=w.value+.05,t.setScale(P);return}k.wheelDelta<0&&w.value>.1&&(P=w.value-.05,t.setScale(P))}},B=()=>{if(!r.value)return;const k=r.value.getBoundingClientRect(),P=c.value.getBoundingClientRect();f.value=(k.left+Jt-P.left)/w.value,p.value=(k.top+Jt-P.top)/w.value},X=k=>{var E,x;if(k.preventDefault(),k.stopPropagation(),k.which==2)l.value=!0;else if(!((E=window.$KeyboardActive)!=null&&E.space))return;(x=document.activeElement)==null||x.blur();const P=k.pageX,O=k.pageY,d=Re(window,"mousemove",U=>{const R=U.pageX-P,lt=U.pageY-O,[D,N]=o,[H,ft]=a;o=[N,R],a=[ft,lt],r.value.scrollLeft-=N>D?Math.abs(N-D):-Math.abs(N-D),r.value.scrollTop-=ft>H?Math.abs(ft-H):-Math.abs(ft-H)}),_=Re(window,"mouseup",()=>{d(),_(),o=[0,0],a=[0,0],l.value=!1})},K=()=>{const k=document.getElementById("go-chart-edit-layout");return k?{height:k.clientHeight-25,width:k.clientWidth}:{width:h.value,height:v.value}},T=()=>{g.value=!1,setTimeout(()=>{g.value=!0},10)},Q=()=>{const{width:k,height:P}=i.value.getBoundingClientRect(),{width:O,height:d}=K();r.value.scrollLeft=k/2-O/2,r.value.scrollTop=P/2-d/2};return mt(()=>n.getDarkTheme,()=>{T()}),mt(()=>w.value,(k,P)=>{P!==k&&e.getRePositionCanvas?(e.setItemUnHandle(ne.RE_POSITION_CANVAS,!1),B(),setTimeout(()=>{Q(),T()},400)):st(T,20)}),mt(()=>l.value,k=>{u.value=k?"grab":"auto"}),ie(()=>{r.value&&(r.value.addEventListener("wheel",I,{passive:!1}),Q())}),Ue(()=>{r.value&&r.value.removeEventListener("wheel",I)}),window.onKeySpacePressHold=k=>{l.value=k},(k,P)=>{const O=dt("sketch-rule");return b(),at("div",as,[Rt(G(O,{thick:Jt,scale:w.value,width:K().width,height:K().height,startX:f.value,startY:p.value,lines:y,palette:W.value},null,8,["scale","width","height","startX","startY","lines","palette"]),[[At,!1]]),Y("div",{ref_key:"$app",ref:r,class:"edit-screens",onScroll:B},[Y("div",{ref_key:"$container",ref:i,class:"edit-screen-container",style:it({width:C(h)*2+"px"})},[Y("div",{ref_key:"refSketchRuleBox",ref:c,class:"canvas",onMousedown:X,style:it({marginLeft:"-"+(K().width/2-25)+"px"})},[Y("div",{style:it({pointerEvents:l.value?"none":"auto"})},[ce(k.$slots,"default",{},void 0,!0)],4)],36)],4)],544),C(n).getDarkTheme?(b(),at("div",rs)):Yt("",!0)])}}}),cs=_t(is,[["__scopeId","data-v-c6872036"]]);/*!
 * Signature Pad v4.1.5 | https://github.com/szimek/signature_pad
 * (c) 2023 Szymon Nowak | Released under the MIT license
 */class Ft{constructor(t,e,n,o){if(isNaN(t)||isNaN(e))throw new Error(`Point is invalid: (${t}, ${e})`);this.x=+t,this.y=+e,this.pressure=n||0,this.time=o||Date.now()}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}equals(t){return this.x===t.x&&this.y===t.y&&this.pressure===t.pressure&&this.time===t.time}velocityFrom(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):0}}class pe{constructor(t,e,n,o,a,r){this.startPoint=t,this.control2=e,this.control1=n,this.endPoint=o,this.startWidth=a,this.endWidth=r}static fromPoints(t,e){const n=this.calculateControlPoints(t[0],t[1],t[2]).c2,o=this.calculateControlPoints(t[1],t[2],t[3]).c1;return new pe(t[1],n,o,t[2],e.start,e.end)}static calculateControlPoints(t,e,n){const o=t.x-e.x,a=t.y-e.y,r=e.x-n.x,g=e.y-n.y,c={x:(t.x+e.x)/2,y:(t.y+e.y)/2},i={x:(e.x+n.x)/2,y:(e.y+n.y)/2},l=Math.sqrt(o*o+a*a),u=Math.sqrt(r*r+g*g),h=c.x-i.x,v=c.y-i.y,f=u/(l+u),p={x:i.x+h*f,y:i.y+v*f},y=e.x-p.x,w=e.y-p.y;return{c1:new Ft(c.x+y,c.y+w),c2:new Ft(i.x+y,i.y+w)}}length(){let e=0,n,o;for(let a=0;a<=10;a+=1){const r=a/10,g=this.point(r,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),c=this.point(r,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(a>0){const i=g-n,l=c-o;e+=Math.sqrt(i*i+l*l)}n=g,o=c}return e}point(t,e,n,o,a){return e*(1-t)*(1-t)*(1-t)+3*n*(1-t)*(1-t)*t+3*o*(1-t)*t*t+a*t*t*t}}class ls{constructor(){try{this._et=new EventTarget}catch(t){this._et=document}}addEventListener(t,e,n){this._et.addEventListener(t,e,n)}dispatchEvent(t){return this._et.dispatchEvent(t)}removeEventListener(t,e,n){this._et.removeEventListener(t,e,n)}}function us(s,t=250){let e=0,n=null,o,a,r;const g=()=>{e=Date.now(),n=null,o=s.apply(a,r),n||(a=null,r=[])};return function(...i){const l=Date.now(),u=t-(l-e);return a=this,r=i,u<=0||u>t?(n&&(clearTimeout(n),n=null),e=l,o=s.apply(a,r),n||(a=null,r=[])):n||(n=window.setTimeout(g,u)),o}}class Wt extends ls{constructor(t,e={}){super(),this.canvas=t,this._drawningStroke=!1,this._isEmpty=!0,this._lastPoints=[],this._data=[],this._lastVelocity=0,this._lastWidth=0,this._handleMouseDown=n=>{n.buttons===1&&(this._drawningStroke=!0,this._strokeBegin(n))},this._handleMouseMove=n=>{this._drawningStroke&&this._strokeMoveUpdate(n)},this._handleMouseUp=n=>{n.buttons===1&&this._drawningStroke&&(this._drawningStroke=!1,this._strokeEnd(n))},this._handleTouchStart=n=>{if(n.cancelable&&n.preventDefault(),n.targetTouches.length===1){const o=n.changedTouches[0];this._strokeBegin(o)}},this._handleTouchMove=n=>{n.cancelable&&n.preventDefault();const o=n.targetTouches[0];this._strokeMoveUpdate(o)},this._handleTouchEnd=n=>{if(n.target===this.canvas){n.cancelable&&n.preventDefault();const a=n.changedTouches[0];this._strokeEnd(a)}},this._handlePointerStart=n=>{this._drawningStroke=!0,n.preventDefault(),this._strokeBegin(n)},this._handlePointerMove=n=>{this._drawningStroke&&(n.preventDefault(),this._strokeMoveUpdate(n))},this._handlePointerEnd=n=>{this._drawningStroke&&(n.preventDefault(),this._drawningStroke=!1,this._strokeEnd(n))},this.velocityFilterWeight=e.velocityFilterWeight||.7,this.minWidth=e.minWidth||.5,this.maxWidth=e.maxWidth||2.5,this.throttle="throttle"in e?e.throttle:16,this.minDistance="minDistance"in e?e.minDistance:5,this.dotSize=e.dotSize||0,this.penColor=e.penColor||"black",this.backgroundColor=e.backgroundColor||"rgba(0,0,0,0)",this._strokeMoveUpdate=this.throttle?us(Wt.prototype._strokeUpdate,this.throttle):Wt.prototype._strokeUpdate,this._ctx=t.getContext("2d"),this.clear(),this.on()}clear(){const{_ctx:t,canvas:e}=this;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._data=[],this._reset(this._getPointGroupOptions()),this._isEmpty=!0}fromDataURL(t,e={}){return new Promise((n,o)=>{const a=new Image,r=e.ratio||window.devicePixelRatio||1,g=e.width||this.canvas.width/r,c=e.height||this.canvas.height/r,i=e.xOffset||0,l=e.yOffset||0;this._reset(this._getPointGroupOptions()),a.onload=()=>{this._ctx.drawImage(a,i,l,g,c),n()},a.onerror=u=>{o(u)},a.crossOrigin="anonymous",a.src=t,this._isEmpty=!1})}toDataURL(t="image/png",e){switch(t){case"image/svg+xml":return typeof e!="object"&&(e=void 0),`data:image/svg+xml;base64,${btoa(this.toSVG(e))}`;default:return typeof e!="number"&&(e=void 0),this.canvas.toDataURL(t,e)}}on(){this.canvas.style.touchAction="none",this.canvas.style.msTouchAction="none",this.canvas.style.userSelect="none";const t=/Macintosh/.test(navigator.userAgent)&&"ontouchstart"in document;window.PointerEvent&&!t?this._handlePointerEvents():(this._handleMouseEvents(),"ontouchstart"in window&&this._handleTouchEvents())}off(){this.canvas.style.touchAction="auto",this.canvas.style.msTouchAction="auto",this.canvas.style.userSelect="auto",this.canvas.removeEventListener("pointerdown",this._handlePointerStart),this.canvas.removeEventListener("pointermove",this._handlePointerMove),this.canvas.ownerDocument.removeEventListener("pointerup",this._handlePointerEnd),this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove),this.canvas.ownerDocument.removeEventListener("mouseup",this._handleMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove),this.canvas.removeEventListener("touchend",this._handleTouchEnd)}isEmpty(){return this._isEmpty}fromData(t,{clear:e=!0}={}){e&&this.clear(),this._fromData(t,this._drawCurve.bind(this),this._drawDot.bind(this)),this._data=this._data.concat(t)}toData(){return this._data}_getPointGroupOptions(t){return{penColor:t&&"penColor"in t?t.penColor:this.penColor,dotSize:t&&"dotSize"in t?t.dotSize:this.dotSize,minWidth:t&&"minWidth"in t?t.minWidth:this.minWidth,maxWidth:t&&"maxWidth"in t?t.maxWidth:this.maxWidth,velocityFilterWeight:t&&"velocityFilterWeight"in t?t.velocityFilterWeight:this.velocityFilterWeight}}_strokeBegin(t){this.dispatchEvent(new CustomEvent("beginStroke",{detail:t}));const e=this._getPointGroupOptions(),n=Object.assign(Object.assign({},e),{points:[]});this._data.push(n),this._reset(e),this._strokeUpdate(t)}_strokeUpdate(t){if(this._data.length===0){this._strokeBegin(t);return}this.dispatchEvent(new CustomEvent("beforeUpdateStroke",{detail:t}));const e=t.clientX,n=t.clientY,o=t.pressure!==void 0?t.pressure:t.force!==void 0?t.force:0,a=this._createPoint(e,n,o),r=this._data[this._data.length-1],g=r.points,c=g.length>0&&g[g.length-1],i=c?a.distanceTo(c)<=this.minDistance:!1,l=this._getPointGroupOptions(r);if(!c||!(c&&i)){const u=this._addPoint(a,l);c?u&&this._drawCurve(u,l):this._drawDot(a,l),g.push({time:a.time,x:a.x,y:a.y,pressure:a.pressure})}this.dispatchEvent(new CustomEvent("afterUpdateStroke",{detail:t}))}_strokeEnd(t){this._strokeUpdate(t),this.dispatchEvent(new CustomEvent("endStroke",{detail:t}))}_handlePointerEvents(){this._drawningStroke=!1,this.canvas.addEventListener("pointerdown",this._handlePointerStart),this.canvas.addEventListener("pointermove",this._handlePointerMove),this.canvas.ownerDocument.addEventListener("pointerup",this._handlePointerEnd)}_handleMouseEvents(){this._drawningStroke=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove),this.canvas.ownerDocument.addEventListener("mouseup",this._handleMouseUp)}_handleTouchEvents(){this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove),this.canvas.addEventListener("touchend",this._handleTouchEnd)}_reset(t){this._lastPoints=[],this._lastVelocity=0,this._lastWidth=(t.minWidth+t.maxWidth)/2,this._ctx.fillStyle=t.penColor}_createPoint(t,e,n){const o=this.canvas.getBoundingClientRect();return new Ft(t-o.left,e-o.top,n,new Date().getTime())}_addPoint(t,e){const{_lastPoints:n}=this;if(n.push(t),n.length>2){n.length===3&&n.unshift(n[0]);const o=this._calculateCurveWidths(n[1],n[2],e),a=pe.fromPoints(n,o);return n.shift(),a}return null}_calculateCurveWidths(t,e,n){const o=n.velocityFilterWeight*e.velocityFrom(t)+(1-n.velocityFilterWeight)*this._lastVelocity,a=this._strokeWidth(o,n),r={end:a,start:this._lastWidth};return this._lastVelocity=o,this._lastWidth=a,r}_strokeWidth(t,e){return Math.max(e.maxWidth/(t+1),e.minWidth)}_drawCurveSegment(t,e,n){const o=this._ctx;o.moveTo(t,e),o.arc(t,e,n,0,2*Math.PI,!1),this._isEmpty=!1}_drawCurve(t,e){const n=this._ctx,o=t.endWidth-t.startWidth,a=Math.ceil(t.length())*2;n.beginPath(),n.fillStyle=e.penColor;for(let r=0;r<a;r+=1){const g=r/a,c=g*g,i=c*g,l=1-g,u=l*l,h=u*l;let v=h*t.startPoint.x;v+=3*u*g*t.control1.x,v+=3*l*c*t.control2.x,v+=i*t.endPoint.x;let f=h*t.startPoint.y;f+=3*u*g*t.control1.y,f+=3*l*c*t.control2.y,f+=i*t.endPoint.y;const p=Math.min(t.startWidth+i*o,e.maxWidth);this._drawCurveSegment(v,f,p)}n.closePath(),n.fill()}_drawDot(t,e){const n=this._ctx,o=e.dotSize>0?e.dotSize:(e.minWidth+e.maxWidth)/2;n.beginPath(),this._drawCurveSegment(t.x,t.y,o),n.closePath(),n.fillStyle=e.penColor,n.fill()}_fromData(t,e,n){for(const o of t){const{points:a}=o,r=this._getPointGroupOptions(o);if(a.length>1)for(let g=0;g<a.length;g+=1){const c=a[g],i=new Ft(c.x,c.y,c.pressure,c.time);g===0&&this._reset(r);const l=this._addPoint(i,r);l&&e(l,r)}else this._reset(r),n(a[0],r)}}toSVG({includeBackgroundColor:t=!1}={}){const e=this._data,n=Math.max(window.devicePixelRatio||1,1),o=0,a=0,r=this.canvas.width/n,g=this.canvas.height/n,c=document.createElementNS("http://www.w3.org/2000/svg","svg");if(c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),c.setAttribute("viewBox",`${o} ${a} ${r} ${g}`),c.setAttribute("width",r.toString()),c.setAttribute("height",g.toString()),t&&this.backgroundColor){const i=document.createElement("rect");i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("fill",this.backgroundColor),c.appendChild(i)}return this._fromData(e,(i,{penColor:l})=>{const u=document.createElement("path");if(!isNaN(i.control1.x)&&!isNaN(i.control1.y)&&!isNaN(i.control2.x)&&!isNaN(i.control2.y)){const h=`M ${i.startPoint.x.toFixed(3)},${i.startPoint.y.toFixed(3)} C ${i.control1.x.toFixed(3)},${i.control1.y.toFixed(3)} ${i.control2.x.toFixed(3)},${i.control2.y.toFixed(3)} ${i.endPoint.x.toFixed(3)},${i.endPoint.y.toFixed(3)}`;u.setAttribute("d",h),u.setAttribute("stroke-width",(i.endWidth*2.25).toFixed(3)),u.setAttribute("stroke",l),u.setAttribute("fill","none"),u.setAttribute("stroke-linecap","round"),c.appendChild(u)}},(i,{penColor:l,dotSize:u,minWidth:h,maxWidth:v})=>{const f=document.createElement("circle"),p=u>0?u:(h+v)/2;f.setAttribute("r",p.toString()),f.setAttribute("cx",i.x.toString()),f.setAttribute("cy",i.y.toString()),f.setAttribute("fill",l),c.appendChild(f)}),c.outerHTML}}const ds={class:"list-content"},hs={class:"list-content-img"},fs={ref:"signatureCanvas",id:"signatureCanvas"},gs=pt({__name:"index",props:{modalShow:{required:!0,type:Boolean}},emits:["close","edit"],setup(s,{emit:t}){const e=s,{HammerIcon:n}=Ze.ionicons5,o=z(!1),a=ct();let r;mt(()=>e.modalShow,i=>{o.value=i,i&&Ge(()=>{const l=document.getElementById("signatureCanvas");l.width=1e3,l.height=350,l.style.backgroundColor="#FFFFFF",r=new Wt(l,{penColor:"black",backgroundColor:"rgba(0, 0, 0, 0)",minWidth:2,maxWidth:5})})},{immediate:!0}),le([{label:fn("global.r_edit"),key:"edit",icon:gn(n)}]);const g=()=>{const i=r.toDataURL();a.setSingCanvas(i),o.value=!1},c=()=>{t("close")};return(i,l)=>{const u=dt("n-text"),h=dt("n-space"),v=dt("n-button"),f=dt("n-card"),p=dt("n-modal");return b(),Z(p,{class:"go-modal-box",show:o.value,"onUpdate:show":l[1]||(l[1]=y=>o.value=y),onAfterLeave:c},{default:$(()=>[G(f,{hoverable:"",size:"small"},{action:$(()=>[G(h,{class:"list-footer",justify:"space-between"},{default:$(()=>[G(u,{depth:"3"}),G(h,null,{default:$(()=>[G(v,{type:"primary",ghost:"",onClick:l[0]||(l[0]=y=>g())},{default:$(()=>[Ht(" 保存并关闭 ")]),_:1})]),_:1})]),_:1})]),default:$(()=>[Y("div",ds,[G(h,{class:"list-content-top go-px-0",justify:"center"},{default:$(()=>[G(h,null,{default:$(()=>[G(u,null,{default:$(()=>[Ht(" 签名 ")]),_:1})]),_:1})]),_:1}),Y("div",hs,[Y("canvas",fs,null,512)])])]),_:1})]),_:1},8,["show"])}}}),vs=_t(gs,[["__scopeId","data-v-7177ee91"]]),ps=s=>s,ms=(s,t)=>{try{if(t.id){const e="vnodeBeforeMount"in t.events,n="vnodeMounted"in t.events;return e&&(s.events.advancedEvents.vnodeBeforeMount=t==null?void 0:t.events.vnodeBeforeMount),n&&(s.events.advancedEvents.vnodeMounted=t==null?void 0:t.events.vnodeMounted),(e||n)&&(t.events={baseEvent:{[bt.ON_CLICK]:void 0,[bt.ON_DBL_CLICK]:void 0,[bt.ON_MOUSE_ENTER]:void 0,[bt.ON_MOUSE_LEAVE]:void 0},advancedEvents:{[ke.VNODE_MOUNTED]:void 0,[ke.VNODE_BEFORE_MOUNT]:void 0},interactEvents:[]}),s}}catch(e){return s}},yt=(s,t,e=!1)=>{if(ms(s,t),e)return Vt(s,t);const n=t.option;if(!n)return Vt(s,t);if(t.option=void 0,n)return Tt(F({},Vt(s,t)),{option:n})},sn=()=>{const s=ct(),t=wn(),e=Je();return{updateComponent:(o,a=!1,r=!1)=>ht(void 0,null,function*(){a&&(s.componentList=[],t.clearBackStack(),t.clearForwardStack()),o.editCanvasConfig=ps(o.editCanvasConfig),o.componentList.forEach(c=>ht(void 0,null,function*(){const i=l=>{window.$vue.component(l.chartConfig.chartKey)||(window.$vue.component(l.chartConfig.chartKey,ze(l.chartConfig)),window.$vue.component(l.chartConfig.conKey,qe(l.chartConfig)))};c.isGroup?c.groupList.forEach(l=>{i(l)}):i(c)}));const g=(c,i)=>ht(void 0,null,function*(){let l=yield ge(c.chartConfig);i?i(r?yt(l,Tt(F({},c),{id:qt()})):yt(l,c)):r?s.addComponentList(yt(l,Tt(F({},c),{id:qt()})),!1,!0):s.addComponentList(yt(l,c),!1,!0)});for(const c in o)if(c===En.COMPONENT_LIST){let i=0;const l=o[c].length;for(const u of o[c]){let h=parseInt((parseFloat(`${++i/l}`)*100).toString());if(e.setItemUnHandle(ne.PERCENTAGE,h),u.isGroup){let v=new xn;r?v=yt(v,Tt(F({},u),{id:qt()})):v=yt(v,u);const f=[];for(const p of u.groupList)yield g(p,y=>{f.push(y)});v.groupList=f,s.addComponentList(v,!1,!0)}else yield g(u)}}else{if(c!=="editCanvasConfig"&&c!=="requestGlobalConfig")return;yt(s[c],o[c],!0)}e.setItemUnHandle(ne.PERCENTAGE,0)})}},_s=()=>{const s=z(),{updateComponent:t}=sn();return{importUploadFileListRef:s,importBeforeUpload:({file:o})=>{s.value=[];const a=o.file.type;return a!==De.JSON&&a!==De.TXT?(window.$message.warning("仅支持上传 【JSON】 格式文件，请重新上传！"),!1):!0},importCustomRequest:o=>{const{file:a}=o;Ge(()=>{a.file?bn(a.file).then(r=>{kn({message:"请选择导入方式:",positiveText:"新增（可撤回）",negativeText:"覆盖（不可撤回）",negativeButtonProps:{type:"info",ghost:!1},onPositiveCallback:()=>ht(void 0,null,function*(){try{r=Zt(r),yield t(r,!1,!0),window.$message.success("导入成功！")}catch(g){console.log(g),window.$message.error("组件导入失败，请检查文件完整性!")}}),onNegativeCallback:()=>ht(void 0,null,function*(){try{r=Zt(r),yield t(r,!0,!0),window.$message.success("导入成功！")}catch(g){console.log(g),window.$message.error("组件导入失败，请检查文件完整性!")}})})}):window.$message.error("导入失败，请检查数据或联系管理员！")})}}},{updateComponent:ys}=sn(),on=ct(),He=()=>{dispatchEvent(new CustomEvent(It.CHART_TO_PREVIEW,{detail:on.getStorageInfo}))},Cs=()=>{const s=a=>{window.$message.success("正在进行更新..."),ys(a.detail,!0)},t=()=>{on.setEditCanvas(ot.IS_CODE_EDIT,!1)},e=()=>{addEventListener("blur",He),addEventListener(It.JSON,s),addEventListener(It.CLOSE,st(t,1e3))},n=()=>{removeEventListener("blur",He),removeEventListener(It.JSON,s)};return(a,r)=>{r==Me.CHART_HOME_NAME&&n(),a==Me.CHART_HOME_NAME&&e()}},ws=()=>{const s=Ke();mt(()=>s.name,Cs(),{immediate:!0})};var wt=(s=>(s.BUTTON="button",s.IMPORTUPLOAD="importUpload",s))(wt||{});const Es=s=>ht(void 0,null,function*(){try{return yield Qe(Xe.POST)("/api/sources/create",s)}catch(t){console.log("error")}}),xs=s=>ht(void 0,null,function*(){try{return yield Qe(Xe.POST)("/api/uploads/create",s)}catch(t){console.log("error")}});const me=s=>(de("data-v-25f264da"),s=s(),he(),s),Ss={class:"btn-item"},Ts={class:"blt-modal"},ks={class:"blt-modal-main"},Ms=me(()=>Y("img",{style:{width:"400px","margin-left":"20px"},src:"https://enjoyer.vueadmin.com/blt/1.png",alt:"#"},null,-1)),Ls={class:"blt-modal-text"},bs=me(()=>Y("div",null,"太棒了,恭喜你生成了一张属于你的数字艺术作品",-1)),Ds=me(()=>Y("div",null,"扫描下方二维码带走它",-1)),Ps=pt({__name:"index",setup(s){const{DownloadIcon:t,ShareIcon:e,PawIcon:n,SettingsSharpIcon:o,CreateIcon:a,Refresh:r}=Ze.ionicons5,g=Ye(),c=ct(),{getPackagesList:i}=Dn();Ke(),ws();const l=z(!1);let u=null;const h=z(!1),v=z(!0),f=z(!0),{importUploadFileListRef:p,importCustomRequest:y,importBeforeUpload:w}=_s(),M=z(""),W=z(""),L=z(!1),I=z(6e4),B=A(()=>g.getChartToolsStatus===Le.ASIDE),X=A(()=>g.getChartToolsStatusHide),K=A(()=>v.value&&X.value),T=A(()=>{if(!B.value)return lt;const D=[];return lt.map(N=>{D.unshift(N)}),D}),Q=()=>{u=setTimeout(()=>{v.value&&(v.value=!1,f.value=!0)},200),setTimeout(()=>{f.value=!1},400)},k=()=>{clearTimeout(u),v.value||(v.value=!0)},P=()=>{const D=document.documentElement;D.requestFullscreen&&D.requestFullscreen(),c.emptyComponentList(),U()},O=()=>{l.value=!0},d=()=>{l.value=!1},_=D=>{if(D.indexOf("=")>0){var N=D.indexOf("=");D=D.substring(0,N)}return parseInt(D.length-D.length/8*2+"")},E=()=>{I.value<=0?(L.value=!1,P()):(I.value-=1e3,setTimeout(E,1e3))},x=D=>ht(this,null,function*(){try{Ve();const N=["Backgrounds","Rabbits","Clothing","Informations","Other"];be(D.chartKey,ze(D)),be(D.conKey,qe(D));let H=yield ge(D);c.addComponentList(H,!1,!0),c.setTargetSelectChart(H.id),N.includes(D.package)&&c.setLock(!0,!0),ee()}catch(N){je(),window.$message.warning("图表正在研发中, 敬请期待...")}}),U=()=>{const N=c.getComponentList.map(H=>H.key);N.includes("TextGroup")||i.Informations.map(H=>{H.key==="TextGroup"&&x(H)}),N.includes("TextCommon")||i.Informations.map(H=>{H.key==="TextCommon"&&x(H)}),N.includes("Other1")||i.Other.map(H=>{H.key==="Other1"&&x(H)}),N.includes("Other2")||i.Other.map(H=>{H.key==="Other2"&&x(H)})},R=()=>ht(this,null,function*(){const D=c.getComponentList,N=D[1];N.attr.zIndex=9e3,yield c.updateComponentList(1,N);const H=D[0];H.attr.zIndex=9e3,yield c.updateComponentList(0,H);const ft=document.querySelector(".go-edit-range"),Lt=yield pn(ft,{backgroundColor:null,allowTaint:!0,useCORS:!0}),Gt="fEFtyOAP4KqE5j0KIGK4Dg0X9xHDjMo2OnQnk4w4:TnrvaVkukV-7tDQB3RNbzvLfsXg=:eyJzY29wZSI6InRpbWVzYXBjZTIwMjMwNTA1IiwiZGVhZGxpbmUiOjE4ODMyOTY0ODR9";let ut=Lt.toDataURL();ut=ut.replace("data:image/png;base64,",""),ut=ut.replace("data:image/jpeg;base64,",""),ut=ut.replace("data:image/jpg;base64,",""),ut=ut.replace("data:image/gif;base64,","");const Kt="https://upload-z1.qiniup.com/putb64/"+_(ut),gt=new XMLHttpRequest;gt.open("POST",Kt,!0),gt.setRequestHeader("Content-Type","application/octet-stream"),gt.setRequestHeader("Authorization","UpToken "+Gt),gt.send(ut),gt.onreadystatechange=()=>ht(this,null,function*(){if(gt.readyState===4){const V=JSON.parse(gt.responseText).key;M.value="data:image/png;base64,"+ut,W.value="https://enjoyer.vueadmin.com/"+V,L.value=!0,I.value=6e4,yield Es({generation_date:"2023-05-16 20:51",generation_terminal:"PC",image_code:V,par_value:"20",is_verified:!1,resource_code:"blt20200801"}),yield xs({device:"A",image_path:V}),c.setSingCanvas(""),E()}})}),lt=[{key:"refresh",type:wt.BUTTON,name:"重置",icon:r,handle:P},{key:"sign",type:wt.BUTTON,name:"签名",icon:a,handle:O},{key:"create",type:wt.BUTTON,name:"生成",icon:t,handle:R}];return(D,N)=>{const H=dt("n-icon"),ft=dt("n-text"),Lt=dt("n-button"),Gt=dt("n-upload"),ut=dt("n-tooltip"),Kt=dt("n-image"),gt=dt("n-modal");return b(),at(St,null,[Y("div",{class:vt(["go-chart-edit-tools",[C(g).getChartToolsStatus,K.value?"isMini":"unMini"]]),onClick:N[1]||(N[1]=V=>v.value&&(v.value=!1)),onMouseenter:Q,onMouseleave:k},[Rt(G(H,{class:"asideLogo",size:"22"},{default:$(()=>[G(C(n))]),_:1},512),[[At,C(g).getChartToolsStatus===C(Le).ASIDE&&K.value]]),(b(!0),at(St,null,Mt(T.value,(V,_e)=>(b(),Z(ut,{key:V.key+_e,disabled:!B.value||X.value&&f.value,trigger:"hover",placement:"left"},{trigger:$(()=>[Y("div",Ss,[V.type===C(wt).BUTTON?(b(),Z(Lt,{key:0,circle:B.value,secondary:"",onClick:V.handle},{icon:$(()=>[B.value?(b(),Z(H,{key:0,size:"22"},{default:$(()=>[(b(),Z(Et(V.icon)))]),_:2},1024)):(b(),Z(Et(V.icon),{key:1}))]),default:$(()=>[Rt(G(ft,{depth:"3"},{default:$(()=>[Ht(Dt(V.name),1)]),_:2},1536),[[At,!B.value]])]),_:2},1032,["circle","onClick"])):V.type===C(wt).IMPORTUPLOAD?(b(),Z(Gt,{key:1,"file-list":C(p),"onUpdate:fileList":N[0]||(N[0]=ye=>vn(p)?p.value=ye:null),"show-file-list":!1,customRequest:C(y),onBeforeUpload:C(w)},{default:$(()=>[G(Lt,{circle:B.value,secondary:""},{icon:$(()=>[B.value?(b(),Z(H,{key:0,size:"22"},{default:$(()=>[(b(),Z(Et(V.icon)))]),_:2},1024)):(b(),Z(Et(V.icon),{key:1}))]),default:$(()=>[Rt(G(ft,{depth:"3"},{default:$(()=>[Ht(Dt(V.name),1)]),_:2},1536),[[At,!B.value]])]),_:2},1032,["circle"])]),_:2},1032,["file-list","customRequest","onBeforeUpload"])):Yt("",!0)])]),default:$(()=>[Y("span",null,Dt(V.name),1)]),_:2},1032,["disabled"]))),128)),G(gt,{show:L.value},{default:$(()=>[Y("div",Ts,[Y("div",ks,[G(Kt,{width:"700",height:"350",src:M.value},null,8,["src"]),Ms]),Y("div",Ls,[bs,Ds,Y("div",null,"解锁倒计时："+Dt(I.value/1e3),1)]),G(Sn,{class:"blt-group-qrcode",value:W.value,size:150,level:"H"},null,8,["value"])])]),_:1},8,["show"])],34),G(C(Ln),{modelShow:h.value,"onUpdate:modelShow":N[2]||(N[2]=V=>h.value=V)},null,8,["modelShow"]),G(C(vs),{modalShow:l.value,onClose:d},null,8,["modalShow"])],64)}}}),Os=_t(Ps,[["__scopeId","data-v-25f264da"]]);const Rs=s=>(de("data-v-1f4f1a65"),s=s(),he(),s),As=Rs(()=>Y("img",{src:"https://enjoyer.vueadmin.com/blt/2.png",style:{width:"800px","margin-bottom":"20px"}},null,-1)),Is=pt({__name:"index",setup(s){const{GO_CHART_LAYOUT_STORE:t}=yn,e=ct(),{handleContextMenu:n}=fe();z(""),mn(Tn,null),Pn();const{mouseenterHandle:o,mouseleaveHandle:a,mousedownHandle:r,mouseClickHandle:g,touchstartHandle:c}=ve(),i=(v,f,p)=>{if(e.getTargetChart.selectId.length>1)return f.filter(w=>[S.GROUP,S.DELETE].includes(w.key));const y=[];return p.status.lock?y.push(S.LOCK):y.push(S.UNLOCK),p.status.hide?y.push(S.HIDE):y.push(S.SHOW),v.filter(w=>!y.includes(w.key))},l=A(()=>e.getEditCanvasConfig.chartThemeSetting),u=A(()=>Be(e.getEditCanvasConfig.chartCustomThemeColorInfo)[e.getEditCanvasConfig.chartThemeColor]);A(()=>e.getEditCanvasConfig.filterShow);const h=A(()=>({width:"inherit",height:"inherit"}));return ie(()=>{$n(),_n(t,{layers:!1,charts:!0,details:!0,chartType:"double",layerType:"thumbnail",percentage:0,rePositionCanvas:!0})}),(v,f)=>(b(),Z(C(Mn),{id:"go-chart-edit-layout",flex:!0,showTop:!1,showBottom:!0,depth:1,xScroll:!0,disabledScroll:!0,onMousedown:C(tn),onDrop:C(Hn),onDragover:C(Oe),onDragenter:C(Oe)},{aside:$(()=>[G(C(Os))]),default:$(()=>[G(C(cs),null,{default:$(()=>[As,Y("div",{id:"go-chart-edit-content",onContextmenu:f[0]||(f[0]=(...p)=>C(n)&&C(n)(...p))},[G(C(ts),null,{default:$(()=>[Y("div",{class:"content-edit-range",style:it(F(F({},C($t)(C(e).getEditCanvasConfig)),h.value))},[(b(!0),at(St,null,Mt(C(e).getComponentList,(p,y)=>(b(),at("div",{key:p.id},[p.isGroup?(b(),Z(C(Gn),{key:0,groupData:p,groupIndex:y},null,8,["groupData","groupIndex"])):(b(),Z(C(oe),{key:1,"data-id":p.id,index:y,style:it(F(F({},C(Ut)(p.attr,y)),C(Ne)(p.styles))),item:p,onClick:w=>C(g)(w,p),onMousedown:w=>C(r)(w,p),onMouseenter:w=>C(o)(w,p),onMouseleave:w=>C(a)(w,p),onContextmenu:w=>C(n)(w,p,i),onTouchstart:w=>C(c)(w,p)},{default:$(()=>[(b(),Z(Et(p.chartConfig.chartKey),{class:vt(["edit-content-chart",C(Qt)(p.styles.animations)]),chartConfig:p,themeSetting:l.value,themeColor:u.value,style:it(F(F(F({},C(Ct)(p.attr)),C($t)(p.styles)),C(te)(p.styles)))},null,8,["class","chartConfig","themeSetting","themeColor","style"]))]),_:2},1032,["data-id","index","style","item","onClick","onMousedown","onMouseenter","onMouseleave","onContextmenu","onTouchstart"]))]))),128))],4)]),_:1})],32)]),_:1})]),_:1},8,["onMousedown","onDrop","onDragover","onDragenter"]))}}),so=_t(Is,[["__scopeId","data-v-1f4f1a65"]]);export{so as default};
