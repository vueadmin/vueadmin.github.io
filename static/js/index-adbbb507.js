var Ve=Object.defineProperty,je=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Ze=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var de=(s,t,e)=>t in s?Ve(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,U=(s,t)=>{for(var e in t||(t={}))Ze.call(t,e)&&de(s,e,t[e]);if(ue)for(var e of ue(t))Qe.call(t,e)&&de(s,e,t[e]);return s},wt=(s,t)=>je(s,Je(t));var dt=(s,t,e)=>new Promise((n,o)=>{var a=c=>{try{g(e.next(c))}catch(i){o(i)}},r=c=>{try{g(e.throw(c))}catch(i){o(i)}},g=c=>c.done?n(c.value):Promise.resolve(c.value).then(a,r);g((e=e.apply(s,t)).next())});import{n as ee,a1 as be,a_ as tn,ai as x,cB as Le,cC as De,cD as he,bb as nt,aV as Wt,cA as en,aC as zt,cE as X,aj as fe,b1 as Bt,c as mt,d as ft,b0 as Ht,m as Ut,a0 as I,o as P,e as J,f as ne,F as yt,s as St,ag as ht,af as rt,u as C,a3 as kt,q as B,au as Pe,E as G,w as A,G as vt,ao as qt,ap as Rt,aq as Vt,ar as Re,$ as Ae,p as se,ak as ge,L as pt,Z as oe,l as z,cF as ve,z as ae,A as re,g as W,r as at,al as Oe,I as nn,X as sn,h as At,t as Mt,M as Ft,ch as Yt,aL as bt,aM as pe,B as Ie,J as me,az as Pt,b8 as _e,Q as Nt,R as Gt,b5 as on,cG as an,bh as rn,x as cn,S as ln}from"./index-626b7612.js";import{u as ie,d as un}from"./index-98bd7f6a.js";import{u as ct,E as st,a as dn,C as hn,e as fn}from"./chartEditStore-0b7ef33c.js";import{d as $e,f as gn,c as vn,at as pn,au as mn}from"./index-c01c3466.js";import{a as _n,b as ye,l as yn,g as Cn}from"./plugin-dad6e467.js";import{l as xt}from"./lodash-df5e1ee4.js";import{C as wn}from"./index-4a90cc7c.js";import{u as He,C as jt}from"./chartLayoutStore-f42711a2.js";import{i as Ue}from"./icon-c63cf7f2.js";import{G as En}from"./index-745461ce.js";import{M as xn}from"./index-69bbc289.js";import{F as Ce}from"./fileTypeEnum-21359a08.js";import{r as Sn}from"./file-84751f49.js";import"./components-e127fb65.js";import"./SettingItem-5e7c51f2.js";/* empty css                                                                   */import"./SettingItemBox-7cda1492.js";import"./CollapseItem-34106d1f.js";import"./index.esm.min-610b41b2.js";import"./http-138d8a62.js";const Tn="/static/png/2.png",Tt=ct(),Mn=()=>{ee(()=>{Tt.setEditCanvas(st.EDIT_LAYOUT_DOM,document.getElementById("go-chart-edit-layout")),Tt.setEditCanvas(st.EDIT_CONTENT_DOM,document.getElementById("go-chart-edit-content"));const s=Tt.listenerScale();be(()=>{Tt.setEditCanvas(st.EDIT_LAYOUT_DOM,null),Tt.setEditCanvas(st.EDIT_CONTENT_DOM,null),s()})})};var Jt={},kn={get exports(){return Jt},set exports(s){Jt=s}};(function(s){(function(t){var e,n={},o={16:!1,18:!1,17:!1,91:!1},a="all",r={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},g={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},c=function(h){return g[h]||h.toUpperCase().charCodeAt(0)},i=[];for(e=1;e<20;e++)g["f"+e]=111+e;function u(h,_){for(var E=h.length;E--;)if(h[E]===_)return E;return-1}function l(h,_){if(h.length!=_.length)return!1;for(var E=0;E<h.length;E++)if(h[E]!==_[E])return!1;return!0}var d={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function v(h){for(e in o)o[e]=h[d[e]]}function f(h){var _,E,T,D,b,q;if(_=h.keyCode,u(i,_)==-1&&i.push(_),(_==93||_==224)&&(_=91),_ in o){o[_]=!0;for(T in r)r[T]==_&&(w[T]=!0);return}if(v(h),!!w.filter.call(this,h)&&_ in n){for(q=Y(),D=0;D<n[_].length;D++)if(E=n[_][D],E.scope==q||E.scope=="all"){b=E.mods.length>0;for(T in o)(!o[T]&&u(E.mods,+T)>-1||o[T]&&u(E.mods,+T)==-1)&&(b=!1);(E.mods.length==0&&!o[16]&&!o[18]&&!o[17]&&!o[91]||b)&&E.method(h,E)===!1&&(h.preventDefault?h.preventDefault():h.returnValue=!1,h.stopPropagation&&h.stopPropagation(),h.cancelBubble&&(h.cancelBubble=!0))}}}function p(h){var _=h.keyCode,E,T=u(i,_);if(T>=0&&i.splice(T,1),(_==93||_==224)&&(_=91),_ in o){o[_]=!1;for(E in r)r[E]==_&&(w[E]=!1)}}function y(){for(e in o)o[e]=!1;for(e in r)w[e]=!1}function w(h,_,E){var T,D;T=S(h),E===void 0&&(E=_,_="all");for(var b=0;b<T.length;b++)D=[],h=T[b].split("+"),h.length>1&&(D=Z(h),h=[h[h.length-1]]),h=h[0],h=c(h),h in n||(n[h]=[]),n[h].push({shortcut:T[b],scope:_,method:E,key:T[b],mods:D})}function L(h,_){var E,T,D=[],b,q,F;for(E=S(h),q=0;q<E.length;q++){if(T=E[q].split("+"),T.length>1&&(D=Z(T),h=T[T.length-1]),h=c(h),_===void 0&&(_=Y()),!n[h])return;for(b=0;b<n[h].length;b++)F=n[h][b],F.scope===_&&l(F.mods,D)&&(n[h][b]={})}}function $(h){return typeof h=="string"&&(h=c(h)),u(i,h)!=-1}function M(){return i.slice(0)}function R(h){var _=(h.target||h.srcElement).tagName;return!(_=="INPUT"||_=="SELECT"||_=="TEXTAREA")}for(e in r)w[e]=!1;function K(h){a=h||"all"}function Y(){return a||"all"}function N(h){var _,E,T;for(_ in n)for(E=n[_],T=0;T<E.length;)E[T].scope===h?E.splice(T,1):T++}function S(h){var _;return h=h.replace(/\s/g,""),_=h.split(","),_[_.length-1]==""&&(_[_.length-2]+=","),_}function Z(h){for(var _=h.slice(0,h.length-1),E=0;E<_.length;E++)_[E]=r[_[E]];return _}function k(h,_,E){h.addEventListener?h.addEventListener(_,E,!1):h.attachEvent&&h.attachEvent("on"+_,function(){E(window.event)})}k(document,"keydown",function(h){f(h)}),k(document,"keyup",p),k(window,"focus",y);var H=t.key;function O(){var h=t.key;return t.key=H,h}t.key=w,t.key.setScope=K,t.key.getScope=Y,t.key.deleteScope=N,t.key.filter=R,t.key.isPressed=$,t.key.getPressedKeyCodes=M,t.key.noConflict=O,t.key.unbind=L,s.exports=w})(tn)})(kn);const Q=Jt,tt=ct(),ot=s=>`${Le.CTRL}+${s}`,Lt=s=>`${Le.SHIFT}+${s}`,V={[x.ARROW_UP]:ot("up"),[x.ARROW_RIGHT]:ot("right"),[x.ARROW_DOWN]:ot("down"),[x.ARROW_LEFT]:ot("left"),[x.COPY]:ot("c"),[x.CUT]:ot("x"),[x.PARSE]:ot("v"),[x.DELETE]:"delete",[x.BACK]:ot("z"),[x.FORWORD]:ot(Lt("z")),[x.GROUP]:ot("g"),[x.UN_GROUP]:ot(Lt("g")),[x.LOCK]:ot("l"),[x.UNLOCK]:ot(Lt("l")),[x.HIDE]:ot("h"),[x.SHOW]:ot(Lt("h"))},et=s=>`${De.CTRL}+${s}`,Dt=s=>`${De.SHIFT}+${s}`,j={[x.ARROW_UP]:et("arrowup"),[x.ARROW_RIGHT]:et("arrowright"),[x.ARROW_DOWN]:et("arrowdown"),[x.ARROW_LEFT]:et("arrowleft"),[x.COPY]:et("c"),[x.CUT]:et("x"),[x.PARSE]:et("v"),[x.DELETE]:et("backspace"),[x.BACK]:et("z"),[x.FORWORD]:et(Dt("z")),[x.GROUP]:et("g"),[x.UN_GROUP]:et(Dt("g")),[x.LOCK]:et("l"),[x.UNLOCK]:et(Dt("l")),[x.HIDE]:et("h"),[x.SHOW]:et(Dt("h"))},bn=[V.up,V.right,V.down,V.left,V.delete,V.copy,V.cut,V.parse,V.back,V.forward,V.group,V.unGroup,V.lock,V.unLock,V.hide,V.show],Ln=[j.up,j.right,j.down,j.left,j.delete,j.copy,j.cut,j.parse,j.back,j.forward,j.group,j.unGroup,j.lock,j.unLock,j.hide,j.show],Dn=()=>{window.$KeyboardActive={ctrl:!1,space:!1},document.onkeydown=s=>{const{keyCode:t}=s;if(t==32&&s.target==document.body&&s.preventDefault(),[17,32].includes(t)&&window.$KeyboardActive)switch(he(s.keyCode),t){case 17:window.$KeyboardActive.ctrl=!0;break;case 32:window.$KeyboardActive.space=!0;break}},document.onkeyup=s=>{const{keyCode:t}=s;if(t==32&&s.target==document.body&&s.preventDefault(),[17,32].includes(t)&&window.$KeyboardActive)switch(he(),t){case 17:window.$KeyboardActive.ctrl=!1;break;case 32:window.$KeyboardActive.space=!1;break}}},Pn=()=>{const t=(e,n)=>{switch(n){case e.up:Q(n,nt(()=>(tt.setMove(x.ARROW_UP),!1),50));break;case e.right:Q(n,nt(()=>(tt.setMove(x.ARROW_RIGHT),!1),50));break;case e.down:Q(n,nt(()=>(tt.setMove(x.ARROW_DOWN),!1),50));break;case e.left:Q(n,nt(()=>(tt.setMove(x.ARROW_LEFT),!1),50));break;case e.delete:Q(n,Wt(()=>(tt.removeComponentList(),!1),50));break;case e.copy:Q(n,Wt(()=>(tt.setCopy(),!1),50));break;case e.cut:Q(n,Wt(()=>(tt.setCut(),!1),50));break;case e.parse:Q(n,nt(()=>(tt.setParse(),!1),50));break;case e.back:Q(n,nt(()=>(tt.setBack(),!1),50));break;case e.forward:Q(n,nt(()=>(tt.setForward(),!1),50));break;case e.group:Q(n,nt(()=>(tt.setGroup(),!1),50));break;case e.unGroup:Q(n,nt(()=>(tt.setUnGroup(),!1),50));break;case e.lock:Q(n,nt(()=>(tt.setLock(),!1),50));break;case e.unLock:Q(n,nt(()=>(tt.setUnLock(),!1),50));break;case e.hide:Q(n,nt(()=>(tt.setHide(),!1),50));break;case e.show:Q(n,nt(()=>(tt.setShow(),!1),50));break}};bn.forEach(e=>{t(V,e)}),Ln.forEach(e=>{t(j,e)}),Dn()},m=ct(),{onClickOutSide:we}=ie(),Rn=s=>dt(void 0,null,function*(){s.preventDefault();try{_n();const t=s.dataTransfer.getData(en.DRAG_KEY);if(!t){ye();return}m.setEditCanvas(st.IS_CREATE,!1);const e=zt(t);let n=yield $e(e);const o=["Backgrounds","Rabbits","Clothing","Informations","Other"];let a=0,r=0;switch(n.chartConfig.package){case"Backgrounds":a=0,r=382;break;case"Rabbits":a=382,r=0;break;case"Clothing":a=300,r=0;break;case"Jewelry":a=382,r=0;break;case"Decoration":a=618,r=382;break;case"Line":a=618,r=0;break;case"Informations":a=0,r=0;break;case"Other":a=0,r=0;break;default:a=s.offsetX-n.attr.w/2,r=s.offsetY-n.attr.h/2;break}X(n,a,r),m.addComponentList(n,!1,!0),m.setTargetSelectChart(n.id),o.includes(n.chartConfig.package)&&m.setLock(!0,!0),ye()}catch(t){yn(),window.$message.warning("图表正在研发中, 敬请期待...")}}),Ee=s=>{s.preventDefault(),s.stopPropagation(),s.dataTransfer&&(s.dataTransfer.dropEffect="copy")},We=(s,t)=>{if(t){m.setTargetSelectChart(t.id);return}m.setTargetSelectChart(void 0)},An=(s,t)=>{var i;if(s.which==2||(i=window.$KeyboardActive)!=null&&i.space)return;We();const e=s.offsetX,n=s.offsetY,o=s.screenX,a=s.screenY,r=m.getEditCanvas.scale;m.setMousePosition(void 0,void 0,e,n);const g=xt.throttle(u=>{m.setTargetSelectChart(),m.setEditCanvas(st.IS_SELECT,!0);const l=e+u.screenX-o,d=n+u.screenY-a;m.setMousePosition(l,d);const v={x1:0,y1:0,x2:0,y2:0};l>e&&d>n?(v.x1=e,v.y1=n,v.x2=Math.round(e+(u.screenX-o)/r),v.y2=Math.round(n+(u.screenY-a)/r)):l>e&&d<n?(v.x1=e,v.y1=Math.round(n-(a-u.screenY)/r),v.x2=Math.round(e+(u.screenX-o)/r),v.y2=n):l<e&&d>n?(v.x1=Math.round(e-(o-u.screenX)/r),v.y1=n,v.x2=e,v.y2=Math.round(n+(u.screenY-a)/r)):(v.x1=Math.round(e-(o-u.screenX)/r),v.y1=Math.round(n-(a-u.screenY)/r),v.x2=e,v.y2=n),m.getComponentList.forEach(f=>{if(!m.getTargetChart.selectId.includes(f.id)){const{x:p,y,w,h:L}=f.attr,$={x1:p,y1:y,x2:p+w,y2:y+L};$.x1-v.x1>=0&&$.y1-v.y1>=0&&$.x2-v.x2<=0&&$.y2-v.y2<=0&&!f.status.lock&&!f.status.hide&&m.setTargetSelectChart(f.id,!0)}})},30),c=()=>{g.cancel(),m.setEditCanvas(st.IS_SELECT,!1),m.setMousePosition(0,0,0,0),document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",c)},ce=()=>({mouseClickHandle:(a,r)=>{var g;if(a.preventDefault(),a.stopPropagation(),!r.status.lock&&(g=window.$KeyboardActive)!=null&&g.ctrl)if(m.targetChart.selectId.includes(r.id)){const c=m.targetChart.selectId.filter(i=>i!==r.id);m.setTargetSelectChart(c)}else m.setTargetSelectChart(r.id,!0)},mousedownHandle:(a,r)=>{var w;if(a.preventDefault(),a.stopPropagation(),r.status.lock||(we(),a.buttons===Bt.LEFT&&((w=window.$KeyboardActive)!=null&&w.ctrl)))return;const g=m.getTargetChart.selectId;if(a.buttons===Bt.RIGHT&&g.length>1&&g.includes(r.id)||(m.setTargetSelectChart(r.id),a.buttons===Bt.RIGHT))return;const c=m.getEditCanvas.scale,i=m.getEditCanvasConfig.width,u=m.getEditCanvasConfig.height,l=new Map;m.getTargetChart.selectId.forEach(L=>{const $=m.fetchTargetIndex(L);if($!==-1){const{x:M,y:R,w:K,h:Y}=fe(m.getComponentList[$]).attr;l.set(L,{x:M,y:R,w:K,h:Y})}});const d=a.screenX,v=a.screenY;let f=[];m.getTargetChart.selectId.forEach(L=>{if(!l.has(L))return;const $=m.fetchTargetIndex(L);f.push(xt.cloneDeep(m.getComponentList[$]))}),m.setMousePosition(void 0,void 0,d,v);const p=xt.throttle(L=>{m.setEditCanvas(st.IS_DRAG,!0),m.setMousePosition(L.screenX,L.screenY);let $=(L.screenX-d)/c,M=(L.screenY-v)/c;m.getTargetChart.selectId.forEach(R=>{if(!l.has(R))return;const K=m.fetchTargetIndex(R),{x:Y,y:N,w:S,h:Z}=l.get(R),k=m.getComponentList[K];let H=Math.round(Y+$),O=Math.round(N+M);const h=50;H=H<-S+h?-S+h:H,O=O<-Z+h?-Z+h:O,H=H>i-h?i-h:H,O=O>u-h?u-h:O,k&&(k.attr=Object.assign(k.attr,{x:H,y:O}))})},20),y=()=>{try{m.setMousePosition(0,0,0,0),m.setEditCanvas(st.IS_DRAG,!1),f.length&&(m.getTargetChart.selectId.forEach(L=>{if(!l.has(L))return;const $=m.fetchTargetIndex(L),M=m.getComponentList[$];f.forEach(R=>{R.id===L&&(R.attr=Object.assign(R.attr,{offsetX:M.attr.x-R.attr.x,offsetY:M.attr.y-R.attr.y}))})}),m.moveComponentList(f)),document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",y)}catch(L){console.log(L)}};document.addEventListener("mousemove",p),document.addEventListener("mouseup",y)},mouseenterHandle:(a,r)=>{a.preventDefault(),a.stopPropagation(),m.getEditCanvas.isSelect||m.setTargetHoverChart(r.id)},mouseleaveHandle:(a,r)=>{a.preventDefault(),a.stopPropagation(),m.setEditCanvas(st.IS_DRAG,!1),m.setTargetHoverChart(void 0)},useMouseHandle:ce,touchstartHandle:(a,r)=>{if(console.log("e =>",a),console.log("item =>",r),a.preventDefault(),a.stopPropagation(),r.status.lock)return;we();const g=new Map;m.getTargetChart.selectId.forEach(v=>{const f=m.fetchTargetIndex(v);if(f!==-1){const{x:p,y,w,h:L}=fe(m.getComponentList[f]).attr;g.set(v,{x:p,y,w,h:L})}}),m.setTargetSelectChart(r.id);const c=a.touches[0].screenX,i=a.touches[0].screenY;let u=[];m.getTargetChart.selectId.forEach(v=>{if(!g.has(v))return;const f=m.fetchTargetIndex(v);u.push(xt.cloneDeep(m.getComponentList[f]))}),m.setMousePosition(void 0,void 0,c,i);const l=xt.throttle(v=>{m.setEditCanvas(st.IS_DRAG,!0),m.setMousePosition(v.touches[0].screenX,v.touches[0].screenY);const f=(v.touches[0].screenX-c)/m.getEditCanvas.scale,p=(v.touches[0].screenY-i)/m.getEditCanvas.scale;m.getTargetChart.selectId.forEach(y=>{if(!g.has(y))return;const w=m.fetchTargetIndex(y),{x:L,y:$,w:M,h:R}=g.get(y),K=m.getComponentList[w];let Y=Math.round(L+f),N=Math.round($+p);const S=50;Y=Y<-M+S?-M+S:Y,N=N<-R+S?-R+S:N,Y=Y>m.getEditCanvasConfig.width-S?m.getEditCanvasConfig.width-S:Y,N=N>m.getEditCanvasConfig.height-S?m.getEditCanvasConfig.height-S:N,K&&(K.attr=Object.assign(K.attr,{x:Y,y:N}))})},20),d=()=>{try{m.setMousePosition(0,0,0,0),m.setEditCanvas(st.IS_DRAG,!1),u.length&&(m.getTargetChart.selectId.forEach(v=>{if(!g.has(v))return;const f=m.fetchTargetIndex(v),p=m.getComponentList[f];u.forEach(y=>{y.id===v&&(y.attr=Object.assign(y.attr,{offsetX:p.attr.x-y.attr.x,offsetY:p.attr.y-y.attr.y}))})}),m.moveComponentList(u))}catch(v){console.log(v)}};document.addEventListener("touchmove",l,{passive:!1}),document.addEventListener("touchend",d)}}),On=(s,t,e)=>{s.stopPropagation(),s.preventDefault(),m.setEditCanvas(st.IS_DRAG,!0);const n=m.getEditCanvas.scale,o=e.x,a=e.y,r=e.w,g=e.h,c=s.screenX,i=s.screenY;m.setMousePosition(c,i);const u=xt.throttle(d=>{m.setMousePosition(d.screenX,d.screenY);let v=Math.round((d.screenX-c)/n),f=Math.round((d.screenY-i)/n);const p=/t/.test(t),y=/b/.test(t),w=/l/.test(t),L=/r/.test(t),$=g+(p?-f:y?f:0),M=r+(w?-v:L?v:0);e.h=$>0?$:0,e.w=M>0?M:0,e.x=o+(w?v:0),e.y=a+(p?f:0)},50),l=()=>{m.setEditCanvas(st.IS_DRAG,!1),m.setMousePosition(0,0,0,0),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",l)};document.addEventListener("mousemove",u),document.addEventListener("mouseup",l)},Ot=(s,t)=>s?{zIndex:s.zIndex===-1?t+1:s.zIndex+t+1,left:`${s.x}px`,top:`${s.y}px`}:{},Ct=(s,t)=>s?{width:`${t?t*s.w:s.w}px`,height:`${t?t*s.h:s.h}px`}:{},In=(s,t,e,n)=>{const{w:o,h:a}=e,r=/t/.test(s),g=/b/.test(s),c=/l/.test(s),i=/r/.test(s);let u=0,l=0;return s.length===2?(u=c?0:o,l=r?0:a):((r||g)&&(u=o/2,l=r?0:a),(c||i)&&(u=c?0:o,l=Math.floor(a/2))),{left:`${u}px`,top:`${l}px`,cursor:n[t]+"-resize"}};const $n=["onMousedown"],Hn=ft({__name:"index",props:{item:{type:Object,required:!0},hiddenPoint:{type:Boolean,required:!1}},setup(s){const t=s;Ht(l=>({"6f41483b":r.value}));const e=Ut(),n=ct(),o=["t","r","b","l","lt","rt","lb","rb"],a=["n","e","s","w","nw","ne","sw","se"],r=I(()=>e.getAppTheme),g=I(()=>t.item.status.lock?!1:t.item.id===n.getTargetChart.hoverId),c=I(()=>{const l=t.item.id;return t.item.status.lock?!1:n.getTargetChart.selectId.find(d=>d===l)}),i=I(()=>t.item.status.lock),u=I(()=>t.item.status.hide);return(l,d)=>(P(),J("div",{class:ht(["go-shape-box",{lock:i.value,hide:u.value}])},[ne(l.$slots,"default",{},void 0,!0),s.hiddenPoint?kt("",!0):(P(!0),J(yt,{key:0},St(c.value?o:[],(v,f)=>(P(),J("div",{class:ht(`shape-point ${v}`),key:f,style:rt(C(In)(v,f,s.item.attr,a)),onMousedown:p=>C(On)(p,v,s.item.attr)},null,46,$n))),128)),B("div",{class:"shape-modal",style:rt(C(Ct)(s.item.attr))},[B("div",{class:ht(["shape-modal-select",{active:c.value}])},null,2),B("div",{class:ht(["shape-modal-change",{selectActive:c.value,hoverActive:g.value}])},null,2)],4)],2))}}),Zt=mt(Hn,[["__scopeId","data-v-f03fb462"]]),Un={class:"go-edit-group-box"},Wn=ft({__name:"index",props:{groupData:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(s){const t=ct(),{handleContextMenu:e}=ie(),{mouseenterHandle:n,mouseleaveHandle:o,mousedownHandle:a,mouseClickHandle:r}=ce(),g=(u,l,d)=>{const v=f=>l.filter(p=>f.includes(p.key));if(t.getTargetChart.selectId.length>1)return v([x.GROUP,x.DELETE]);{const f=[];d.status.lock?f.push(x.LOCK):f.push(x.UNLOCK),d.status.hide?f.push(x.HIDE):f.push(x.SHOW);const p=[x.UN_GROUP];return[...v(p),un(),...u.filter(y=>!f.includes(y.key))]}},c=I(()=>Pe(t.getEditCanvasConfig.chartCustomThemeColorInfo)[t.getEditCanvasConfig.chartThemeColor]),i=I(()=>t.getEditCanvasConfig.chartThemeSetting);return(u,l)=>(P(),J("div",Un,[(P(),G(C(Zt),{key:s.groupData.id,"data-id":s.groupData.id,index:s.groupIndex,item:s.groupData,hiddenPoint:!0,class:ht(C(qt)(s.groupData.styles.animations)),style:rt(U(U(U(U(U({},C(Ot)(s.groupData.attr,s.groupIndex)),C(Ct)(s.groupData.attr)),C(Rt)(s.groupData.styles)),C(Vt)(s.groupData.styles)),C(Re)(s.groupData.styles))),onClick:l[0]||(l[0]=d=>C(r)(d,s.groupData)),onMousedown:l[1]||(l[1]=d=>C(a)(d,s.groupData)),onMouseenter:l[2]||(l[2]=d=>C(n)(d,s.groupData)),onMouseleave:l[3]||(l[3]=d=>C(o)(d,s.groupData)),onContextmenu:l[4]||(l[4]=d=>C(e)(d,s.groupData,g))},{default:A(()=>[(P(!0),J(yt,null,St(s.groupData.groupList,d=>(P(),G(C(Zt),{key:d.id,"data-id":d.id,index:s.groupIndex,item:d,hiddenPoint:!0,style:rt(U({},C(Ot)(d.attr,s.groupIndex)))},{default:A(()=>[(P(),G(vt(d.chartConfig.chartKey),{class:ht(["edit-content-chart",C(qt)(d.styles.animations)]),chartConfig:d,themeSetting:i.value,themeColor:c.value,style:rt(U(U(U({},C(Ct)(d.attr)),C(Rt)(d.styles)),C(Vt)(d.styles)))},null,8,["class","chartConfig","themeSetting","themeColor","style"]))]),_:2},1032,["data-id","index","item","style"]))),128))]),_:1},8,["data-id","index","item","class","style"]))]))}});const Bn={class:"go-edit-align-line"},Fn=ft({__name:"index",setup(s){Ht(f=>({42514545:r.value}));const t=Ut(),e=ct(),n=Ae(),o=se({lineArr:["rowt","rowc","rowb","coll","colc","colr"],select:new Map,sorptioned:{x:!1,y:!1}}),a=f=>f?{left:`${f.x?f.x:0}px`,top:`${f.y?f.y:0}px`}:{},r=I(()=>t.getAppTheme),g=I(()=>n.getChartAlignRange),c=I(()=>e.getEditCanvas[st.IS_DRAG]),i=(f,p)=>Math.abs(f-p)<=g.value,u=I(()=>e.getTargetChart.selectId),l=I(()=>e.getComponentList[e.fetchTargetIndex()]),d=I(()=>{var f;return((f=l.value)==null?void 0:f.attr)||{}}),v=I(()=>({id:"0",attr:{w:ge(e.getEditCanvasConfig.width),h:ge(e.getEditCanvasConfig.height),x:0,y:0,offsetX:0,offsetY:0,zIndex:0}}));return pt(()=>e.getMousePosition,nt(()=>{try{if(!c.value||u.value.length!==1)return;const f=d.value.w,p=d.value.h,y=d.value.x,w=y+f/2,L=y+f,$=[y,w,L],M=d.value.y,R=M+p/2,K=M+p,Y=[M,R,K];o.select.clear(),o.sorptioned.y=!1;const N=e.getComponentList.map(S=>({id:S.id,attr:S.attr}));N.push(v.value),o.lineArr.forEach(S=>{N.forEach(Z=>{if(u.value[0]===Z.id)return;const k=Z.attr.w,H=Z.attr.h,O=Z.attr.x,h=O+k/2,_=O+k,E=[O,h,_],T=Z.attr.y,D=T+H/2,b=T+H,q=[T,D,b];S.includes("rowt")&&(i(M,T)&&(o.select.set(S,{y:T}),X(l.value,y,T)),i(M,D)&&(o.select.set(S,{y:D}),X(l.value,y,D)),i(M,b)&&(o.select.set(S,{y:b}),X(l.value,y,b))),S.includes("rowc")&&(i(R,T)&&(o.select.set(S,{y:T}),X(l.value,y,T-p/2)),i(R,D)&&(o.select.set(S,{y:D}),X(l.value,y,D-p/2)),i(R,b)&&(o.select.set(S,{y:b}),X(l.value,y,b-p/2))),S.includes("rowb")&&(i(K,T)&&(o.select.set(S,{y:T}),X(l.value,y,T-p)),i(K,D)&&(o.select.set(S,{y:D}),X(l.value,y,D-p)),i(K,b)&&(o.select.set(S,{y:b}),X(l.value,y,b-p))),S.includes("coll")&&(i(y,O)&&(o.select.set(S,{x:O}),X(l.value,O,M)),i(y,h)&&(o.select.set(S,{x:h}),X(l.value,h,M)),i(y,_)&&(o.select.set(S,{x:_}),X(l.value,_,M))),S.includes("colc")&&(i(w,O)&&(o.select.set(S,{x:O}),X(l.value,O-f/2,M)),i(w,h)&&(o.select.set(S,{x:h}),X(l.value,h-f/2,M)),i(w,_)&&(o.select.set(S,{x:_}),X(l.value,_-f/2,M))),S.includes("colr")&&(i(L,O)&&(o.select.set(S,{x:O}),X(l.value,O-f,M)),i(L,h)&&(o.select.set(S,{x:h}),X(l.value,h-f,M)),i(L,_)&&(o.select.set(S,{x:_}),X(l.value,_-f,M)))})})}catch(f){console.log(f)}},200),{deep:!0}),pt(()=>c.value,f=>{f||(o.select.clear(),o.sorptioned.y=!1)}),(f,p)=>(P(),J("div",Bn,[(P(!0),J(yt,null,St(o.lineArr,y=>(P(),J("div",{class:ht(["line",[y.includes("row")?"row":"col",o.select.has(y)&&"visible"]]),key:y,style:rt(a(o.select.get(y)))},null,6))),128))]))}}),Yn=mt(Fn,[["__scopeId","data-v-403a9eed"]]);const Be=s=>(ae("data-v-71d41248"),s=s(),re(),s),Nn=Be(()=>B("div",{class:"select-background"},null,-1)),Gn=Be(()=>B("div",{class:"select-border"},null,-1)),Kn=[Nn,Gn],Xn=ft({__name:"index",setup(s){Ht(g=>({c29aca42:a.value}));const t=Ut(),e=ct(),{isSelect:n,scale:o}=oe(e.getEditCanvas),a=I(()=>t.getAppTheme),r=z();return pt(()=>e.getMousePosition,g=>{if(!n.value)return;const{startX:c,startY:i,x:u,y:l}=g,d={zIndex:ve,x:0,y:0,w:0,h:0,offsetX:0,offsetY:0};u>c&&l>i?(d.x=c,d.y=i,d.w=Math.round((u-c)/o.value),d.h=Math.round((l-i)/o.value)):u>c&&l<i?(d.x=c,d.w=Math.round((u-c)/o.value),d.h=Math.round((i-l)/o.value),d.y=i-d.h):u<c&&l>i?(d.y=i,d.w=Math.round((c-u)/o.value),d.h=Math.round((l-i)/o.value),d.x=c-d.w):(d.w=Math.round((c-u)/o.value),d.h=Math.round((i-l)/o.value),d.x=c-d.w,d.y=i-d.h),r.value=U(U({},Ot(d,ve)),Ct(d))},{deep:!0}),(g,c)=>C(n)?(P(),J("div",{key:0,class:"go-edit-select",style:rt(r.value)},Kn,4)):kt("",!0)}}),zn=mt(Xn,[["__scopeId","data-v-71d41248"]]);const qn=ft({__name:"index",setup(s){const t=ct(),{getEditCanvasConfig:e,getEditCanvas:n}=oe(t),o=I(()=>({w:e.value.width,h:e.value.height})),a=I(()=>{const g={transform:`scale(${n.value.scale})`};return U(U({},Ct(o.value)),g)}),r=I(()=>{const g=n.value.isCreate&&{"z-index":99999};return U(U({},Ct(o.value)),g)});return(g,c)=>(P(),J("div",{class:"go-edit-range go-transition",style:rt(a.value),onMousedown:c[0]||(c[0]=i=>C(An)(i,void 0))},[ne(g.$slots,"default",{},void 0,!0),W(C(Yn)),W(C(zn)),B("div",{class:"go-edit-range-model",style:rt(r.value)},null,4)],36))}}),Vn=mt(qn,[["__scopeId","data-v-00f6546e"]]),Fe=!!(typeof window!="undefined"&&window.document&&window.document.createElement);var Qt=!1,te=!1;try{var Kt={get passive(){return Qt=!0},get once(){return te=Qt=!0}};Fe&&(window.addEventListener("test",Kt,Kt),window.removeEventListener("test",Kt,!0))}catch(s){}function jn(s,t,e,n){if(n&&typeof n!="boolean"&&!te){var o=n.once,a=n.capture,r=e;!te&&o&&(r=e.__once||function g(c){this.removeEventListener(t,g,a),e.call(this,c)},e.__once=r),s.addEventListener(t,r,Qt?n:a)}s.addEventListener(t,e,n)}function Jn(s,t,e,n){var o=n&&typeof n!="boolean"?n.capture:n;s.removeEventListener(t,e,o),e.__once&&s.removeEventListener(t,e.__once,o)}function xe(s,t,e,n){return jn(s,t,e,n),function(){Jn(s,t,e,n)}}var Se=new Date().getTime();function Zn(s){var t=new Date().getTime(),e=Math.max(0,16-(t-Se)),n=setTimeout(s,e);return Se=t,n}var Qn=["","webkit","moz","o","ms"],Te=Zn,Me=function(t,e){return t+(t?e[0].toUpperCase()+e.substr(1):e)+"AnimationFrame"};Fe&&Qn.some(function(s){var t=Me(s,"request");return t in window&&(Me(s,"cancel"),Te=function(n){return window[t](n)}),!!Te});Function.prototype.bind.call(Function.prototype.call,[].slice);Function.prototype.bind.call(Function.prototype.call,[].slice);const ts={class:"go-sketch-rule"},es={key:1,class:"fix-edit-screens-block"},Xt=20,ns=ft({__name:"index",setup(s){Ht(k=>({"027e6d17":M.value,"66707d7c":L.value,"2846119e":l.value}));const t=ct(),e=He(),n=Ut();let o=[0,0],a=[0,0];const r=z(),g=z(!0),c=z(),i=z(),u=z(!1),l=z("auto"),{width:d,height:v}=oe(t.getEditCanvasConfig),f=z(0),p=z(0),y=se({h:[],v:[]}),w=I(()=>t.getEditCanvas.scale),L=I(()=>`${v.value*2}px`),$=I(()=>n.getDarkTheme?{bgColor:"#18181c",longfgColor:"#4d4d4d",shortfgColor:"#4d4d4d",fontColor:"#4d4d4d",shadowColor:"#18181c",borderColor:"#18181c",cornerActiveColor:"#18181c"}:{}),M=I(()=>n.getAppTheme),R=k=>{if(k.ctrlKey||k.metaKey){k.preventDefault();let H=w.value;if(k.wheelDelta>=0&&w.value<2){H=w.value+.05,t.setScale(H);return}k.wheelDelta<0&&w.value>.1&&(H=w.value-.05,t.setScale(H))}},K=()=>{if(!r.value)return;const k=r.value.getBoundingClientRect(),H=c.value.getBoundingClientRect();f.value=(k.left+Xt-H.left)/w.value,p.value=(k.top+Xt-H.top)/w.value},Y=k=>{var E,T;if(k.preventDefault(),k.stopPropagation(),k.which==2)u.value=!0;else if(!((E=window.$KeyboardActive)!=null&&E.space))return;(T=document.activeElement)==null||T.blur();const H=k.pageX,O=k.pageY,h=xe(window,"mousemove",D=>{const b=D.pageX-H,q=D.pageY-O,[F,ut]=o,[lt,gt]=a;o=[ut,b],a=[gt,q],r.value.scrollLeft-=ut>F?Math.abs(ut-F):-Math.abs(ut-F),r.value.scrollTop-=gt>lt?Math.abs(gt-lt):-Math.abs(gt-lt)}),_=xe(window,"mouseup",()=>{h(),_(),o=[0,0],a=[0,0],u.value=!1})},N=()=>{const k=document.getElementById("go-chart-edit-layout");return k?{height:k.clientHeight-25,width:k.clientWidth}:{width:d.value,height:v.value}},S=()=>{g.value=!1,setTimeout(()=>{g.value=!0},10)},Z=()=>{const{width:k,height:H}=i.value.getBoundingClientRect(),{width:O,height:h}=N();r.value.scrollLeft=k/2-O/2,r.value.scrollTop=H/2-h/2};return pt(()=>n.getDarkTheme,()=>{S()}),pt(()=>w.value,(k,H)=>{H!==k&&e.getRePositionCanvas?(e.setItemUnHandle(jt.RE_POSITION_CANVAS,!1),K(),setTimeout(()=>{Z(),S()},400)):nt(S,20)}),pt(()=>u.value,k=>{l.value=k?"grab":"auto"}),ee(()=>{r.value&&(r.value.addEventListener("wheel",R,{passive:!1}),Z())}),be(()=>{r.value&&r.value.removeEventListener("wheel",R)}),window.onKeySpacePressHold=k=>{u.value=k},(k,H)=>{const O=at("sketch-rule");return P(),J("div",ts,[g.value?(P(),G(O,{key:0,thick:Xt,scale:w.value,width:N().width,height:N().height,startX:f.value,startY:p.value,lines:y,palette:$.value},null,8,["scale","width","height","startX","startY","lines","palette"])):kt("",!0),B("div",{ref_key:"$app",ref:r,class:"edit-screens",onScroll:K},[B("div",{ref_key:"$container",ref:i,class:"edit-screen-container",style:rt({width:C(d)*2+"px"})},[B("div",{ref_key:"refSketchRuleBox",ref:c,class:"canvas",onMousedown:Y,style:rt({marginLeft:"-"+(N().width/2-25)+"px"})},[B("div",{style:rt({pointerEvents:u.value?"none":"auto"})},[ne(k.$slots,"default",{},void 0,!0)],4)],36)],4)],544),C(n).getDarkTheme?(P(),J("div",es)):kt("",!0)])}}}),ss=mt(ns,[["__scopeId","data-v-9b7f266a"]]),os="/static/png/1.png";/*!
 * Signature Pad v4.1.5 | https://github.com/szimek/signature_pad
 * (c) 2023 Szymon Nowak | Released under the MIT license
 */class It{constructor(t,e,n,o){if(isNaN(t)||isNaN(e))throw new Error(`Point is invalid: (${t}, ${e})`);this.x=+t,this.y=+e,this.pressure=n||0,this.time=o||Date.now()}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}equals(t){return this.x===t.x&&this.y===t.y&&this.pressure===t.pressure&&this.time===t.time}velocityFrom(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):0}}class le{constructor(t,e,n,o,a,r){this.startPoint=t,this.control2=e,this.control1=n,this.endPoint=o,this.startWidth=a,this.endWidth=r}static fromPoints(t,e){const n=this.calculateControlPoints(t[0],t[1],t[2]).c2,o=this.calculateControlPoints(t[1],t[2],t[3]).c1;return new le(t[1],n,o,t[2],e.start,e.end)}static calculateControlPoints(t,e,n){const o=t.x-e.x,a=t.y-e.y,r=e.x-n.x,g=e.y-n.y,c={x:(t.x+e.x)/2,y:(t.y+e.y)/2},i={x:(e.x+n.x)/2,y:(e.y+n.y)/2},u=Math.sqrt(o*o+a*a),l=Math.sqrt(r*r+g*g),d=c.x-i.x,v=c.y-i.y,f=l/(u+l),p={x:i.x+d*f,y:i.y+v*f},y=e.x-p.x,w=e.y-p.y;return{c1:new It(c.x+y,c.y+w),c2:new It(i.x+y,i.y+w)}}length(){let e=0,n,o;for(let a=0;a<=10;a+=1){const r=a/10,g=this.point(r,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),c=this.point(r,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(a>0){const i=g-n,u=c-o;e+=Math.sqrt(i*i+u*u)}n=g,o=c}return e}point(t,e,n,o,a){return e*(1-t)*(1-t)*(1-t)+3*n*(1-t)*(1-t)*t+3*o*(1-t)*t*t+a*t*t*t}}class as{constructor(){try{this._et=new EventTarget}catch(t){this._et=document}}addEventListener(t,e,n){this._et.addEventListener(t,e,n)}dispatchEvent(t){return this._et.dispatchEvent(t)}removeEventListener(t,e,n){this._et.removeEventListener(t,e,n)}}function rs(s,t=250){let e=0,n=null,o,a,r;const g=()=>{e=Date.now(),n=null,o=s.apply(a,r),n||(a=null,r=[])};return function(...i){const u=Date.now(),l=t-(u-e);return a=this,r=i,l<=0||l>t?(n&&(clearTimeout(n),n=null),e=u,o=s.apply(a,r),n||(a=null,r=[])):n||(n=window.setTimeout(g,l)),o}}class $t extends as{constructor(t,e={}){super(),this.canvas=t,this._drawningStroke=!1,this._isEmpty=!0,this._lastPoints=[],this._data=[],this._lastVelocity=0,this._lastWidth=0,this._handleMouseDown=n=>{n.buttons===1&&(this._drawningStroke=!0,this._strokeBegin(n))},this._handleMouseMove=n=>{this._drawningStroke&&this._strokeMoveUpdate(n)},this._handleMouseUp=n=>{n.buttons===1&&this._drawningStroke&&(this._drawningStroke=!1,this._strokeEnd(n))},this._handleTouchStart=n=>{if(n.cancelable&&n.preventDefault(),n.targetTouches.length===1){const o=n.changedTouches[0];this._strokeBegin(o)}},this._handleTouchMove=n=>{n.cancelable&&n.preventDefault();const o=n.targetTouches[0];this._strokeMoveUpdate(o)},this._handleTouchEnd=n=>{if(n.target===this.canvas){n.cancelable&&n.preventDefault();const a=n.changedTouches[0];this._strokeEnd(a)}},this._handlePointerStart=n=>{this._drawningStroke=!0,n.preventDefault(),this._strokeBegin(n)},this._handlePointerMove=n=>{this._drawningStroke&&(n.preventDefault(),this._strokeMoveUpdate(n))},this._handlePointerEnd=n=>{this._drawningStroke&&(n.preventDefault(),this._drawningStroke=!1,this._strokeEnd(n))},this.velocityFilterWeight=e.velocityFilterWeight||.7,this.minWidth=e.minWidth||.5,this.maxWidth=e.maxWidth||2.5,this.throttle="throttle"in e?e.throttle:16,this.minDistance="minDistance"in e?e.minDistance:5,this.dotSize=e.dotSize||0,this.penColor=e.penColor||"black",this.backgroundColor=e.backgroundColor||"rgba(0,0,0,0)",this._strokeMoveUpdate=this.throttle?rs($t.prototype._strokeUpdate,this.throttle):$t.prototype._strokeUpdate,this._ctx=t.getContext("2d"),this.clear(),this.on()}clear(){const{_ctx:t,canvas:e}=this;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._data=[],this._reset(this._getPointGroupOptions()),this._isEmpty=!0}fromDataURL(t,e={}){return new Promise((n,o)=>{const a=new Image,r=e.ratio||window.devicePixelRatio||1,g=e.width||this.canvas.width/r,c=e.height||this.canvas.height/r,i=e.xOffset||0,u=e.yOffset||0;this._reset(this._getPointGroupOptions()),a.onload=()=>{this._ctx.drawImage(a,i,u,g,c),n()},a.onerror=l=>{o(l)},a.crossOrigin="anonymous",a.src=t,this._isEmpty=!1})}toDataURL(t="image/png",e){switch(t){case"image/svg+xml":return typeof e!="object"&&(e=void 0),`data:image/svg+xml;base64,${btoa(this.toSVG(e))}`;default:return typeof e!="number"&&(e=void 0),this.canvas.toDataURL(t,e)}}on(){this.canvas.style.touchAction="none",this.canvas.style.msTouchAction="none",this.canvas.style.userSelect="none";const t=/Macintosh/.test(navigator.userAgent)&&"ontouchstart"in document;window.PointerEvent&&!t?this._handlePointerEvents():(this._handleMouseEvents(),"ontouchstart"in window&&this._handleTouchEvents())}off(){this.canvas.style.touchAction="auto",this.canvas.style.msTouchAction="auto",this.canvas.style.userSelect="auto",this.canvas.removeEventListener("pointerdown",this._handlePointerStart),this.canvas.removeEventListener("pointermove",this._handlePointerMove),this.canvas.ownerDocument.removeEventListener("pointerup",this._handlePointerEnd),this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove),this.canvas.ownerDocument.removeEventListener("mouseup",this._handleMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove),this.canvas.removeEventListener("touchend",this._handleTouchEnd)}isEmpty(){return this._isEmpty}fromData(t,{clear:e=!0}={}){e&&this.clear(),this._fromData(t,this._drawCurve.bind(this),this._drawDot.bind(this)),this._data=this._data.concat(t)}toData(){return this._data}_getPointGroupOptions(t){return{penColor:t&&"penColor"in t?t.penColor:this.penColor,dotSize:t&&"dotSize"in t?t.dotSize:this.dotSize,minWidth:t&&"minWidth"in t?t.minWidth:this.minWidth,maxWidth:t&&"maxWidth"in t?t.maxWidth:this.maxWidth,velocityFilterWeight:t&&"velocityFilterWeight"in t?t.velocityFilterWeight:this.velocityFilterWeight}}_strokeBegin(t){this.dispatchEvent(new CustomEvent("beginStroke",{detail:t}));const e=this._getPointGroupOptions(),n=Object.assign(Object.assign({},e),{points:[]});this._data.push(n),this._reset(e),this._strokeUpdate(t)}_strokeUpdate(t){if(this._data.length===0){this._strokeBegin(t);return}this.dispatchEvent(new CustomEvent("beforeUpdateStroke",{detail:t}));const e=t.clientX,n=t.clientY,o=t.pressure!==void 0?t.pressure:t.force!==void 0?t.force:0,a=this._createPoint(e,n,o),r=this._data[this._data.length-1],g=r.points,c=g.length>0&&g[g.length-1],i=c?a.distanceTo(c)<=this.minDistance:!1,u=this._getPointGroupOptions(r);if(!c||!(c&&i)){const l=this._addPoint(a,u);c?l&&this._drawCurve(l,u):this._drawDot(a,u),g.push({time:a.time,x:a.x,y:a.y,pressure:a.pressure})}this.dispatchEvent(new CustomEvent("afterUpdateStroke",{detail:t}))}_strokeEnd(t){this._strokeUpdate(t),this.dispatchEvent(new CustomEvent("endStroke",{detail:t}))}_handlePointerEvents(){this._drawningStroke=!1,this.canvas.addEventListener("pointerdown",this._handlePointerStart),this.canvas.addEventListener("pointermove",this._handlePointerMove),this.canvas.ownerDocument.addEventListener("pointerup",this._handlePointerEnd)}_handleMouseEvents(){this._drawningStroke=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove),this.canvas.ownerDocument.addEventListener("mouseup",this._handleMouseUp)}_handleTouchEvents(){this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove),this.canvas.addEventListener("touchend",this._handleTouchEnd)}_reset(t){this._lastPoints=[],this._lastVelocity=0,this._lastWidth=(t.minWidth+t.maxWidth)/2,this._ctx.fillStyle=t.penColor}_createPoint(t,e,n){const o=this.canvas.getBoundingClientRect();return new It(t-o.left,e-o.top,n,new Date().getTime())}_addPoint(t,e){const{_lastPoints:n}=this;if(n.push(t),n.length>2){n.length===3&&n.unshift(n[0]);const o=this._calculateCurveWidths(n[1],n[2],e),a=le.fromPoints(n,o);return n.shift(),a}return null}_calculateCurveWidths(t,e,n){const o=n.velocityFilterWeight*e.velocityFrom(t)+(1-n.velocityFilterWeight)*this._lastVelocity,a=this._strokeWidth(o,n),r={end:a,start:this._lastWidth};return this._lastVelocity=o,this._lastWidth=a,r}_strokeWidth(t,e){return Math.max(e.maxWidth/(t+1),e.minWidth)}_drawCurveSegment(t,e,n){const o=this._ctx;o.moveTo(t,e),o.arc(t,e,n,0,2*Math.PI,!1),this._isEmpty=!1}_drawCurve(t,e){const n=this._ctx,o=t.endWidth-t.startWidth,a=Math.ceil(t.length())*2;n.beginPath(),n.fillStyle=e.penColor;for(let r=0;r<a;r+=1){const g=r/a,c=g*g,i=c*g,u=1-g,l=u*u,d=l*u;let v=d*t.startPoint.x;v+=3*l*g*t.control1.x,v+=3*u*c*t.control2.x,v+=i*t.endPoint.x;let f=d*t.startPoint.y;f+=3*l*g*t.control1.y,f+=3*u*c*t.control2.y,f+=i*t.endPoint.y;const p=Math.min(t.startWidth+i*o,e.maxWidth);this._drawCurveSegment(v,f,p)}n.closePath(),n.fill()}_drawDot(t,e){const n=this._ctx,o=e.dotSize>0?e.dotSize:(e.minWidth+e.maxWidth)/2;n.beginPath(),this._drawCurveSegment(t.x,t.y,o),n.closePath(),n.fillStyle=e.penColor,n.fill()}_fromData(t,e,n){for(const o of t){const{points:a}=o,r=this._getPointGroupOptions(o);if(a.length>1)for(let g=0;g<a.length;g+=1){const c=a[g],i=new It(c.x,c.y,c.pressure,c.time);g===0&&this._reset(r);const u=this._addPoint(i,r);u&&e(u,r)}else this._reset(r),n(a[0],r)}}toSVG({includeBackgroundColor:t=!1}={}){const e=this._data,n=Math.max(window.devicePixelRatio||1,1),o=0,a=0,r=this.canvas.width/n,g=this.canvas.height/n,c=document.createElementNS("http://www.w3.org/2000/svg","svg");if(c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),c.setAttribute("viewBox",`${o} ${a} ${r} ${g}`),c.setAttribute("width",r.toString()),c.setAttribute("height",g.toString()),t&&this.backgroundColor){const i=document.createElement("rect");i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("fill",this.backgroundColor),c.appendChild(i)}return this._fromData(e,(i,{penColor:u})=>{const l=document.createElement("path");if(!isNaN(i.control1.x)&&!isNaN(i.control1.y)&&!isNaN(i.control2.x)&&!isNaN(i.control2.y)){const d=`M ${i.startPoint.x.toFixed(3)},${i.startPoint.y.toFixed(3)} C ${i.control1.x.toFixed(3)},${i.control1.y.toFixed(3)} ${i.control2.x.toFixed(3)},${i.control2.y.toFixed(3)} ${i.endPoint.x.toFixed(3)},${i.endPoint.y.toFixed(3)}`;l.setAttribute("d",d),l.setAttribute("stroke-width",(i.endWidth*2.25).toFixed(3)),l.setAttribute("stroke",u),l.setAttribute("fill","none"),l.setAttribute("stroke-linecap","round"),c.appendChild(l)}},(i,{penColor:u,dotSize:l,minWidth:d,maxWidth:v})=>{const f=document.createElement("circle"),p=l>0?l:(d+v)/2;f.setAttribute("r",p.toString()),f.setAttribute("cx",i.x.toString()),f.setAttribute("cy",i.y.toString()),f.setAttribute("fill",u),c.appendChild(f)}),c.outerHTML}}const is={class:"list-content"},cs={class:"list-content-img"},ls={ref:"signatureCanvas",id:"signatureCanvas"},us=ft({__name:"index",props:{modalShow:{required:!0,type:Boolean}},emits:["close","edit"],setup(s,{emit:t}){const e=s,{HammerIcon:n}=Ue.ionicons5,o=z(!1),a=ct();let r;pt(()=>e.modalShow,l=>{o.value=l,l&&Oe(()=>{const d=document.getElementById("signatureCanvas");d.width=1e3,d.height=600,d.style.backgroundColor="#FFFFFF",r=new $t(d,{penColor:"black",backgroundColor:"rgba(0, 0, 0, 0)",minWidth:2,maxWidth:5})})},{immediate:!0});const g=se([{label:nn("global.r_edit"),key:"edit",icon:sn(n)}]),c=l=>{switch(l){case"edit":i();break}},i=()=>{const l=r.toDataURL();a.setSingCanvas(l)},u=()=>{t("close")};return(l,d)=>{const v=at("n-text"),f=at("n-space"),p=at("n-time"),y=at("n-button"),w=at("n-tooltip"),L=at("n-card"),$=at("n-modal");return P(),G($,{class:"go-modal-box",show:o.value,"onUpdate:show":d[0]||(d[0]=M=>o.value=M),onAfterLeave:u},{default:A(()=>[W(L,{hoverable:"",size:"small"},{action:A(()=>[W(f,{class:"list-footer",justify:"space-between"},{default:A(()=>[W(v,{depth:"3"},{default:A(()=>[At(Mt(l.$t("project.last_edit"))+": ",1),W(p,{time:new Date,format:"yyyy-MM-dd hh:mm"},null,8,["time"])]),_:1}),W(f,null,{default:A(()=>[(P(!0),J(yt,null,St(g,M=>(P(),G(w,{key:M.key,placement:"bottom",trigger:"hover"},{trigger:A(()=>[W(y,{size:"small",onClick:R=>c(M.key)},{icon:A(()=>[(P(),G(vt(M.icon)))]),_:2},1032,["onClick"])]),default:A(()=>[(P(),G(vt(M.label)))]),_:2},1024))),128))]),_:1})]),_:1})]),default:A(()=>[B("div",is,[W(f,{class:"list-content-top go-px-0",justify:"center"},{default:A(()=>[W(f,null,{default:A(()=>[W(v,null,{default:A(()=>[At(" 签名 ")]),_:1})]),_:1})]),_:1}),W(f,{class:"list-content-top"},{default:A(()=>[W(C(xn),{narrow:!0,hidden:["close"],onRemove:u})]),_:1}),B("div",cs,[B("canvas",ls,null,512)])])]),_:1})]),_:1},8,["show"])}}}),ds=mt(us,[["__scopeId","data-v-7c0abf82"]]),hs=s=>s,fs=(s,t)=>{try{if(t.id){const e="vnodeBeforeMount"in t.events,n="vnodeMounted"in t.events;return e&&(s.events.advancedEvents.vnodeBeforeMount=t==null?void 0:t.events.vnodeBeforeMount),n&&(s.events.advancedEvents.vnodeMounted=t==null?void 0:t.events.vnodeMounted),(e||n)&&(t.events={baseEvent:{[bt.ON_CLICK]:void 0,[bt.ON_DBL_CLICK]:void 0,[bt.ON_MOUSE_ENTER]:void 0,[bt.ON_MOUSE_LEAVE]:void 0},advancedEvents:{[pe.VNODE_MOUNTED]:void 0,[pe.VNODE_BEFORE_MOUNT]:void 0},interactEvents:[]}),s}}catch(e){return s}},_t=(s,t,e=!1)=>{if(fs(s,t),e)return Yt(s,t);const n=t.option;if(!n)return Yt(s,t);if(t.option=void 0,n)return wt(U({},Yt(s,t)),{option:n})},Ye=()=>{const s=ct(),t=dn(),e=He();return{updateComponent:(o,a=!1,r=!1)=>dt(void 0,null,function*(){a&&(s.componentList=[],t.clearBackStack(),t.clearForwardStack()),o.editCanvasConfig=hs(o.editCanvasConfig),o.componentList.forEach(c=>dt(void 0,null,function*(){const i=u=>{window.$vue.component(u.chartConfig.chartKey)||(window.$vue.component(u.chartConfig.chartKey,gn(u.chartConfig)),window.$vue.component(u.chartConfig.conKey,vn(u.chartConfig)))};c.isGroup?c.groupList.forEach(u=>{i(u)}):i(c)}));const g=(c,i)=>dt(void 0,null,function*(){let u=yield $e(c.chartConfig);i?i(r?_t(u,wt(U({},c),{id:Ft()})):_t(u,c)):r?s.addComponentList(_t(u,wt(U({},c),{id:Ft()})),!1,!0):s.addComponentList(_t(u,c),!1,!0)});for(const c in o)if(c===hn.COMPONENT_LIST){let i=0;const u=o[c].length;for(const l of o[c]){let d=parseInt((parseFloat(`${++i/u}`)*100).toString());if(e.setItemUnHandle(jt.PERCENTAGE,d),l.isGroup){let v=new fn;r?v=_t(v,wt(U({},l),{id:Ft()})):v=_t(v,l);const f=[];for(const p of l.groupList)yield g(p,y=>{f.push(y)});v.groupList=f,s.addComponentList(v,!1,!0)}else yield g(l)}}else{if(c!=="editCanvasConfig"&&c!=="requestGlobalConfig")return;_t(s[c],o[c],!0)}e.setItemUnHandle(jt.PERCENTAGE,0)})}},gs=()=>{const s=z(),{updateComponent:t}=Ye();return{importUploadFileListRef:s,importBeforeUpload:({file:o})=>{s.value=[];const a=o.file.type;return a!==Ce.JSON&&a!==Ce.TXT?(window.$message.warning("仅支持上传 【JSON】 格式文件，请重新上传！"),!1):!0},importCustomRequest:o=>{const{file:a}=o;Oe(()=>{a.file?Sn(a.file).then(r=>{Cn({message:"请选择导入方式:",positiveText:"新增（可撤回）",negativeText:"覆盖（不可撤回）",negativeButtonProps:{type:"info",ghost:!1},onPositiveCallback:()=>dt(void 0,null,function*(){try{r=zt(r),yield t(r,!1,!0),window.$message.success("导入成功！")}catch(g){console.log(g),window.$message.error("组件导入失败，请检查文件完整性!")}}),onNegativeCallback:()=>dt(void 0,null,function*(){try{r=zt(r),yield t(r,!0,!0),window.$message.success("导入成功！")}catch(g){console.log(g),window.$message.error("组件导入失败，请检查文件完整性!")}})})}):window.$message.error("导入失败，请检查数据或联系管理员！")})}}},{updateComponent:vs}=Ye(),Ne=ct(),ke=()=>{dispatchEvent(new CustomEvent(Pt.CHART_TO_PREVIEW,{detail:Ne.getStorageInfo}))},ps=()=>{const s=a=>{window.$message.success("正在进行更新..."),vs(a.detail,!0)},t=()=>{Ne.setEditCanvas(st.IS_CODE_EDIT,!1)},e=()=>{addEventListener("blur",ke),addEventListener(Pt.JSON,s),addEventListener(Pt.CLOSE,nt(t,1e3))},n=()=>{removeEventListener("blur",ke),removeEventListener(Pt.JSON,s)};return(a,r)=>{r==me.CHART_HOME_NAME&&n(),a==me.CHART_HOME_NAME&&e()}},ms=()=>{const s=Ie();pt(()=>s.name,ps(),{immediate:!0})};var Et=(s=>(s.BUTTON="button",s.IMPORTUPLOAD="importUpload",s))(Et||{});const Ge=s=>(ae("data-v-39e832d6"),s=s(),re(),s),_s={class:"btn-item"},ys={class:"blt-modal"},Cs={class:"blt-modal-main"},ws=Ge(()=>B("img",{style:{width:"400px","margin-left":"20px"},src:os,alt:"#"},null,-1)),Es={class:"blt-modal-text"},xs=Ge(()=>B("div",null,"太棒了,恭喜你生成了一张属于你的数字艺术作品",-1)),Ss=ft({__name:"index",setup(s){const{DownloadIcon:t,ShareIcon:e,PawIcon:n,SettingsSharpIcon:o,CreateIcon:a,Refresh:r}=Ue.ionicons5,g=Ae(),c=ct();Ie(),ms();const i=z(!1);let u=null;const l=z(!1),d=z(!0),v=z(!0),{importUploadFileListRef:f,importCustomRequest:p,importBeforeUpload:y}=gs(),w=z(""),L=z("http://enjoyer.vueadmin.com/FrrQqKCTnoYwmrGLfAZePxF6hjxV"),$=z(!1),M=z(6e4),R=I(()=>g.getChartToolsStatus===_e.ASIDE),K=I(()=>g.getChartToolsStatusHide),Y=I(()=>d.value&&K.value),N=I(()=>{if(!R.value)return T;const D=[];return T.map(b=>{D.unshift(b)}),D}),S=()=>{u=setTimeout(()=>{d.value&&(d.value=!1,v.value=!0)},200),setTimeout(()=>{v.value=!1},400)},Z=()=>{clearTimeout(u),d.value||(d.value=!0)},k=()=>{console.log(1),c.emptyComponentList()},H=()=>{i.value=!0},O=()=>{i.value=!1},h=D=>{if(D.indexOf("=")>0){var b=D.indexOf("=");D=D.substring(0,b)}return parseInt(D.length-D.length/8*2+"")},_=()=>{M.value<=0?$.value=!1:(M.value-=1e3,setTimeout(_,1e3))},E=()=>dt(this,null,function*(){const D=document.querySelector(".go-edit-range"),b=yield an(D,{backgroundColor:null});console.log("canvasImage",b);const q="fEFtyOAP4KqE5j0KIGK4Dg0X9xHDjMo2OnQnk4w4:TnrvaVkukV-7tDQB3RNbzvLfsXg=:eyJzY29wZSI6InRpbWVzYXBjZTIwMjMwNTA1IiwiZGVhZGxpbmUiOjE4ODMyOTY0ODR9";let F=b.toDataURL();F=F.replace("data:image/png;base64,",""),F=F.replace("data:image/jpeg;base64,",""),F=F.replace("data:image/jpg;base64,",""),F=F.replace("data:image/gif;base64,","");const ut="https://upload-z1.qiniup.com/putb64/"+h(F),lt=new XMLHttpRequest;lt.open("POST",ut,!0),lt.setRequestHeader("Content-Type","application/octet-stream"),lt.setRequestHeader("Authorization","UpToken "+q),lt.send(F),lt.onreadystatechange=()=>dt(this,null,function*(){if(lt.readyState===4){const gt=JSON.parse(lt.responseText).key;w.value="data:image/png;base64,"+F,L.value="http://enjoyer.vueadmin.com/"+gt,$.value=!0,M.value=6e4,_()}})}),T=[{key:"refresh",type:Et.BUTTON,name:"重置",icon:r,handle:k},{key:"sign",type:Et.BUTTON,name:"签名",icon:a,handle:H},{key:"create",type:Et.BUTTON,name:"生成",icon:t,handle:E}];return(D,b)=>{const q=at("n-icon"),F=at("n-text"),ut=at("n-button"),lt=at("n-upload"),gt=at("n-tooltip"),Ke=at("n-image"),Xe=at("n-modal");return P(),J(yt,null,[B("div",{class:ht(["go-chart-edit-tools",[C(g).getChartToolsStatus,Y.value?"isMini":"unMini"]]),onClick:b[1]||(b[1]=it=>d.value&&(d.value=!1)),onMouseenter:S,onMouseleave:Z},[Nt(W(q,{class:"asideLogo",size:"22"},{default:A(()=>[W(C(n))]),_:1},512),[[Gt,C(g).getChartToolsStatus===C(_e).ASIDE&&Y.value]]),(P(!0),J(yt,null,St(N.value,(it,ze)=>(P(),G(gt,{key:it.key+ze,disabled:!R.value||K.value&&v.value,trigger:"hover",placement:"left"},{trigger:A(()=>[B("div",_s,[it.type===C(Et).BUTTON?(P(),G(ut,{key:0,circle:R.value,secondary:"",onClick:it.handle},{icon:A(()=>[R.value?(P(),G(q,{key:0,size:"22"},{default:A(()=>[(P(),G(vt(it.icon)))]),_:2},1024)):(P(),G(vt(it.icon),{key:1}))]),default:A(()=>[Nt(W(F,{depth:"3"},{default:A(()=>[At(Mt(it.name),1)]),_:2},1536),[[Gt,!R.value]])]),_:2},1032,["circle","onClick"])):it.type===C(Et).IMPORTUPLOAD?(P(),G(lt,{key:1,"file-list":C(f),"onUpdate:fileList":b[0]||(b[0]=qe=>on(f)?f.value=qe:null),"show-file-list":!1,customRequest:C(p),onBeforeUpload:C(y)},{default:A(()=>[W(ut,{circle:R.value,secondary:""},{icon:A(()=>[R.value?(P(),G(q,{key:0,size:"22"},{default:A(()=>[(P(),G(vt(it.icon)))]),_:2},1024)):(P(),G(vt(it.icon),{key:1}))]),default:A(()=>[Nt(W(F,{depth:"3"},{default:A(()=>[At(Mt(it.name),1)]),_:2},1536),[[Gt,!R.value]])]),_:2},1032,["circle"])]),_:2},1032,["file-list","customRequest","onBeforeUpload"])):kt("",!0)])]),default:A(()=>[B("span",null,Mt(it.name),1)]),_:2},1032,["disabled"]))),128)),W(Xe,{show:$.value},{default:A(()=>[B("div",ys,[B("div",Cs,[W(Ke,{width:"700",height:"350",src:w.value},null,8,["src"]),ws]),B("div",Es,[xs,B("div",null,"扫描下方二维码带走它 "+Mt(M.value/1e3),1)]),W(pn,{class:"blt-group-qrcode",value:L.value,size:150,level:"H"},null,8,["value"])])]),_:1},8,["show"])],34),W(C(En),{modelShow:l.value,"onUpdate:modelShow":b[2]||(b[2]=it=>l.value=it)},null,8,["modelShow"]),W(C(ds),{modalShow:i.value,onClose:O},null,8,["modalShow"])],64)}}}),Ts=mt(Ss,[["__scopeId","data-v-39e832d6"]]);const Ms=s=>(ae("data-v-d2192888"),s=s(),re(),s),ks=Ms(()=>B("img",{src:Tn,style:{width:"1000px","margin-bottom":"20px"}},null,-1)),bs=ft({__name:"index",setup(s){const{GO_CHART_LAYOUT_STORE:t}=ln,e=ct(),{handleContextMenu:n}=ie();rn(mn,null),Mn();const{mouseenterHandle:o,mouseleaveHandle:a,mousedownHandle:r,mouseClickHandle:g,touchstartHandle:c}=ce(),i=(v,f,p)=>{if(e.getTargetChart.selectId.length>1)return f.filter(w=>[x.GROUP,x.DELETE].includes(w.key));const y=[];return p.status.lock?y.push(x.LOCK):y.push(x.UNLOCK),p.status.hide?y.push(x.HIDE):y.push(x.SHOW),v.filter(w=>!y.includes(w.key))},u=I(()=>e.getEditCanvasConfig.chartThemeSetting),l=I(()=>Pe(e.getEditCanvasConfig.chartCustomThemeColorInfo)[e.getEditCanvasConfig.chartThemeColor]);I(()=>e.getEditCanvasConfig.filterShow);const d=I(()=>{const v=e.getEditCanvasConfig.background,f=e.getEditCanvasConfig.backgroundImage,w=e.getEditCanvasConfig.selectColor?{background:v||void 0}:{background:`url(${f}) no-repeat center center / cover !important`};return wt(U({},w),{width:"inherit",height:"inherit"})});return ee(()=>{Pn(),cn(t,{layers:!1,charts:!0,details:!0,chartType:"double",layerType:"thumbnail",percentage:0,rePositionCanvas:!0})}),(v,f)=>(P(),G(C(wn),{id:"go-chart-edit-layout",flex:!0,showTop:!1,showBottom:!0,depth:1,xScroll:!0,disabledScroll:!0,onMousedown:C(We),onDrop:C(Rn),onDragover:C(Ee),onDragenter:C(Ee)},{aside:A(()=>[W(C(Ts))]),default:A(()=>[W(C(ss),null,{default:A(()=>[ks,B("div",{id:"go-chart-edit-content",onContextmenu:f[0]||(f[0]=(...p)=>C(n)&&C(n)(...p))},[W(C(Vn),null,{default:A(()=>[B("div",{style:rt(U(U({},C(Rt)(C(e).getEditCanvasConfig)),d.value))},[(P(!0),J(yt,null,St(C(e).getComponentList,(p,y)=>(P(),J("div",{key:p.id},[p.isGroup?(P(),G(C(Wn),{key:0,groupData:p,groupIndex:y},null,8,["groupData","groupIndex"])):(P(),G(C(Zt),{key:1,"data-id":p.id,index:y,style:rt(U(U({},C(Ot)(p.attr,y)),C(Re)(p.styles))),item:p,onClick:w=>C(g)(w,p),onMousedown:w=>C(r)(w,p),onMouseenter:w=>C(o)(w,p),onMouseleave:w=>C(a)(w,p),onContextmenu:w=>C(n)(w,p,i),onTouchstart:w=>C(c)(w,p)},{default:A(()=>[(P(),G(vt(p.chartConfig.chartKey),{class:ht(["edit-content-chart",C(qt)(p.styles.animations)]),chartConfig:p,themeSetting:u.value,themeColor:l.value,style:rt(U(U(U({},C(Ct)(p.attr)),C(Rt)(p.styles)),C(Vt)(p.styles)))},null,8,["class","chartConfig","themeSetting","themeColor","style"]))]),_:2},1032,["data-id","index","style","item","onClick","onMousedown","onMouseenter","onMouseleave","onContextmenu","onTouchstart"]))]))),128))],4)]),_:1})],32)]),_:1})]),_:1},8,["onMousedown","onDrop","onDragover","onDragenter"]))}}),js=mt(bs,[["__scopeId","data-v-d2192888"]]);export{js as default};
