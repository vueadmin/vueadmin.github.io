var It=Object.defineProperty,$t=Object.defineProperties;var Ht=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var Pt=Object.prototype.hasOwnProperty,Ut=Object.prototype.propertyIsEnumerable;var nt=(e,n,t)=>n in e?It(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,A=(e,n)=>{for(var t in n||(n={}))Pt.call(n,t)&&nt(e,t,n[t]);if(tt)for(var t of tt(n))Ut.call(n,t)&&nt(e,t,n[t]);return e},he=(e,n)=>$t(e,Ht(n));var ce=(e,n,t)=>new Promise((s,o)=>{var m=u=>{try{p(t.next(u))}catch(d){o(d)}},g=u=>{try{p(t.throw(u))}catch(d){o(d)}},p=u=>u.done?s(u.value):Promise.resolve(u.value).then(m,g);p((t=t.apply(e,n)).next())});import{n as Qe,a1 as Ct,a_ as Kt,ai as w,cz as yt,cA as _t,cB as ot,bb as W,aV as $e,cy as Bt,aC as Xe,cC as U,b1 as He,aj as Yt,c as fe,d as ie,b0 as be,u as r,m as Oe,a0 as O,o as D,e as z,f as Ze,F as me,s as we,ag as re,af as Q,a3 as _e,q as V,au as wt,B as N,w as K,G as ve,ao as Ge,ap as ke,aq as Fe,ar as Et,$ as St,p as Tt,ak as st,L as ue,Z as je,l as ee,cD as at,z as Nt,A as Xt,g as se,r as ge,M as Pe,cg as Ue,aL as Te,aM as rt,al as Gt,D as xt,J as it,az as Le,b8 as ct,Q as Ke,R as Be,h as lt,t as Ye,b5 as Ft,bh as Wt,x as zt,S as qt}from"./index-c9dad8bf.js";import{u as et,d as Jt}from"./index-ad373609.js";import{u as te,E as j,a as Vt,C as Qt,e as Zt}from"./chartEditStore-0e5a0895.js";import{d as Mt,f as jt,c as en,ap as tn}from"./index-64bc631f.js";import{a as nn,b as ut,l as on,g as sn}from"./plugin-1eef16fd.js";import{l as De}from"./lodash-e078968e.js";import{C as an}from"./index-a548d2b5.js";import{u as Lt,C as We}from"./chartLayoutStore-10dc909e.js";import{i as rn}from"./icon-15886a8d.js";import{G as cn}from"./index-5986fdaf.js";import{F as dt}from"./fileTypeEnum-21359a08.js";import{r as ln}from"./file-84751f49.js";import"./components-e968c9ab.js";import"./SettingItem-544752c3.js";/* empty css                                                                   */import"./SettingItemBox-bc9d859e.js";import"./CollapseItem-14795482.js";import"./index.esm.min-1ad5273e.js";import"./http-53628ac1.js";const ye=te(),un=()=>{Qe(()=>{ye.setEditCanvas(j.EDIT_LAYOUT_DOM,document.getElementById("go-chart-edit-layout")),ye.setEditCanvas(j.EDIT_CONTENT_DOM,document.getElementById("go-chart-edit-content"));const e=ye.listenerScale();Ct(()=>{ye.setEditCanvas(j.EDIT_LAYOUT_DOM,null),ye.setEditCanvas(j.EDIT_CONTENT_DOM,null),e()})})};var ze={},dn={get exports(){return ze},set exports(e){ze=e}};(function(e){(function(n){var t,s={},o={16:!1,18:!1,17:!1,91:!1},m="all",g={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},p={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},u=function(a){return p[a]||a.toUpperCase().charCodeAt(0)},d=[];for(t=1;t<20;t++)p["f"+t]=111+t;function h(a,f){for(var E=a.length;E--;)if(a[E]===f)return E;return-1}function c(a,f){if(a.length!=f.length)return!1;for(var E=0;E<a.length;E++)if(a[E]!==f[E])return!1;return!0}var i={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function C(a){for(t in o)o[t]=a[i[t]]}function l(a){var f,E,y,I,b,ae;if(f=a.keyCode,h(d,f)==-1&&d.push(f),(f==93||f==224)&&(f=91),f in o){o[f]=!0;for(y in g)g[y]==f&&(L[y]=!0);return}if(C(a),!!L.filter.call(this,a)&&f in s){for(ae=ne(),I=0;I<s[f].length;I++)if(E=s[f][I],E.scope==ae||E.scope=="all"){b=E.mods.length>0;for(y in o)(!o[y]&&h(E.mods,+y)>-1||o[y]&&h(E.mods,+y)==-1)&&(b=!1);(E.mods.length==0&&!o[16]&&!o[18]&&!o[17]&&!o[91]||b)&&E.method(a,E)===!1&&(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.cancelBubble&&(a.cancelBubble=!0))}}}function S(a){var f=a.keyCode,E,y=h(d,f);if(y>=0&&d.splice(y,1),(f==93||f==224)&&(f=91),f in o){o[f]=!1;for(E in g)g[E]==f&&(L[E]=!1)}}function v(){for(t in o)o[t]=!1;for(t in g)L[t]=!1}function L(a,f,E){var y,I;y=x(a),E===void 0&&(E=f,f="all");for(var b=0;b<y.length;b++)I=[],a=y[b].split("+"),a.length>1&&(I=P(a),a=[a[a.length-1]]),a=a[0],a=u(a),a in s||(s[a]=[]),s[a].push({shortcut:y[b],scope:f,method:E,key:y[b],mods:I})}function R(a,f){var E,y,I=[],b,ae,Ce;for(E=x(a),ae=0;ae<E.length;ae++){if(y=E[ae].split("+"),y.length>1&&(I=P(y),a=y[y.length-1]),a=u(a),f===void 0&&(f=ne()),!s[a])return;for(b=0;b<s[a].length;b++)Ce=s[a][b],Ce.scope===f&&c(Ce.mods,I)&&(s[a][b]={})}}function H(a){return typeof a=="string"&&(a=u(a)),h(d,a)!=-1}function k(){return d.slice(0)}function Z(a){var f=(a.target||a.srcElement).tagName;return!(f=="INPUT"||f=="SELECT"||f=="TEXTAREA")}for(t in g)L[t]=!1;function q(a){m=a||"all"}function ne(){return m||"all"}function oe(a){var f,E,y;for(f in s)for(E=s[f],y=0;y<E.length;)E[y].scope===a?E.splice(y,1):y++}function x(a){var f;return a=a.replace(/\s/g,""),f=a.split(","),f[f.length-1]==""&&(f[f.length-2]+=","),f}function P(a){for(var f=a.slice(0,a.length-1),E=0;E<f.length;E++)f[E]=g[f[E]];return f}function $(a,f,E){a.addEventListener?a.addEventListener(f,E,!1):a.attachEvent&&a.attachEvent("on"+f,function(){E(window.event)})}$(document,"keydown",function(a){l(a)}),$(document,"keyup",S),$(window,"focus",v);var T=n.key;function M(){var a=n.key;return n.key=T,a}n.key=L,n.key.setScope=q,n.key.getScope=ne,n.key.deleteScope=oe,n.key.filter=Z,n.key.isPressed=H,n.key.getPressedKeyCodes=k,n.key.noConflict=M,n.key.unbind=R,e.exports=L})(Kt)})(dn);const X=ze,G=te(),J=e=>`${yt.CTRL}+${e}`,xe=e=>`${yt.SHIFT}+${e}`,B={[w.ARROW_UP]:J("up"),[w.ARROW_RIGHT]:J("right"),[w.ARROW_DOWN]:J("down"),[w.ARROW_LEFT]:J("left"),[w.COPY]:J("c"),[w.CUT]:J("x"),[w.PARSE]:J("v"),[w.DELETE]:"delete",[w.BACK]:J("z"),[w.FORWORD]:J(xe("z")),[w.GROUP]:J("g"),[w.UN_GROUP]:J(xe("g")),[w.LOCK]:J("l"),[w.UNLOCK]:J(xe("l")),[w.HIDE]:J("h"),[w.SHOW]:J(xe("h"))},F=e=>`${_t.CTRL}+${e}`,Me=e=>`${_t.SHIFT}+${e}`,Y={[w.ARROW_UP]:F("arrowup"),[w.ARROW_RIGHT]:F("arrowright"),[w.ARROW_DOWN]:F("arrowdown"),[w.ARROW_LEFT]:F("arrowleft"),[w.COPY]:F("c"),[w.CUT]:F("x"),[w.PARSE]:F("v"),[w.DELETE]:F("backspace"),[w.BACK]:F("z"),[w.FORWORD]:F(Me("z")),[w.GROUP]:F("g"),[w.UN_GROUP]:F(Me("g")),[w.LOCK]:F("l"),[w.UNLOCK]:F(Me("l")),[w.HIDE]:F("h"),[w.SHOW]:F(Me("h"))},fn=[B.up,B.right,B.down,B.left,B.delete,B.copy,B.cut,B.parse,B.back,B.forward,B.group,B.unGroup,B.lock,B.unLock,B.hide,B.show],hn=[Y.up,Y.right,Y.down,Y.left,Y.delete,Y.copy,Y.cut,Y.parse,Y.back,Y.forward,Y.group,Y.unGroup,Y.lock,Y.unLock,Y.hide,Y.show],gn=()=>{window.$KeyboardActive={ctrl:!1,space:!1},document.onkeydown=e=>{const{keyCode:n}=e;if(n==32&&e.target==document.body&&e.preventDefault(),[17,32].includes(n)&&window.$KeyboardActive)switch(ot(e.keyCode),n){case 17:window.$KeyboardActive.ctrl=!0;break;case 32:window.$KeyboardActive.space=!0;break}},document.onkeyup=e=>{const{keyCode:n}=e;if(n==32&&e.target==document.body&&e.preventDefault(),[17,32].includes(n)&&window.$KeyboardActive)switch(ot(),n){case 17:window.$KeyboardActive.ctrl=!1;break;case 32:window.$KeyboardActive.space=!1;break}}},pn=()=>{const n=(t,s)=>{switch(s){case t.up:X(s,W(()=>(G.setMove(w.ARROW_UP),!1),50));break;case t.right:X(s,W(()=>(G.setMove(w.ARROW_RIGHT),!1),50));break;case t.down:X(s,W(()=>(G.setMove(w.ARROW_DOWN),!1),50));break;case t.left:X(s,W(()=>(G.setMove(w.ARROW_LEFT),!1),50));break;case t.delete:X(s,$e(()=>(G.removeComponentList(),!1),50));break;case t.copy:X(s,$e(()=>(G.setCopy(),!1),50));break;case t.cut:X(s,$e(()=>(G.setCut(),!1),50));break;case t.parse:X(s,W(()=>(G.setParse(),!1),50));break;case t.back:X(s,W(()=>(G.setBack(),!1),50));break;case t.forward:X(s,W(()=>(G.setForward(),!1),50));break;case t.group:X(s,W(()=>(G.setGroup(),!1),50));break;case t.unGroup:X(s,W(()=>(G.setUnGroup(),!1),50));break;case t.lock:X(s,W(()=>(G.setLock(),!1),50));break;case t.unLock:X(s,W(()=>(G.setUnLock(),!1),50));break;case t.hide:X(s,W(()=>(G.setHide(),!1),50));break;case t.show:X(s,W(()=>(G.setShow(),!1),50));break}};fn.forEach(t=>{n(B,t)}),hn.forEach(t=>{n(Y,t)}),gn()},_=te(),{onClickOutSide:vn}=et(),mn=e=>ce(void 0,null,function*(){e.preventDefault();try{nn();const n=e.dataTransfer.getData(Bt.DRAG_KEY);if(!n){ut();return}_.setEditCanvas(j.IS_CREATE,!1);const t=Xe(n);let s=yield Mt(t);U(s,e.offsetX-s.attr.w/2,e.offsetY-s.attr.h/2),_.addComponentList(s,!1,!0),_.setTargetSelectChart(s.id),ut()}catch(n){on(),window.$message.warning("图表正在研发中, 敬请期待...")}}),ft=e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")},kt=(e,n)=>{if(n){_.setTargetSelectChart(n.id);return}_.setTargetSelectChart(void 0)},Cn=(e,n)=>{var d;if(e.which==2||(d=window.$KeyboardActive)!=null&&d.space)return;kt();const t=e.offsetX,s=e.offsetY,o=e.screenX,m=e.screenY,g=_.getEditCanvas.scale;_.setMousePosition(void 0,void 0,t,s);const p=De.throttle(h=>{_.setTargetSelectChart(),_.setEditCanvas(j.IS_SELECT,!0);const c=t+h.screenX-o,i=s+h.screenY-m;_.setMousePosition(c,i);const C={x1:0,y1:0,x2:0,y2:0};c>t&&i>s?(C.x1=t,C.y1=s,C.x2=Math.round(t+(h.screenX-o)/g),C.y2=Math.round(s+(h.screenY-m)/g)):c>t&&i<s?(C.x1=t,C.y1=Math.round(s-(m-h.screenY)/g),C.x2=Math.round(t+(h.screenX-o)/g),C.y2=s):c<t&&i>s?(C.x1=Math.round(t-(o-h.screenX)/g),C.y1=s,C.x2=t,C.y2=Math.round(s+(h.screenY-m)/g)):(C.x1=Math.round(t-(o-h.screenX)/g),C.y1=Math.round(s-(m-h.screenY)/g),C.x2=t,C.y2=s),_.getComponentList.forEach(l=>{if(!_.getTargetChart.selectId.includes(l.id)){const{x:S,y:v,w:L,h:R}=l.attr,H={x1:S,y1:v,x2:S+L,y2:v+R};H.x1-C.x1>=0&&H.y1-C.y1>=0&&H.x2-C.x2<=0&&H.y2-C.y2<=0&&!l.status.lock&&!l.status.hide&&_.setTargetSelectChart(l.id,!0)}})},30),u=()=>{p.cancel(),_.setEditCanvas(j.IS_SELECT,!1),_.setMousePosition(0,0,0,0),document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",u)};document.addEventListener("mousemove",p),document.addEventListener("mouseup",u)},Dt=()=>({mouseClickHandle:(o,m)=>{var g;if(o.preventDefault(),o.stopPropagation(),!m.status.lock&&(g=window.$KeyboardActive)!=null&&g.ctrl)if(_.targetChart.selectId.includes(m.id)){const p=_.targetChart.selectId.filter(u=>u!==m.id);_.setTargetSelectChart(p)}else _.setTargetSelectChart(m.id,!0)},mousedownHandle:(o,m)=>{var v;if(o.preventDefault(),o.stopPropagation(),m.status.lock||(vn(),o.buttons===He.LEFT&&((v=window.$KeyboardActive)!=null&&v.ctrl)))return;const g=_.getTargetChart.selectId;if(o.buttons===He.RIGHT&&g.length>1&&g.includes(m.id)||(_.setTargetSelectChart(m.id),o.buttons===He.RIGHT))return;const p=_.getEditCanvas.scale,u=_.getEditCanvasConfig.width,d=_.getEditCanvasConfig.height,h=new Map;_.getTargetChart.selectId.forEach(L=>{const R=_.fetchTargetIndex(L);if(R!==-1){const{x:H,y:k,w:Z,h:q}=Yt(_.getComponentList[R]).attr;h.set(L,{x:H,y:k,w:Z,h:q})}});const c=o.screenX,i=o.screenY;let C=[];_.getTargetChart.selectId.forEach(L=>{if(!h.has(L))return;const R=_.fetchTargetIndex(L);C.push(De.cloneDeep(_.getComponentList[R]))}),_.setMousePosition(void 0,void 0,c,i);const l=De.throttle(L=>{_.setEditCanvas(j.IS_DRAG,!0),_.setMousePosition(L.screenX,L.screenY);let R=(L.screenX-c)/p,H=(L.screenY-i)/p;_.getTargetChart.selectId.forEach(k=>{if(!h.has(k))return;const Z=_.fetchTargetIndex(k),{x:q,y:ne,w:oe,h:x}=h.get(k),P=_.getComponentList[Z];let $=Math.round(q+R),T=Math.round(ne+H);const M=50;$=$<-oe+M?-oe+M:$,T=T<-x+M?-x+M:T,$=$>u-M?u-M:$,T=T>d-M?d-M:T,P&&(P.attr=Object.assign(P.attr,{x:$,y:T}))})},20),S=()=>{try{_.setMousePosition(0,0,0,0),_.setEditCanvas(j.IS_DRAG,!1),C.length&&(_.getTargetChart.selectId.forEach(L=>{if(!h.has(L))return;const R=_.fetchTargetIndex(L),H=_.getComponentList[R];C.forEach(k=>{k.id===L&&(k.attr=Object.assign(k.attr,{offsetX:H.attr.x-k.attr.x,offsetY:H.attr.y-k.attr.y}))})}),_.moveComponentList(C)),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",S)}catch(L){console.log(L)}};document.addEventListener("mousemove",l),document.addEventListener("mouseup",S)},mouseenterHandle:(o,m)=>{o.preventDefault(),o.stopPropagation(),_.getEditCanvas.isSelect||_.setTargetHoverChart(m.id)},mouseleaveHandle:(o,m)=>{o.preventDefault(),o.stopPropagation(),_.setEditCanvas(j.IS_DRAG,!1),_.setTargetHoverChart(void 0)}}),yn=(e,n,t)=>{e.stopPropagation(),e.preventDefault(),_.setEditCanvas(j.IS_DRAG,!0);const s=_.getEditCanvas.scale,o=t.x,m=t.y,g=t.w,p=t.h,u=e.screenX,d=e.screenY;_.setMousePosition(u,d);const h=De.throttle(i=>{_.setMousePosition(i.screenX,i.screenY);let C=Math.round((i.screenX-u)/s),l=Math.round((i.screenY-d)/s);const S=/t/.test(n),v=/b/.test(n),L=/l/.test(n),R=/r/.test(n),H=p+(S?-l:v?l:0),k=g+(L?-C:R?C:0);t.h=H>0?H:0,t.w=k>0?k:0,t.x=o+(L?C:0),t.y=m+(S?l:0)},50),c=()=>{_.setEditCanvas(j.IS_DRAG,!1),_.setMousePosition(0,0,0,0),document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",h),document.addEventListener("mouseup",c)},Re=(e,n)=>e?{zIndex:e.zIndex===-1?n+1:e.zIndex+n+1,left:`${e.x}px`,top:`${e.y}px`}:{},de=(e,n)=>e?{width:`${n?n*e.w:e.w}px`,height:`${n?n*e.h:e.h}px`}:{},_n=(e,n,t,s)=>{const{w:o,h:m}=t,g=/t/.test(e),p=/b/.test(e),u=/l/.test(e),d=/r/.test(e);let h=0,c=0;return e.length===2?(h=u?0:o,c=g?0:m):((g||p)&&(h=o/2,c=g?0:m),(u||d)&&(h=u?0:o,c=Math.floor(m/2))),{left:`${h}px`,top:`${c}px`,cursor:s[n]+"-resize"}};const wn=["onMousedown"],En=ie({__name:"index",props:{item:{type:Object,required:!0},hiddenPoint:{type:Boolean,required:!1}},setup(e){const n=e;be(c=>({"6f41483b":r(g)}));const t=Oe(),s=te(),o=["t","r","b","l","lt","rt","lb","rb"],m=["n","e","s","w","nw","ne","sw","se"],g=O(()=>t.getAppTheme),p=O(()=>n.item.status.lock?!1:n.item.id===s.getTargetChart.hoverId),u=O(()=>{const c=n.item.id;return n.item.status.lock?!1:s.getTargetChart.selectId.find(i=>i===c)}),d=O(()=>n.item.status.lock),h=O(()=>n.item.status.hide);return(c,i)=>(D(),z("div",{class:re(["go-shape-box",{lock:r(d),hide:r(h)}])},[Ze(c.$slots,"default",{},void 0,!0),e.hiddenPoint?_e("",!0):(D(!0),z(me,{key:0},we(r(u)?o:[],(C,l)=>(D(),z("div",{class:re(`shape-point ${C}`),key:l,style:Q(r(_n)(C,l,e.item.attr,m)),onMousedown:S=>r(yn)(S,C,e.item.attr)},null,46,wn))),128)),V("div",{class:"shape-modal",style:Q(r(de)(e.item.attr))},[V("div",{class:re(["shape-modal-select",{active:r(u)}])},null,2),V("div",{class:re(["shape-modal-change",{selectActive:r(u),hoverActive:r(p)}])},null,2)],4)],2))}}),qe=fe(En,[["__scopeId","data-v-f03fb462"]]),Sn={class:"go-edit-group-box"},Tn=ie({__name:"index",props:{groupData:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(e){const n=te(),{handleContextMenu:t}=et(),{mouseenterHandle:s,mouseleaveHandle:o,mousedownHandle:m,mouseClickHandle:g}=Dt(),p=(h,c,i)=>{const C=l=>c.filter(S=>l.includes(S.key));if(n.getTargetChart.selectId.length>1)return C([w.GROUP,w.DELETE]);{const l=[];i.status.lock?l.push(w.LOCK):l.push(w.UNLOCK),i.status.hide?l.push(w.HIDE):l.push(w.SHOW);const S=[w.UN_GROUP];return[...C(S),Jt(),...h.filter(v=>!l.includes(v.key))]}},u=O(()=>wt(n.getEditCanvasConfig.chartCustomThemeColorInfo)[n.getEditCanvasConfig.chartThemeColor]),d=O(()=>n.getEditCanvasConfig.chartThemeSetting);return(h,c)=>(D(),z("div",Sn,[(D(),N(r(qe),{key:e.groupData.id,"data-id":e.groupData.id,index:e.groupIndex,item:e.groupData,hiddenPoint:!0,class:re(r(Ge)(e.groupData.styles.animations)),style:Q(A(A(A(A(A({},r(Re)(e.groupData.attr,e.groupIndex)),r(de)(e.groupData.attr)),r(ke)(e.groupData.styles)),r(Fe)(e.groupData.styles)),r(Et)(e.groupData.styles))),onClick:c[0]||(c[0]=i=>r(g)(i,e.groupData)),onMousedown:c[1]||(c[1]=i=>r(m)(i,e.groupData)),onMouseenter:c[2]||(c[2]=i=>r(s)(i,e.groupData)),onMouseleave:c[3]||(c[3]=i=>r(o)(i,e.groupData)),onContextmenu:c[4]||(c[4]=i=>r(t)(i,e.groupData,p))},{default:K(()=>[(D(!0),z(me,null,we(e.groupData.groupList,i=>(D(),N(r(qe),{key:i.id,"data-id":i.id,index:e.groupIndex,item:i,hiddenPoint:!0,style:Q(A({},r(Re)(i.attr,e.groupIndex)))},{default:K(()=>[(D(),N(ve(i.chartConfig.chartKey),{class:re(["edit-content-chart",r(Ge)(i.styles.animations)]),chartConfig:i,themeSetting:r(d),themeColor:r(u),style:Q(A(A(A({},r(de)(i.attr)),r(ke)(i.styles)),r(Fe)(i.styles)))},null,8,["class","chartConfig","themeSetting","themeColor","style"]))]),_:2},1032,["data-id","index","item","style"]))),128))]),_:1},8,["data-id","index","item","class","style"]))]))}});const xn={class:"go-edit-align-line"},Mn=ie({__name:"index",setup(e){be(l=>({42514545:r(g)}));const n=Oe(),t=te(),s=St(),o=Tt({lineArr:["rowt","rowc","rowb","coll","colc","colr"],select:new Map,sorptioned:{x:!1,y:!1}}),m=l=>l?{left:`${l.x?l.x:0}px`,top:`${l.y?l.y:0}px`}:{},g=O(()=>n.getAppTheme),p=O(()=>s.getChartAlignRange),u=O(()=>t.getEditCanvas[j.IS_DRAG]),d=(l,S)=>Math.abs(l-S)<=p.value,h=O(()=>t.getTargetChart.selectId),c=O(()=>t.getComponentList[t.fetchTargetIndex()]),i=O(()=>{var l;return((l=c.value)==null?void 0:l.attr)||{}}),C=O(()=>({id:"0",attr:{w:st(t.getEditCanvasConfig.width),h:st(t.getEditCanvasConfig.height),x:0,y:0,offsetX:0,offsetY:0,zIndex:0}}));return ue(()=>t.getMousePosition,W(()=>{try{if(!u.value||h.value.length!==1)return;const l=i.value.w,S=i.value.h,v=i.value.x,L=v+l/2,R=v+l,H=[v,L,R],k=i.value.y,Z=k+S/2,q=k+S,ne=[k,Z,q];o.select.clear(),o.sorptioned.y=!1;const oe=t.getComponentList.map(x=>({id:x.id,attr:x.attr}));oe.push(C.value),o.lineArr.forEach(x=>{oe.forEach(P=>{if(h.value[0]===P.id)return;const $=P.attr.w,T=P.attr.h,M=P.attr.x,a=M+$/2,f=M+$,E=[M,a,f],y=P.attr.y,I=y+T/2,b=y+T,ae=[y,I,b];x.includes("rowt")&&(d(k,y)&&(o.select.set(x,{y}),U(c.value,v,y)),d(k,I)&&(o.select.set(x,{y:I}),U(c.value,v,I)),d(k,b)&&(o.select.set(x,{y:b}),U(c.value,v,b))),x.includes("rowc")&&(d(Z,y)&&(o.select.set(x,{y}),U(c.value,v,y-S/2)),d(Z,I)&&(o.select.set(x,{y:I}),U(c.value,v,I-S/2)),d(Z,b)&&(o.select.set(x,{y:b}),U(c.value,v,b-S/2))),x.includes("rowb")&&(d(q,y)&&(o.select.set(x,{y}),U(c.value,v,y-S)),d(q,I)&&(o.select.set(x,{y:I}),U(c.value,v,I-S)),d(q,b)&&(o.select.set(x,{y:b}),U(c.value,v,b-S))),x.includes("coll")&&(d(v,M)&&(o.select.set(x,{x:M}),U(c.value,M,k)),d(v,a)&&(o.select.set(x,{x:a}),U(c.value,a,k)),d(v,f)&&(o.select.set(x,{x:f}),U(c.value,f,k))),x.includes("colc")&&(d(L,M)&&(o.select.set(x,{x:M}),U(c.value,M-l/2,k)),d(L,a)&&(o.select.set(x,{x:a}),U(c.value,a-l/2,k)),d(L,f)&&(o.select.set(x,{x:f}),U(c.value,f-l/2,k))),x.includes("colr")&&(d(R,M)&&(o.select.set(x,{x:M}),U(c.value,M-l,k)),d(R,a)&&(o.select.set(x,{x:a}),U(c.value,a-l,k)),d(R,f)&&(o.select.set(x,{x:f}),U(c.value,f-l,k)))})})}catch(l){console.log(l)}},200),{deep:!0}),ue(()=>u.value,l=>{l||(o.select.clear(),o.sorptioned.y=!1)}),(l,S)=>(D(),z("div",xn,[(D(!0),z(me,null,we(o.lineArr,v=>(D(),z("div",{class:re(["line",[v.includes("row")?"row":"col",o.select.has(v)&&"visible"]]),key:v,style:Q(m(o.select.get(v)))},null,6))),128))]))}}),Ln=fe(Mn,[["__scopeId","data-v-403a9eed"]]);const Rt=e=>(Nt("data-v-71d41248"),e=e(),Xt(),e),kn=Rt(()=>V("div",{class:"select-background"},null,-1)),Dn=Rt(()=>V("div",{class:"select-border"},null,-1)),Rn=[kn,Dn],bn=ie({__name:"index",setup(e){be(p=>({c29aca42:r(m)}));const n=Oe(),t=te(),{isSelect:s,scale:o}=je(t.getEditCanvas),m=O(()=>n.getAppTheme),g=ee();return ue(()=>t.getMousePosition,p=>{if(!s.value)return;const{startX:u,startY:d,x:h,y:c}=p,i={zIndex:at,x:0,y:0,w:0,h:0,offsetX:0,offsetY:0};h>u&&c>d?(i.x=u,i.y=d,i.w=Math.round((h-u)/o.value),i.h=Math.round((c-d)/o.value)):h>u&&c<d?(i.x=u,i.w=Math.round((h-u)/o.value),i.h=Math.round((d-c)/o.value),i.y=d-i.h):h<u&&c>d?(i.y=d,i.w=Math.round((u-h)/o.value),i.h=Math.round((c-d)/o.value),i.x=u-i.w):(i.w=Math.round((u-h)/o.value),i.h=Math.round((d-c)/o.value),i.x=u-i.w,i.y=d-i.h),g.value=A(A({},Re(i,at)),de(i))},{deep:!0}),(p,u)=>r(s)?(D(),z("div",{key:0,class:"go-edit-select",style:Q(g.value)},Rn,4)):_e("",!0)}}),On=fe(bn,[["__scopeId","data-v-71d41248"]]);const An=ie({__name:"index",setup(e){const n=te(),{getEditCanvasConfig:t,getEditCanvas:s}=je(n),o=O(()=>({w:t.value.width,h:t.value.height})),m=O(()=>{const p={transform:`scale(${s.value.scale})`};return A(A({},de(o.value)),p)}),g=O(()=>{const p=s.value.isCreate&&{"z-index":99999};return A(A({},de(o.value)),p)});return(p,u)=>(D(),z("div",{class:"go-edit-range go-transition",style:Q(r(m)),onMousedown:u[0]||(u[0]=d=>r(Cn)(d,void 0))},[Ze(p.$slots,"default",{},void 0,!0),se(r(Ln)),se(r(On)),V("div",{class:"go-edit-range-model",style:Q(r(g))},null,4)],36))}}),In=fe(An,[["__scopeId","data-v-00f6546e"]]),bt=!!(typeof window!="undefined"&&window.document&&window.document.createElement);var Je=!1,Ve=!1;try{var Ne={get passive(){return Je=!0},get once(){return Ve=Je=!0}};bt&&(window.addEventListener("test",Ne,Ne),window.removeEventListener("test",Ne,!0))}catch(e){}function $n(e,n,t,s){if(s&&typeof s!="boolean"&&!Ve){var o=s.once,m=s.capture,g=t;!Ve&&o&&(g=t.__once||function p(u){this.removeEventListener(n,p,m),t.call(this,u)},t.__once=g),e.addEventListener(n,g,Je?s:m)}e.addEventListener(n,t,s)}function Hn(e,n,t,s){var o=s&&typeof s!="boolean"?s.capture:s;e.removeEventListener(n,t,o),t.__once&&e.removeEventListener(n,t.__once,o)}function ht(e,n,t,s){return $n(e,n,t,s),function(){Hn(e,n,t,s)}}var gt=new Date().getTime();function Pn(e){var n=new Date().getTime(),t=Math.max(0,16-(n-gt)),s=setTimeout(e,t);return gt=n,s}var Un=["","webkit","moz","o","ms"],pt=Pn,vt=function(n,t){return n+(n?t[0].toUpperCase()+t.substr(1):t)+"AnimationFrame"};bt&&Un.some(function(e){var n=vt(e,"request");return n in window&&(vt(e,"cancel"),pt=function(s){return window[n](s)}),!!pt});Function.prototype.bind.call(Function.prototype.call,[].slice);Function.prototype.bind.call(Function.prototype.call,[].slice);const Kn={class:"go-sketch-rule"},Bn={key:1,class:"fix-edit-screens-block"},Yn=ie({__name:"index",setup(e){be(T=>({"027e6d17":r(Z),"66707d7c":r(H),"2846119e":i.value}));const n=te(),t=Lt(),s=Oe(),o=20;let m=[0,0],g=[0,0];const p=ee(),u=ee(!0),d=ee(),h=ee(),c=ee(!1),i=ee("auto"),{width:C,height:l}=je(n.getEditCanvasConfig),S=ee(0),v=ee(0),L=Tt({h:[],v:[]}),R=O(()=>n.getEditCanvas.scale),H=O(()=>`${l.value*2}px`),k=O(()=>s.getDarkTheme?{bgColor:"#18181c",longfgColor:"#4d4d4d",shortfgColor:"#4d4d4d",fontColor:"#4d4d4d",shadowColor:"#18181c",borderColor:"#18181c",cornerActiveColor:"#18181c"}:{}),Z=O(()=>s.getAppTheme),q=T=>{if(T.ctrlKey||T.metaKey){T.preventDefault();let M=R.value;if(T.wheelDelta>=0&&R.value<2){M=R.value+.05,n.setScale(M);return}T.wheelDelta<0&&R.value>.1&&(M=R.value-.05,n.setScale(M))}},ne=()=>{if(!p.value)return;const T=p.value.getBoundingClientRect(),M=d.value.getBoundingClientRect();S.value=(T.left+o-M.left)/R.value,v.value=(T.top+o-M.top)/R.value},oe=T=>{var y,I;if(T.preventDefault(),T.stopPropagation(),T.which==2)c.value=!0;else if(!((y=window.$KeyboardActive)!=null&&y.space))return;(I=document.activeElement)==null||I.blur();const M=T.pageX,a=T.pageY,f=ht(window,"mousemove",b=>{const ae=b.pageX-M,Ce=b.pageY-a,[Ae,Ee]=m,[Ie,Se]=g;m=[Ee,ae],g=[Se,Ce],p.value.scrollLeft-=Ee>Ae?Math.abs(Ee-Ae):-Math.abs(Ee-Ae),p.value.scrollTop-=Se>Ie?Math.abs(Se-Ie):-Math.abs(Se-Ie)}),E=ht(window,"mouseup",()=>{f(),E(),m=[0,0],g=[0,0],c.value=!1})},x=()=>{const T=document.getElementById("go-chart-edit-layout");return T?{height:T.clientHeight-25,width:T.clientWidth}:{width:C.value,height:l.value}},P=()=>{u.value=!1,setTimeout(()=>{u.value=!0},10)},$=()=>{const{width:T,height:M}=h.value.getBoundingClientRect(),{width:a,height:f}=x();p.value.scrollLeft=T/2-a/2,p.value.scrollTop=M/2-f/2};return ue(()=>s.getDarkTheme,()=>{P()}),ue(()=>R.value,(T,M)=>{M!==T&&t.getRePositionCanvas?(t.setItemUnHandle(We.RE_POSITION_CANVAS,!1),ne(),setTimeout(()=>{$(),P()},400)):W(P,20)}),ue(()=>c.value,T=>{i.value=T?"grab":"auto"}),Qe(()=>{p.value&&(p.value.addEventListener("wheel",q,{passive:!1}),$())}),Ct(()=>{p.value&&p.value.removeEventListener("wheel",q)}),window.onKeySpacePressHold=T=>{c.value=T},(T,M)=>{const a=ge("sketch-rule");return D(),z("div",Kn,[u.value?(D(),N(a,{key:0,thick:o,scale:r(R),width:x().width,height:x().height,startX:S.value,startY:v.value,lines:L,palette:r(k)},null,8,["scale","width","height","startX","startY","lines","palette"])):_e("",!0),V("div",{ref_key:"$app",ref:p,class:"edit-screens",onScroll:ne},[V("div",{ref_key:"$container",ref:h,class:"edit-screen-container",style:Q({width:r(C)*2+"px"})},[V("div",{ref_key:"refSketchRuleBox",ref:d,class:"canvas",onMousedown:oe,style:Q({marginLeft:"-"+(x().width/2-25)+"px"})},[V("div",{style:Q({pointerEvents:c.value?"none":"auto"})},[Ze(T.$slots,"default",{},void 0,!0)],4)],36)],4)],544),r(s).getDarkTheme?(D(),z("div",Bn)):_e("",!0)])}}}),Nn=fe(Yn,[["__scopeId","data-v-9b7f266a"]]),Xn=e=>e,Gn=(e,n)=>{try{if(n.id){const t="vnodeBeforeMount"in n.events,s="vnodeMounted"in n.events;return t&&(e.events.advancedEvents.vnodeBeforeMount=n==null?void 0:n.events.vnodeBeforeMount),s&&(e.events.advancedEvents.vnodeMounted=n==null?void 0:n.events.vnodeMounted),(t||s)&&(n.events={baseEvent:{[Te.ON_CLICK]:void 0,[Te.ON_DBL_CLICK]:void 0,[Te.ON_MOUSE_ENTER]:void 0,[Te.ON_MOUSE_LEAVE]:void 0},advancedEvents:{[rt.VNODE_MOUNTED]:void 0,[rt.VNODE_BEFORE_MOUNT]:void 0},interactEvents:[]}),e}}catch(t){return e}},le=(e,n,t=!1)=>{if(Gn(e,n),t)return Ue(e,n);const s=n.option;if(!s)return Ue(e,n);if(n.option=void 0,s)return he(A({},Ue(e,n)),{option:s})},Ot=()=>{const e=te(),n=Vt(),t=Lt();return{updateComponent:(o,m=!1,g=!1)=>ce(void 0,null,function*(){m&&(e.componentList=[],n.clearBackStack(),n.clearForwardStack()),o.editCanvasConfig=Xn(o.editCanvasConfig),o.componentList.forEach(u=>ce(void 0,null,function*(){const d=h=>{window.$vue.component(h.chartConfig.chartKey)||(window.$vue.component(h.chartConfig.chartKey,jt(h.chartConfig)),window.$vue.component(h.chartConfig.conKey,en(h.chartConfig)))};u.isGroup?u.groupList.forEach(h=>{d(h)}):d(u)}));const p=(u,d)=>ce(void 0,null,function*(){let h=yield Mt(u.chartConfig);d?d(g?le(h,he(A({},u),{id:Pe()})):le(h,u)):g?e.addComponentList(le(h,he(A({},u),{id:Pe()})),!1,!0):e.addComponentList(le(h,u),!1,!0)});for(const u in o)if(u===Qt.COMPONENT_LIST){let d=0;const h=o[u].length;for(const c of o[u]){let i=parseInt((parseFloat(`${++d/h}`)*100).toString());if(t.setItemUnHandle(We.PERCENTAGE,i),c.isGroup){let C=new Zt;g?C=le(C,he(A({},c),{id:Pe()})):C=le(C,c);const l=[];for(const S of c.groupList)yield p(S,v=>{l.push(v)});C.groupList=l,e.addComponentList(C,!1,!0)}else yield p(c)}}else{if(u!=="editCanvasConfig"&&u!=="requestGlobalConfig")return;le(e[u],o[u],!0)}t.setItemUnHandle(We.PERCENTAGE,0)})}},Fn=()=>{const e=ee(),{updateComponent:n}=Ot();return{importUploadFileListRef:e,importBeforeUpload:({file:o})=>{e.value=[];const m=o.file.type;return m!==dt.JSON&&m!==dt.TXT?(window.$message.warning("仅支持上传 【JSON】 格式文件，请重新上传！"),!1):!0},importCustomRequest:o=>{const{file:m}=o;Gt(()=>{m.file?ln(m.file).then(g=>{sn({message:"请选择导入方式:",positiveText:"新增（可撤回）",negativeText:"覆盖（不可撤回）",negativeButtonProps:{type:"info",ghost:!1},onPositiveCallback:()=>ce(void 0,null,function*(){try{g=Xe(g),yield n(g,!1,!0),window.$message.success("导入成功！")}catch(p){console.log(p),window.$message.error("组件导入失败，请检查文件完整性!")}}),onNegativeCallback:()=>ce(void 0,null,function*(){try{g=Xe(g),yield n(g,!0,!0),window.$message.success("导入成功！")}catch(p){console.log(p),window.$message.error("组件导入失败，请检查文件完整性!")}})})}):window.$message.error("导入失败，请检查数据或联系管理员！")})}}},{updateComponent:Wn}=Ot(),At=te(),mt=()=>{dispatchEvent(new CustomEvent(Le.CHART_TO_PREVIEW,{detail:At.getStorageInfo}))},zn=()=>{const e=m=>{window.$message.success("正在进行更新..."),Wn(m.detail,!0)},n=()=>{At.setEditCanvas(j.IS_CODE_EDIT,!1)},t=()=>{addEventListener("blur",mt),addEventListener(Le.JSON,e),addEventListener(Le.CLOSE,W(n,1e3))},s=()=>{removeEventListener("blur",mt),removeEventListener(Le.JSON,e)};return(m,g)=>{g==it.CHART_HOME_NAME&&s(),m==it.CHART_HOME_NAME&&t()}},qn=()=>{const e=xt();ue(()=>e.name,zn(),{immediate:!0})};var pe=(e=>(e.BUTTON="button",e.IMPORTUPLOAD="importUpload",e))(pe||{});const Jn={class:"btn-item"},Vn=ie({__name:"index",setup(e){const{DownloadIcon:n,ShareIcon:t,PawIcon:s,SettingsSharpIcon:o,CreateIcon:m,Refresh:g}=rn.ionicons5,p=St(),u=te();xt(),qn();let d=null;const h=ee(!1),c=ee(!0),i=ee(!0),{importUploadFileListRef:C,importCustomRequest:l,importBeforeUpload:S}=Fn(),v=O(()=>p.getChartToolsStatus===ct.ASIDE),L=O(()=>p.getChartToolsStatusHide),R=O(()=>c.value&&L.value),H=O(()=>{if(!v.value)return x;const P=[];return x.map($=>{P.unshift($)}),P}),k=()=>{d=setTimeout(()=>{c.value&&(c.value=!1,i.value=!0)},200),setTimeout(()=>{i.value=!1},400)},Z=()=>{clearTimeout(d),c.value||(c.value=!0)},q=()=>{console.log(1),u.emptyComponentList()},ne=()=>{},oe=()=>{},x=[{key:"refresh",type:pe.BUTTON,name:"重置",icon:g,handle:q},{key:"sign",type:pe.BUTTON,name:"签名",icon:m,handle:ne},{key:"create",type:pe.BUTTON,name:"生成",icon:n,handle:oe}];return(P,$)=>{const T=ge("n-icon"),M=ge("n-text"),a=ge("n-button"),f=ge("n-upload"),E=ge("n-tooltip");return D(),z(me,null,[V("div",{class:re(["go-chart-edit-tools",[r(p).getChartToolsStatus,r(R)?"isMini":"unMini"]]),onClick:$[1]||($[1]=y=>c.value&&(c.value=!1)),onMouseenter:k,onMouseleave:Z},[Ke(se(T,{class:"asideLogo",size:"22"},{default:K(()=>[se(r(s))]),_:1},512),[[Be,r(p).getChartToolsStatus===r(ct).ASIDE&&r(R)]]),(D(!0),z(me,null,we(r(H),(y,I)=>(D(),N(E,{key:y.key+I,disabled:!r(v)||r(L)&&i.value,trigger:"hover",placement:"left"},{trigger:K(()=>[V("div",Jn,[y.type===r(pe).BUTTON?(D(),N(a,{key:0,circle:r(v),secondary:"",onClick:y.handle},{icon:K(()=>[r(v)?(D(),N(T,{key:0,size:"22"},{default:K(()=>[(D(),N(ve(y.icon)))]),_:2},1024)):(D(),N(ve(y.icon),{key:1}))]),default:K(()=>[Ke(se(M,{depth:"3"},{default:K(()=>[lt(Ye(y.name),1)]),_:2},1536),[[Be,!r(v)]])]),_:2},1032,["circle","onClick"])):y.type===r(pe).IMPORTUPLOAD?(D(),N(f,{key:1,"file-list":r(C),"onUpdate:file-list":$[0]||($[0]=b=>Ft(C)?C.value=b:null),"show-file-list":!1,customRequest:r(l),onBeforeUpload:r(S)},{default:K(()=>[se(a,{circle:r(v),secondary:""},{icon:K(()=>[r(v)?(D(),N(T,{key:0,size:"22"},{default:K(()=>[(D(),N(ve(y.icon)))]),_:2},1024)):(D(),N(ve(y.icon),{key:1}))]),default:K(()=>[Ke(se(M,{depth:"3"},{default:K(()=>[lt(Ye(y.name),1)]),_:2},1536),[[Be,!r(v)]])]),_:2},1032,["circle"])]),_:2},1032,["file-list","customRequest","onBeforeUpload"])):_e("",!0)])]),default:K(()=>[V("span",null,Ye(y.name),1)]),_:2},1032,["disabled"]))),128))],34),se(r(cn),{modelShow:h.value,"onUpdate:modelShow":$[2]||($[2]=y=>h.value=y)},null,8,["modelShow"])],64)}}}),Qn=fe(Vn,[["__scopeId","data-v-33f25f44"]]);const Zn=ie({__name:"index",setup(e){const{GO_CHART_LAYOUT_STORE:n}=qt,t=te(),{handleContextMenu:s}=et();Wt(tn,null),un();const{mouseenterHandle:o,mouseleaveHandle:m,mousedownHandle:g,mouseClickHandle:p}=Dt(),u=(i,C,l)=>{if(t.getTargetChart.selectId.length>1)return C.filter(v=>[w.GROUP,w.DELETE].includes(v.key));const S=[];return l.status.lock?S.push(w.LOCK):S.push(w.UNLOCK),l.status.hide?S.push(w.HIDE):S.push(w.SHOW),i.filter(v=>!S.includes(v.key))},d=O(()=>t.getEditCanvasConfig.chartThemeSetting),h=O(()=>wt(t.getEditCanvasConfig.chartCustomThemeColorInfo)[t.getEditCanvasConfig.chartThemeColor]);O(()=>t.getEditCanvasConfig.filterShow);const c=O(()=>{const i=t.getEditCanvasConfig.background,C=t.getEditCanvasConfig.backgroundImage,v=t.getEditCanvasConfig.selectColor?{background:i||void 0}:{background:`url(${C}) no-repeat center center / cover !important`};return he(A({},v),{width:"inherit",height:"inherit"})});return Qe(()=>{pn(),zt(n,{layers:!1,charts:!0,details:!0,chartType:"double",layerType:"thumbnail",percentage:0,rePositionCanvas:!0})}),(i,C)=>(D(),N(r(an),{id:"go-chart-edit-layout",flex:!0,showTop:!1,showBottom:!0,depth:1,xScroll:!0,disabledScroll:!0,onMousedown:r(kt),onDrop:r(mn),onDragover:r(ft),onDragenter:r(ft)},{aside:K(()=>[se(r(Qn))]),default:K(()=>[se(r(Nn),null,{default:K(()=>[V("div",{id:"go-chart-edit-content",onContextmenu:C[0]||(C[0]=(...l)=>r(s)&&r(s)(...l))},[se(r(In),null,{default:K(()=>[V("div",{style:Q(A(A({},r(ke)(r(t).getEditCanvasConfig)),r(c)))},[(D(!0),z(me,null,we(r(t).getComponentList,(l,S)=>(D(),z("div",{key:l.id},[l.isGroup?(D(),N(r(Tn),{key:0,groupData:l,groupIndex:S},null,8,["groupData","groupIndex"])):(D(),N(r(qe),{key:1,"data-id":l.id,index:S,style:Q(A(A({},r(Re)(l.attr,S)),r(Et)(l.styles))),item:l,onClick:v=>r(p)(v,l),onMousedown:v=>r(g)(v,l),onMouseenter:v=>r(o)(v,l),onMouseleave:v=>r(m)(v,l),onContextmenu:v=>r(s)(v,l,u)},{default:K(()=>[(D(),N(ve(l.chartConfig.chartKey),{class:re(["edit-content-chart",r(Ge)(l.styles.animations)]),chartConfig:l,themeSetting:r(d),themeColor:r(h),style:Q(A(A(A({},r(de)(l.attr)),r(ke)(l.styles)),r(Fe)(l.styles)))},null,8,["class","chartConfig","themeSetting","themeColor","style"]))]),_:2},1032,["data-id","index","style","item","onClick","onMousedown","onMouseenter","onMouseleave","onContextmenu"]))]))),128))],4)]),_:1})],32)]),_:1})]),_:1},8,["onMousedown","onDrop","onDragover","onDragenter"]))}}),_o=fe(Zn,[["__scopeId","data-v-35dcc89a"]]);export{_o as default};
