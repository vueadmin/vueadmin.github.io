var es=Object.defineProperty,ss=Object.defineProperties;var ns=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var os=Object.prototype.hasOwnProperty,as=Object.prototype.propertyIsEnumerable;var ge=(n,t,e)=>t in n?es(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,U=(n,t)=>{for(var e in t||(t={}))os.call(t,e)&&ge(n,e,t[e]);if(fe)for(var e of fe(t))as.call(t,e)&&ge(n,e,t[e]);return n},xt=(n,t)=>ss(n,ns(t));var lt=(n,t,e)=>new Promise((s,o)=>{var a=c=>{try{f(e.next(c))}catch(i){o(i)}},r=c=>{try{f(e.throw(c))}catch(i){o(i)}},f=c=>c.done?s(c.value):Promise.resolve(c.value).then(a,r);f((e=e.apply(n,t)).next())});import{n as se,a1 as Pe,b0 as rs,ak as x,cB as Ae,cC as Re,cD as ve,bb as et,aX as Ft,cA as is,aE as zt,cE as X,al as pe,b3 as Wt,c as ft,d as dt,b2 as Ht,m as Ut,a0 as A,o as D,e as nt,f as ne,F as Et,s as kt,ag as ut,af as at,u as C,a3 as Tt,q as B,aw as Oe,E as q,w as O,G as Ct,aq as qt,ar as At,as as Vt,at as $e,$ as Ie,p as oe,am as me,L as ht,Z as ae,l as z,cF as _e,z as re,A as ie,g as Y,r as ct,an as He,I as cs,X as ls,h as Rt,M as Bt,ch as Nt,aN as Mt,aO as ye,B as Ue,J as Ce,aB as Pt,ba as we,Q as Yt,R as Kt,t as Lt,b7 as us,bh as ds,x as hs,S as fs}from"./index-ceb04263.js";import{u as ce,d as gs}from"./index-75f95d30.js";import{u as it,E as st,a as vs,C as ps,e as ms}from"./chartEditStore-66e39698.js";import{d as le,f as Fe,c as We,ai as _s,aj as ys}from"./index-b8b80fff.js";import{a as Be,b as Jt,l as Ne,g as Cs}from"./plugin-6413e978.js";import{l as wt}from"./lodash-a6b644ed.js";import{C as ws}from"./index-c8b1af7e.js";import{u as Ye,C as jt}from"./chartLayoutStore-7d9a2dd0.js";import{c as Ee}from"./components-b84b2119.js";import{G as Es}from"./index-dcad4f13.js";import{i as Ke}from"./icon-e92a95d4.js";import{F as xe}from"./fileTypeEnum-21359a08.js";import{r as xs}from"./file-84751f49.js";import{u as Ss}from"./packagesStore-66a64033.js";import"./SettingItem-f4ab2ff5.js";/* empty css                                                                   */import"./SettingItemBox-fd503d2d.js";import"./CollapseItem-1c06d7a4.js";import"./index.esm.min-ce17e730.js";import"./http-d36ff187.js";const St=it(),Ts=()=>{se(()=>{St.setEditCanvas(st.EDIT_LAYOUT_DOM,document.getElementById("go-chart-edit-layout")),St.setEditCanvas(st.EDIT_CONTENT_DOM,document.getElementById("go-chart-edit-content"));const n=St.listenerScale();Pe(()=>{St.setEditCanvas(st.EDIT_LAYOUT_DOM,null),St.setEditCanvas(st.EDIT_CONTENT_DOM,null),n()})})};var Qt={},ks={get exports(){return Qt},set exports(n){Qt=n}};(function(n){(function(t){var e,s={},o={16:!1,18:!1,17:!1,91:!1},a="all",r={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},f={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},c=function(d){return f[d]||d.toUpperCase().charCodeAt(0)},i=[];for(e=1;e<20;e++)f["f"+e]=111+e;function l(d,_){for(var E=d.length;E--;)if(d[E]===_)return E;return-1}function u(d,_){if(d.length!=_.length)return!1;for(var E=0;E<d.length;E++)if(d[E]!==_[E])return!1;return!0}var h={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function v(d){for(e in o)o[e]=d[h[e]]}function g(d){var _,E,T,$,M,H;if(_=d.keyCode,l(i,_)==-1&&i.push(_),(_==93||_==224)&&(_=91),_ in o){o[_]=!0;for(T in r)r[T]==_&&(w[T]=!0);return}if(v(d),!!w.filter.call(this,d)&&_ in s){for(H=G(),$=0;$<s[_].length;$++)if(E=s[_][$],E.scope==H||E.scope=="all"){M=E.mods.length>0;for(T in o)(!o[T]&&l(E.mods,+T)>-1||o[T]&&l(E.mods,+T)==-1)&&(M=!1);(E.mods.length==0&&!o[16]&&!o[18]&&!o[17]&&!o[91]||M)&&E.method(d,E)===!1&&(d.preventDefault?d.preventDefault():d.returnValue=!1,d.stopPropagation&&d.stopPropagation(),d.cancelBubble&&(d.cancelBubble=!0))}}}function p(d){var _=d.keyCode,E,T=l(i,_);if(T>=0&&i.splice(T,1),(_==93||_==224)&&(_=91),_ in o){o[_]=!1;for(E in r)r[E]==_&&(w[E]=!1)}}function y(){for(e in o)o[e]=!1;for(e in r)w[e]=!1}function w(d,_,E){var T,$;T=S(d),E===void 0&&(E=_,_="all");for(var M=0;M<T.length;M++)$=[],d=T[M].split("+"),d.length>1&&($=j(d),d=[d[d.length-1]]),d=d[0],d=c(d),d in s||(s[d]=[]),s[d].push({shortcut:T[M],scope:_,method:E,key:T[M],mods:$})}function L(d,_){var E,T,$=[],M,H,I;for(E=S(d),H=0;H<E.length;H++){if(T=E[H].split("+"),T.length>1&&($=j(T),d=T[T.length-1]),d=c(d),_===void 0&&(_=G()),!s[d])return;for(M=0;M<s[d].length;M++)I=s[d][M],I.scope===_&&u(I.mods,$)&&(s[d][M]={})}}function N(d){return typeof d=="string"&&(d=c(d)),l(i,d)!=-1}function b(){return i.slice(0)}function F(d){var _=(d.target||d.srcElement).tagName;return!(_=="INPUT"||_=="SELECT"||_=="TEXTAREA")}for(e in r)w[e]=!1;function W(d){a=d||"all"}function G(){return a||"all"}function K(d){var _,E,T;for(_ in s)for(E=s[_],T=0;T<E.length;)E[T].scope===d?E.splice(T,1):T++}function S(d){var _;return d=d.replace(/\s/g,""),_=d.split(","),_[_.length-1]==""&&(_[_.length-2]+=","),_}function j(d){for(var _=d.slice(0,d.length-1),E=0;E<_.length;E++)_[E]=r[_[E]];return _}function k(d,_,E){d.addEventListener?d.addEventListener(_,E,!1):d.attachEvent&&d.attachEvent("on"+_,function(){E(window.event)})}k(document,"keydown",function(d){g(d)}),k(document,"keyup",p),k(window,"focus",y);var R=t.key;function P(){var d=t.key;return t.key=R,d}t.key=w,t.key.setScope=W,t.key.getScope=G,t.key.deleteScope=K,t.key.filter=F,t.key.isPressed=N,t.key.getPressedKeyCodes=b,t.key.noConflict=P,t.key.unbind=L,n.exports=w})(rs)})(ks);const Q=Qt,Z=it(),ot=n=>`${Ae.CTRL}+${n}`,bt=n=>`${Ae.SHIFT}+${n}`,V={[x.ARROW_UP]:ot("up"),[x.ARROW_RIGHT]:ot("right"),[x.ARROW_DOWN]:ot("down"),[x.ARROW_LEFT]:ot("left"),[x.COPY]:ot("c"),[x.CUT]:ot("x"),[x.PARSE]:ot("v"),[x.DELETE]:"delete",[x.BACK]:ot("z"),[x.FORWORD]:ot(bt("z")),[x.GROUP]:ot("g"),[x.UN_GROUP]:ot(bt("g")),[x.LOCK]:ot("l"),[x.UNLOCK]:ot(bt("l")),[x.HIDE]:ot("h"),[x.SHOW]:ot(bt("h"))},tt=n=>`${Re.CTRL}+${n}`,Dt=n=>`${Re.SHIFT}+${n}`,J={[x.ARROW_UP]:tt("arrowup"),[x.ARROW_RIGHT]:tt("arrowright"),[x.ARROW_DOWN]:tt("arrowdown"),[x.ARROW_LEFT]:tt("arrowleft"),[x.COPY]:tt("c"),[x.CUT]:tt("x"),[x.PARSE]:tt("v"),[x.DELETE]:tt("backspace"),[x.BACK]:tt("z"),[x.FORWORD]:tt(Dt("z")),[x.GROUP]:tt("g"),[x.UN_GROUP]:tt(Dt("g")),[x.LOCK]:tt("l"),[x.UNLOCK]:tt(Dt("l")),[x.HIDE]:tt("h"),[x.SHOW]:tt(Dt("h"))},Ms=[V.up,V.right,V.down,V.left,V.delete,V.copy,V.cut,V.parse,V.back,V.forward,V.group,V.unGroup,V.lock,V.unLock,V.hide,V.show],Ls=[J.up,J.right,J.down,J.left,J.delete,J.copy,J.cut,J.parse,J.back,J.forward,J.group,J.unGroup,J.lock,J.unLock,J.hide,J.show],bs=()=>{window.$KeyboardActive={ctrl:!1,space:!1},document.onkeydown=n=>{const{keyCode:t}=n;if(t==32&&n.target==document.body&&n.preventDefault(),[17,32].includes(t)&&window.$KeyboardActive)switch(ve(n.keyCode),t){case 17:window.$KeyboardActive.ctrl=!0;break;case 32:window.$KeyboardActive.space=!0;break}},document.onkeyup=n=>{const{keyCode:t}=n;if(t==32&&n.target==document.body&&n.preventDefault(),[17,32].includes(t)&&window.$KeyboardActive)switch(ve(),t){case 17:window.$KeyboardActive.ctrl=!1;break;case 32:window.$KeyboardActive.space=!1;break}}},Ds=()=>{const t=(e,s)=>{switch(s){case e.up:Q(s,et(()=>(Z.setMove(x.ARROW_UP),!1),50));break;case e.right:Q(s,et(()=>(Z.setMove(x.ARROW_RIGHT),!1),50));break;case e.down:Q(s,et(()=>(Z.setMove(x.ARROW_DOWN),!1),50));break;case e.left:Q(s,et(()=>(Z.setMove(x.ARROW_LEFT),!1),50));break;case e.delete:Q(s,Ft(()=>(Z.removeComponentList(),!1),50));break;case e.copy:Q(s,Ft(()=>(Z.setCopy(),!1),50));break;case e.cut:Q(s,Ft(()=>(Z.setCut(),!1),50));break;case e.parse:Q(s,et(()=>(Z.setParse(),!1),50));break;case e.back:Q(s,et(()=>(Z.setBack(),!1),50));break;case e.forward:Q(s,et(()=>(Z.setForward(),!1),50));break;case e.group:Q(s,et(()=>(Z.setGroup(),!1),50));break;case e.unGroup:Q(s,et(()=>(Z.setUnGroup(),!1),50));break;case e.lock:Q(s,et(()=>(Z.setLock(),!1),50));break;case e.unLock:Q(s,et(()=>(Z.setUnLock(),!1),50));break;case e.hide:Q(s,et(()=>(Z.setHide(),!1),50));break;case e.show:Q(s,et(()=>(Z.setShow(),!1),50));break}};Ms.forEach(e=>{t(V,e)}),Ls.forEach(e=>{t(J,e)}),bs()},m=it(),{onClickOutSide:Se}=ce(),Ps=n=>lt(void 0,null,function*(){n.preventDefault();try{Be();const t=n.dataTransfer.getData(is.DRAG_KEY);if(!t){Jt();return}m.setEditCanvas(st.IS_CREATE,!1);const e=zt(t);let s=yield le(e);const o=["Backgrounds","Rabbits","Clothing","Informations","Other"];let a=0,r=0;switch(s.chartConfig.package){case"Backgrounds":a=0,r=382;break;case"Rabbits":a=382,r=0;break;case"Clothing":a=300,r=0;break;case"Jewelry":a=382,r=0;break;case"Decoration":a=618,r=382;break;case"Line":a=618,r=0;break;case"Informations":a=0,r=0;break;case"Other":a=0,r=0;break;default:a=n.offsetX-s.attr.w/2,r=n.offsetY-s.attr.h/2;break}X(s,a,r),m.addComponentList(s,!1,!0),m.setTargetSelectChart(s.id),o.includes(s.chartConfig.package)&&m.setLock(!0,!0),Jt()}catch(t){Ne(),window.$message.warning("图表正在研发中, 敬请期待...")}}),Te=n=>{n.preventDefault(),n.stopPropagation(),n.dataTransfer&&(n.dataTransfer.dropEffect="copy")},Ge=(n,t)=>{if(t){m.setTargetSelectChart(t.id);return}m.setTargetSelectChart(void 0)},As=(n,t)=>{var i;if(n.which==2||(i=window.$KeyboardActive)!=null&&i.space)return;Ge();const e=n.offsetX,s=n.offsetY,o=n.screenX,a=n.screenY,r=m.getEditCanvas.scale;m.setMousePosition(void 0,void 0,e,s);const f=wt.throttle(l=>{m.setTargetSelectChart(),m.setEditCanvas(st.IS_SELECT,!0);const u=e+l.screenX-o,h=s+l.screenY-a;m.setMousePosition(u,h);const v={x1:0,y1:0,x2:0,y2:0};u>e&&h>s?(v.x1=e,v.y1=s,v.x2=Math.round(e+(l.screenX-o)/r),v.y2=Math.round(s+(l.screenY-a)/r)):u>e&&h<s?(v.x1=e,v.y1=Math.round(s-(a-l.screenY)/r),v.x2=Math.round(e+(l.screenX-o)/r),v.y2=s):u<e&&h>s?(v.x1=Math.round(e-(o-l.screenX)/r),v.y1=s,v.x2=e,v.y2=Math.round(s+(l.screenY-a)/r)):(v.x1=Math.round(e-(o-l.screenX)/r),v.y1=Math.round(s-(a-l.screenY)/r),v.x2=e,v.y2=s),m.getComponentList.forEach(g=>{if(!m.getTargetChart.selectId.includes(g.id)){const{x:p,y,w,h:L}=g.attr,N={x1:p,y1:y,x2:p+w,y2:y+L};N.x1-v.x1>=0&&N.y1-v.y1>=0&&N.x2-v.x2<=0&&N.y2-v.y2<=0&&!g.status.lock&&!g.status.hide&&m.setTargetSelectChart(g.id,!0)}})},30),c=()=>{f.cancel(),m.setEditCanvas(st.IS_SELECT,!1),m.setMousePosition(0,0,0,0),document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",f),document.addEventListener("mouseup",c)},ue=()=>({mouseClickHandle:(a,r)=>{var f;if(a.preventDefault(),a.stopPropagation(),!r.status.lock&&(f=window.$KeyboardActive)!=null&&f.ctrl)if(m.targetChart.selectId.includes(r.id)){const c=m.targetChart.selectId.filter(i=>i!==r.id);m.setTargetSelectChart(c)}else m.setTargetSelectChart(r.id,!0)},mousedownHandle:(a,r)=>{var w;if(a.preventDefault(),a.stopPropagation(),r.status.lock||(Se(),a.buttons===Wt.LEFT&&((w=window.$KeyboardActive)!=null&&w.ctrl)))return;const f=m.getTargetChart.selectId;if(a.buttons===Wt.RIGHT&&f.length>1&&f.includes(r.id)||(m.setTargetSelectChart(r.id),a.buttons===Wt.RIGHT))return;const c=m.getEditCanvas.scale,i=m.getEditCanvasConfig.width,l=m.getEditCanvasConfig.height,u=new Map;m.getTargetChart.selectId.forEach(L=>{const N=m.fetchTargetIndex(L);if(N!==-1){const{x:b,y:F,w:W,h:G}=pe(m.getComponentList[N]).attr;u.set(L,{x:b,y:F,w:W,h:G})}});const h=a.screenX,v=a.screenY;let g=[];m.getTargetChart.selectId.forEach(L=>{if(!u.has(L))return;const N=m.fetchTargetIndex(L);g.push(wt.cloneDeep(m.getComponentList[N]))}),m.setMousePosition(void 0,void 0,h,v);const p=wt.throttle(L=>{m.setEditCanvas(st.IS_DRAG,!0),m.setMousePosition(L.screenX,L.screenY);let N=(L.screenX-h)/c,b=(L.screenY-v)/c;m.getTargetChart.selectId.forEach(F=>{if(!u.has(F))return;const W=m.fetchTargetIndex(F),{x:G,y:K,w:S,h:j}=u.get(F),k=m.getComponentList[W];let R=Math.round(G+N),P=Math.round(K+b);const d=50;R=R<-S+d?-S+d:R,P=P<-j+d?-j+d:P,R=R>i-d?i-d:R,P=P>l-d?l-d:P,k&&(k.attr=Object.assign(k.attr,{x:R,y:P}))})},20),y=()=>{try{m.setMousePosition(0,0,0,0),m.setEditCanvas(st.IS_DRAG,!1),g.length&&(m.getTargetChart.selectId.forEach(L=>{if(!u.has(L))return;const N=m.fetchTargetIndex(L),b=m.getComponentList[N];g.forEach(F=>{F.id===L&&(F.attr=Object.assign(F.attr,{offsetX:b.attr.x-F.attr.x,offsetY:b.attr.y-F.attr.y}))})}),m.moveComponentList(g)),document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",y)}catch(L){console.log(L)}};document.addEventListener("mousemove",p),document.addEventListener("mouseup",y)},mouseenterHandle:(a,r)=>{a.preventDefault(),a.stopPropagation(),m.getEditCanvas.isSelect||m.setTargetHoverChart(r.id)},mouseleaveHandle:(a,r)=>{a.preventDefault(),a.stopPropagation(),m.setEditCanvas(st.IS_DRAG,!1),m.setTargetHoverChart(void 0)},useMouseHandle:ue,touchstartHandle:(a,r)=>{if(console.log("e =>",a),console.log("item =>",r),a.preventDefault(),a.stopPropagation(),r.status.lock)return;Se();const f=new Map;m.getTargetChart.selectId.forEach(v=>{const g=m.fetchTargetIndex(v);if(g!==-1){const{x:p,y,w,h:L}=pe(m.getComponentList[g]).attr;f.set(v,{x:p,y,w,h:L})}}),m.setTargetSelectChart(r.id);const c=a.touches[0].screenX,i=a.touches[0].screenY;let l=[];m.getTargetChart.selectId.forEach(v=>{if(!f.has(v))return;const g=m.fetchTargetIndex(v);l.push(wt.cloneDeep(m.getComponentList[g]))}),m.setMousePosition(void 0,void 0,c,i);const u=wt.throttle(v=>{m.setEditCanvas(st.IS_DRAG,!0),m.setMousePosition(v.touches[0].screenX,v.touches[0].screenY);const g=(v.touches[0].screenX-c)/m.getEditCanvas.scale,p=(v.touches[0].screenY-i)/m.getEditCanvas.scale;m.getTargetChart.selectId.forEach(y=>{if(!f.has(y))return;const w=m.fetchTargetIndex(y),{x:L,y:N,w:b,h:F}=f.get(y),W=m.getComponentList[w];let G=Math.round(L+g),K=Math.round(N+p);const S=50;G=G<-b+S?-b+S:G,K=K<-F+S?-F+S:K,G=G>m.getEditCanvasConfig.width-S?m.getEditCanvasConfig.width-S:G,K=K>m.getEditCanvasConfig.height-S?m.getEditCanvasConfig.height-S:K,W&&(W.attr=Object.assign(W.attr,{x:G,y:K}))})},20),h=()=>{try{m.setMousePosition(0,0,0,0),m.setEditCanvas(st.IS_DRAG,!1),l.length&&(m.getTargetChart.selectId.forEach(v=>{if(!f.has(v))return;const g=m.fetchTargetIndex(v),p=m.getComponentList[g];l.forEach(y=>{y.id===v&&(y.attr=Object.assign(y.attr,{offsetX:p.attr.x-y.attr.x,offsetY:p.attr.y-y.attr.y}))})}),m.moveComponentList(l))}catch(v){console.log(v)}};document.addEventListener("touchmove",u,{passive:!1}),document.addEventListener("touchend",h)}}),Rs=(n,t,e)=>{n.stopPropagation(),n.preventDefault(),m.setEditCanvas(st.IS_DRAG,!0);const s=m.getEditCanvas.scale,o=e.x,a=e.y,r=e.w,f=e.h,c=n.screenX,i=n.screenY;m.setMousePosition(c,i);const l=wt.throttle(h=>{m.setMousePosition(h.screenX,h.screenY);let v=Math.round((h.screenX-c)/s),g=Math.round((h.screenY-i)/s);const p=/t/.test(t),y=/b/.test(t),w=/l/.test(t),L=/r/.test(t),N=f+(p?-g:y?g:0),b=r+(w?-v:L?v:0);e.h=N>0?N:0,e.w=b>0?b:0,e.x=o+(w?v:0),e.y=a+(p?g:0)},50),u=()=>{m.setEditCanvas(st.IS_DRAG,!1),m.setMousePosition(0,0,0,0),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",u)},Ot=(n,t)=>n?{zIndex:n.zIndex===-1?t+1:n.zIndex+t+1,left:`${n.x}px`,top:`${n.y}px`}:{},pt=(n,t)=>n?{width:`${t?t*n.w:n.w}px`,height:`${t?t*n.h:n.h}px`}:{},Os=(n,t,e,s)=>{const{w:o,h:a}=e,r=/t/.test(n),f=/b/.test(n),c=/l/.test(n),i=/r/.test(n);let l=0,u=0;return n.length===2?(l=c?0:o,u=r?0:a):((r||f)&&(l=o/2,u=r?0:a),(c||i)&&(l=c?0:o,u=Math.floor(a/2))),{left:`${l}px`,top:`${u}px`,cursor:s[t]+"-resize"}};const $s=["onMousedown"],Is=dt({__name:"index",props:{item:{type:Object,required:!0},hiddenPoint:{type:Boolean,required:!1}},setup(n){const t=n;Ht(u=>({"6f41483b":r.value}));const e=Ut(),s=it(),o=["t","r","b","l","lt","rt","lb","rb"],a=["n","e","s","w","nw","ne","sw","se"],r=A(()=>e.getAppTheme),f=A(()=>t.item.status.lock?!1:t.item.id===s.getTargetChart.hoverId),c=A(()=>{const u=t.item.id;return t.item.status.lock?!1:s.getTargetChart.selectId.find(h=>h===u)}),i=A(()=>t.item.status.lock),l=A(()=>t.item.status.hide);return(u,h)=>(D(),nt("div",{class:ut(["go-shape-box",{lock:i.value,hide:l.value}])},[ne(u.$slots,"default",{},void 0,!0),n.hiddenPoint?Tt("",!0):(D(!0),nt(Et,{key:0},kt(c.value?o:[],(v,g)=>(D(),nt("div",{class:ut(`shape-point ${v}`),key:g,style:at(C(Os)(v,g,n.item.attr,a)),onMousedown:p=>C(Rs)(p,v,n.item.attr)},null,46,$s))),128)),B("div",{class:"shape-modal",style:at(C(pt)(n.item.attr))},[B("div",{class:ut(["shape-modal-select",{active:c.value}])},null,2),B("div",{class:ut(["shape-modal-change",{selectActive:c.value,hoverActive:f.value}])},null,2)],4)],2))}}),Zt=ft(Is,[["__scopeId","data-v-f03fb462"]]),Hs={class:"go-edit-group-box"},Us=dt({__name:"index",props:{groupData:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(n){const t=it(),{handleContextMenu:e}=ce(),{mouseenterHandle:s,mouseleaveHandle:o,mousedownHandle:a,mouseClickHandle:r}=ue(),f=(l,u,h)=>{const v=g=>u.filter(p=>g.includes(p.key));if(t.getTargetChart.selectId.length>1)return v([x.GROUP,x.DELETE]);{const g=[];h.status.lock?g.push(x.LOCK):g.push(x.UNLOCK),h.status.hide?g.push(x.HIDE):g.push(x.SHOW);const p=[x.UN_GROUP];return[...v(p),gs(),...l.filter(y=>!g.includes(y.key))]}},c=A(()=>Oe(t.getEditCanvasConfig.chartCustomThemeColorInfo)[t.getEditCanvasConfig.chartThemeColor]),i=A(()=>t.getEditCanvasConfig.chartThemeSetting);return(l,u)=>(D(),nt("div",Hs,[(D(),q(C(Zt),{key:n.groupData.id,"data-id":n.groupData.id,index:n.groupIndex,item:n.groupData,hiddenPoint:!0,class:ut(C(qt)(n.groupData.styles.animations)),style:at(U(U(U(U(U({},C(Ot)(n.groupData.attr,n.groupIndex)),C(pt)(n.groupData.attr)),C(At)(n.groupData.styles)),C(Vt)(n.groupData.styles)),C($e)(n.groupData.styles))),onClick:u[0]||(u[0]=h=>C(r)(h,n.groupData)),onMousedown:u[1]||(u[1]=h=>C(a)(h,n.groupData)),onMouseenter:u[2]||(u[2]=h=>C(s)(h,n.groupData)),onMouseleave:u[3]||(u[3]=h=>C(o)(h,n.groupData)),onContextmenu:u[4]||(u[4]=h=>C(e)(h,n.groupData,f))},{default:O(()=>[(D(!0),nt(Et,null,kt(n.groupData.groupList,h=>(D(),q(C(Zt),{key:h.id,"data-id":h.id,index:n.groupIndex,item:h,hiddenPoint:!0,style:at(U({},C(Ot)(h.attr,n.groupIndex)))},{default:O(()=>[(D(),q(Ct(h.chartConfig.chartKey),{class:ut(["edit-content-chart",C(qt)(h.styles.animations)]),chartConfig:h,themeSetting:i.value,themeColor:c.value,style:at(U(U(U({},C(pt)(h.attr)),C(At)(h.styles)),C(Vt)(h.styles)))},null,8,["class","chartConfig","themeSetting","themeColor","style"]))]),_:2},1032,["data-id","index","item","style"]))),128))]),_:1},8,["data-id","index","item","class","style"]))]))}});const Fs={class:"go-edit-align-line"},Ws=dt({__name:"index",setup(n){Ht(g=>({42514545:r.value}));const t=Ut(),e=it(),s=Ie(),o=oe({lineArr:["rowt","rowc","rowb","coll","colc","colr"],select:new Map,sorptioned:{x:!1,y:!1}}),a=g=>g?{left:`${g.x?g.x:0}px`,top:`${g.y?g.y:0}px`}:{},r=A(()=>t.getAppTheme),f=A(()=>s.getChartAlignRange),c=A(()=>e.getEditCanvas[st.IS_DRAG]),i=(g,p)=>Math.abs(g-p)<=f.value,l=A(()=>e.getTargetChart.selectId),u=A(()=>e.getComponentList[e.fetchTargetIndex()]),h=A(()=>{var g;return((g=u.value)==null?void 0:g.attr)||{}}),v=A(()=>({id:"0",attr:{w:me(e.getEditCanvasConfig.width),h:me(e.getEditCanvasConfig.height),x:0,y:0,offsetX:0,offsetY:0,zIndex:0}}));return ht(()=>e.getMousePosition,et(()=>{try{if(!c.value||l.value.length!==1)return;const g=h.value.w,p=h.value.h,y=h.value.x,w=y+g/2,L=y+g,N=[y,w,L],b=h.value.y,F=b+p/2,W=b+p,G=[b,F,W];o.select.clear(),o.sorptioned.y=!1;const K=e.getComponentList.map(S=>({id:S.id,attr:S.attr}));K.push(v.value),o.lineArr.forEach(S=>{K.forEach(j=>{if(l.value[0]===j.id)return;const k=j.attr.w,R=j.attr.h,P=j.attr.x,d=P+k/2,_=P+k,E=[P,d,_],T=j.attr.y,$=T+R/2,M=T+R,H=[T,$,M];S.includes("rowt")&&(i(b,T)&&(o.select.set(S,{y:T}),X(u.value,y,T)),i(b,$)&&(o.select.set(S,{y:$}),X(u.value,y,$)),i(b,M)&&(o.select.set(S,{y:M}),X(u.value,y,M))),S.includes("rowc")&&(i(F,T)&&(o.select.set(S,{y:T}),X(u.value,y,T-p/2)),i(F,$)&&(o.select.set(S,{y:$}),X(u.value,y,$-p/2)),i(F,M)&&(o.select.set(S,{y:M}),X(u.value,y,M-p/2))),S.includes("rowb")&&(i(W,T)&&(o.select.set(S,{y:T}),X(u.value,y,T-p)),i(W,$)&&(o.select.set(S,{y:$}),X(u.value,y,$-p)),i(W,M)&&(o.select.set(S,{y:M}),X(u.value,y,M-p))),S.includes("coll")&&(i(y,P)&&(o.select.set(S,{x:P}),X(u.value,P,b)),i(y,d)&&(o.select.set(S,{x:d}),X(u.value,d,b)),i(y,_)&&(o.select.set(S,{x:_}),X(u.value,_,b))),S.includes("colc")&&(i(w,P)&&(o.select.set(S,{x:P}),X(u.value,P-g/2,b)),i(w,d)&&(o.select.set(S,{x:d}),X(u.value,d-g/2,b)),i(w,_)&&(o.select.set(S,{x:_}),X(u.value,_-g/2,b))),S.includes("colr")&&(i(L,P)&&(o.select.set(S,{x:P}),X(u.value,P-g,b)),i(L,d)&&(o.select.set(S,{x:d}),X(u.value,d-g,b)),i(L,_)&&(o.select.set(S,{x:_}),X(u.value,_-g,b)))})})}catch(g){console.log(g)}},200),{deep:!0}),ht(()=>c.value,g=>{g||(o.select.clear(),o.sorptioned.y=!1)}),(g,p)=>(D(),nt("div",Fs,[(D(!0),nt(Et,null,kt(o.lineArr,y=>(D(),nt("div",{class:ut(["line",[y.includes("row")?"row":"col",o.select.has(y)&&"visible"]]),key:y,style:at(a(o.select.get(y)))},null,6))),128))]))}}),Bs=ft(Ws,[["__scopeId","data-v-403a9eed"]]);const Xe=n=>(re("data-v-71d41248"),n=n(),ie(),n),Ns=Xe(()=>B("div",{class:"select-background"},null,-1)),Ys=Xe(()=>B("div",{class:"select-border"},null,-1)),Ks=[Ns,Ys],Gs=dt({__name:"index",setup(n){Ht(f=>({c29aca42:a.value}));const t=Ut(),e=it(),{isSelect:s,scale:o}=ae(e.getEditCanvas),a=A(()=>t.getAppTheme),r=z();return ht(()=>e.getMousePosition,f=>{if(!s.value)return;const{startX:c,startY:i,x:l,y:u}=f,h={zIndex:_e,x:0,y:0,w:0,h:0,offsetX:0,offsetY:0};l>c&&u>i?(h.x=c,h.y=i,h.w=Math.round((l-c)/o.value),h.h=Math.round((u-i)/o.value)):l>c&&u<i?(h.x=c,h.w=Math.round((l-c)/o.value),h.h=Math.round((i-u)/o.value),h.y=i-h.h):l<c&&u>i?(h.y=i,h.w=Math.round((c-l)/o.value),h.h=Math.round((u-i)/o.value),h.x=c-h.w):(h.w=Math.round((c-l)/o.value),h.h=Math.round((i-u)/o.value),h.x=c-h.w,h.y=i-h.h),r.value=U(U({},Ot(h,_e)),pt(h))},{deep:!0}),(f,c)=>C(s)?(D(),nt("div",{key:0,class:"go-edit-select",style:at(r.value)},Ks,4)):Tt("",!0)}}),Xs=ft(Gs,[["__scopeId","data-v-71d41248"]]);const zs=dt({__name:"index",setup(n){const t=it(),{getEditCanvasConfig:e,getEditCanvas:s}=ae(t),o=A(()=>({w:e.value.width,h:e.value.height})),a=A(()=>{const f={transform:`scale(${s.value.scale})`};return U(U({},pt(o.value)),f)}),r=A(()=>{const f=s.value.isCreate&&{"z-index":99999};return U(U({},pt(o.value)),f)});return(f,c)=>(D(),nt("div",{class:"go-edit-range go-transition",style:at(a.value),onMousedown:c[0]||(c[0]=i=>C(As)(i,void 0))},[ne(f.$slots,"default",{},void 0,!0),Y(C(Bs)),Y(C(Xs)),B("div",{class:"go-edit-range-model",style:at(r.value)},null,4)],36))}}),qs=ft(zs,[["__scopeId","data-v-00f6546e"]]),ze=!!(typeof window!="undefined"&&window.document&&window.document.createElement);var te=!1,ee=!1;try{var Gt={get passive(){return te=!0},get once(){return ee=te=!0}};ze&&(window.addEventListener("test",Gt,Gt),window.removeEventListener("test",Gt,!0))}catch(n){}function Vs(n,t,e,s){if(s&&typeof s!="boolean"&&!ee){var o=s.once,a=s.capture,r=e;!ee&&o&&(r=e.__once||function f(c){this.removeEventListener(t,f,a),e.call(this,c)},e.__once=r),n.addEventListener(t,r,te?s:a)}n.addEventListener(t,e,s)}function Js(n,t,e,s){var o=s&&typeof s!="boolean"?s.capture:s;n.removeEventListener(t,e,o),e.__once&&n.removeEventListener(t,e.__once,o)}function ke(n,t,e,s){return Vs(n,t,e,s),function(){Js(n,t,e,s)}}var Me=new Date().getTime();function js(n){var t=new Date().getTime(),e=Math.max(0,16-(t-Me)),s=setTimeout(n,e);return Me=t,s}var Qs=["","webkit","moz","o","ms"],Le=js,be=function(t,e){return t+(t?e[0].toUpperCase()+e.substr(1):e)+"AnimationFrame"};ze&&Qs.some(function(n){var t=be(n,"request");return t in window&&(be(n,"cancel"),Le=function(s){return window[t](s)}),!!Le});Function.prototype.bind.call(Function.prototype.call,[].slice);Function.prototype.bind.call(Function.prototype.call,[].slice);const Zs={class:"go-sketch-rule"},tn={key:1,class:"fix-edit-screens-block"},Xt=20,en=dt({__name:"index",setup(n){Ht(k=>({"027e6d17":b.value,"66707d7c":L.value,"2846119e":u.value}));const t=it(),e=Ye(),s=Ut();let o=[0,0],a=[0,0];const r=z(),f=z(!0),c=z(),i=z(),l=z(!1),u=z("auto"),{width:h,height:v}=ae(t.getEditCanvasConfig),g=z(0),p=z(0),y=oe({h:[],v:[]}),w=A(()=>t.getEditCanvas.scale),L=A(()=>`${v.value*2}px`),N=A(()=>s.getDarkTheme?{bgColor:"#18181c",longfgColor:"#4d4d4d",shortfgColor:"#4d4d4d",fontColor:"#4d4d4d",shadowColor:"#18181c",borderColor:"#18181c",cornerActiveColor:"#18181c"}:{}),b=A(()=>s.getAppTheme),F=k=>{if(k.ctrlKey||k.metaKey){k.preventDefault();let R=w.value;if(k.wheelDelta>=0&&w.value<2){R=w.value+.05,t.setScale(R);return}k.wheelDelta<0&&w.value>.1&&(R=w.value-.05,t.setScale(R))}},W=()=>{if(!r.value)return;const k=r.value.getBoundingClientRect(),R=c.value.getBoundingClientRect();g.value=(k.left+Xt-R.left)/w.value,p.value=(k.top+Xt-R.top)/w.value},G=k=>{var E,T;if(k.preventDefault(),k.stopPropagation(),k.which==2)l.value=!0;else if(!((E=window.$KeyboardActive)!=null&&E.space))return;(T=document.activeElement)==null||T.blur();const R=k.pageX,P=k.pageY,d=ke(window,"mousemove",$=>{const M=$.pageX-R,H=$.pageY-P,[I,gt]=o,[mt,_t]=a;o=[gt,M],a=[_t,H],r.value.scrollLeft-=gt>I?Math.abs(gt-I):-Math.abs(gt-I),r.value.scrollTop-=_t>mt?Math.abs(_t-mt):-Math.abs(_t-mt)}),_=ke(window,"mouseup",()=>{d(),_(),o=[0,0],a=[0,0],l.value=!1})},K=()=>{const k=document.getElementById("go-chart-edit-layout");return k?{height:k.clientHeight-25,width:k.clientWidth}:{width:h.value,height:v.value}},S=()=>{f.value=!1,setTimeout(()=>{f.value=!0},10)},j=()=>{const{width:k,height:R}=i.value.getBoundingClientRect(),{width:P,height:d}=K();r.value.scrollLeft=k/2-P/2,r.value.scrollTop=R/2-d/2};return ht(()=>s.getDarkTheme,()=>{S()}),ht(()=>w.value,(k,R)=>{R!==k&&e.getRePositionCanvas?(e.setItemUnHandle(jt.RE_POSITION_CANVAS,!1),W(),setTimeout(()=>{j(),S()},400)):et(S,20)}),ht(()=>l.value,k=>{u.value=k?"grab":"auto"}),se(()=>{r.value&&(r.value.addEventListener("wheel",F,{passive:!1}),j())}),Pe(()=>{r.value&&r.value.removeEventListener("wheel",F)}),window.onKeySpacePressHold=k=>{l.value=k},(k,R)=>{const P=ct("sketch-rule");return D(),nt("div",Zs,[f.value?(D(),q(P,{key:0,thick:Xt,scale:w.value,width:K().width,height:K().height,startX:g.value,startY:p.value,lines:y,palette:N.value},null,8,["scale","width","height","startX","startY","lines","palette"])):Tt("",!0),B("div",{ref_key:"$app",ref:r,class:"edit-screens",onScroll:W},[B("div",{ref_key:"$container",ref:i,class:"edit-screen-container",style:at({width:C(h)*2+"px"})},[B("div",{ref_key:"refSketchRuleBox",ref:c,class:"canvas",onMousedown:G,style:at({marginLeft:"-"+(K().width/2-25)+"px"})},[B("div",{style:at({pointerEvents:l.value?"none":"auto"})},[ne(k.$slots,"default",{},void 0,!0)],4)],36)],4)],544),C(s).getDarkTheme?(D(),nt("div",tn)):Tt("",!0)])}}}),sn=ft(en,[["__scopeId","data-v-9b7f266a"]]);/*!
 * Signature Pad v4.1.5 | https://github.com/szimek/signature_pad
 * (c) 2023 Szymon Nowak | Released under the MIT license
 */class $t{constructor(t,e,s,o){if(isNaN(t)||isNaN(e))throw new Error(`Point is invalid: (${t}, ${e})`);this.x=+t,this.y=+e,this.pressure=s||0,this.time=o||Date.now()}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}equals(t){return this.x===t.x&&this.y===t.y&&this.pressure===t.pressure&&this.time===t.time}velocityFrom(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):0}}class de{constructor(t,e,s,o,a,r){this.startPoint=t,this.control2=e,this.control1=s,this.endPoint=o,this.startWidth=a,this.endWidth=r}static fromPoints(t,e){const s=this.calculateControlPoints(t[0],t[1],t[2]).c2,o=this.calculateControlPoints(t[1],t[2],t[3]).c1;return new de(t[1],s,o,t[2],e.start,e.end)}static calculateControlPoints(t,e,s){const o=t.x-e.x,a=t.y-e.y,r=e.x-s.x,f=e.y-s.y,c={x:(t.x+e.x)/2,y:(t.y+e.y)/2},i={x:(e.x+s.x)/2,y:(e.y+s.y)/2},l=Math.sqrt(o*o+a*a),u=Math.sqrt(r*r+f*f),h=c.x-i.x,v=c.y-i.y,g=u/(l+u),p={x:i.x+h*g,y:i.y+v*g},y=e.x-p.x,w=e.y-p.y;return{c1:new $t(c.x+y,c.y+w),c2:new $t(i.x+y,i.y+w)}}length(){let e=0,s,o;for(let a=0;a<=10;a+=1){const r=a/10,f=this.point(r,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),c=this.point(r,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(a>0){const i=f-s,l=c-o;e+=Math.sqrt(i*i+l*l)}s=f,o=c}return e}point(t,e,s,o,a){return e*(1-t)*(1-t)*(1-t)+3*s*(1-t)*(1-t)*t+3*o*(1-t)*t*t+a*t*t*t}}class nn{constructor(){try{this._et=new EventTarget}catch(t){this._et=document}}addEventListener(t,e,s){this._et.addEventListener(t,e,s)}dispatchEvent(t){return this._et.dispatchEvent(t)}removeEventListener(t,e,s){this._et.removeEventListener(t,e,s)}}function on(n,t=250){let e=0,s=null,o,a,r;const f=()=>{e=Date.now(),s=null,o=n.apply(a,r),s||(a=null,r=[])};return function(...i){const l=Date.now(),u=t-(l-e);return a=this,r=i,u<=0||u>t?(s&&(clearTimeout(s),s=null),e=l,o=n.apply(a,r),s||(a=null,r=[])):s||(s=window.setTimeout(f,u)),o}}class It extends nn{constructor(t,e={}){super(),this.canvas=t,this._drawningStroke=!1,this._isEmpty=!0,this._lastPoints=[],this._data=[],this._lastVelocity=0,this._lastWidth=0,this._handleMouseDown=s=>{s.buttons===1&&(this._drawningStroke=!0,this._strokeBegin(s))},this._handleMouseMove=s=>{this._drawningStroke&&this._strokeMoveUpdate(s)},this._handleMouseUp=s=>{s.buttons===1&&this._drawningStroke&&(this._drawningStroke=!1,this._strokeEnd(s))},this._handleTouchStart=s=>{if(s.cancelable&&s.preventDefault(),s.targetTouches.length===1){const o=s.changedTouches[0];this._strokeBegin(o)}},this._handleTouchMove=s=>{s.cancelable&&s.preventDefault();const o=s.targetTouches[0];this._strokeMoveUpdate(o)},this._handleTouchEnd=s=>{if(s.target===this.canvas){s.cancelable&&s.preventDefault();const a=s.changedTouches[0];this._strokeEnd(a)}},this._handlePointerStart=s=>{this._drawningStroke=!0,s.preventDefault(),this._strokeBegin(s)},this._handlePointerMove=s=>{this._drawningStroke&&(s.preventDefault(),this._strokeMoveUpdate(s))},this._handlePointerEnd=s=>{this._drawningStroke&&(s.preventDefault(),this._drawningStroke=!1,this._strokeEnd(s))},this.velocityFilterWeight=e.velocityFilterWeight||.7,this.minWidth=e.minWidth||.5,this.maxWidth=e.maxWidth||2.5,this.throttle="throttle"in e?e.throttle:16,this.minDistance="minDistance"in e?e.minDistance:5,this.dotSize=e.dotSize||0,this.penColor=e.penColor||"black",this.backgroundColor=e.backgroundColor||"rgba(0,0,0,0)",this._strokeMoveUpdate=this.throttle?on(It.prototype._strokeUpdate,this.throttle):It.prototype._strokeUpdate,this._ctx=t.getContext("2d"),this.clear(),this.on()}clear(){const{_ctx:t,canvas:e}=this;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._data=[],this._reset(this._getPointGroupOptions()),this._isEmpty=!0}fromDataURL(t,e={}){return new Promise((s,o)=>{const a=new Image,r=e.ratio||window.devicePixelRatio||1,f=e.width||this.canvas.width/r,c=e.height||this.canvas.height/r,i=e.xOffset||0,l=e.yOffset||0;this._reset(this._getPointGroupOptions()),a.onload=()=>{this._ctx.drawImage(a,i,l,f,c),s()},a.onerror=u=>{o(u)},a.crossOrigin="anonymous",a.src=t,this._isEmpty=!1})}toDataURL(t="image/png",e){switch(t){case"image/svg+xml":return typeof e!="object"&&(e=void 0),`data:image/svg+xml;base64,${btoa(this.toSVG(e))}`;default:return typeof e!="number"&&(e=void 0),this.canvas.toDataURL(t,e)}}on(){this.canvas.style.touchAction="none",this.canvas.style.msTouchAction="none",this.canvas.style.userSelect="none";const t=/Macintosh/.test(navigator.userAgent)&&"ontouchstart"in document;window.PointerEvent&&!t?this._handlePointerEvents():(this._handleMouseEvents(),"ontouchstart"in window&&this._handleTouchEvents())}off(){this.canvas.style.touchAction="auto",this.canvas.style.msTouchAction="auto",this.canvas.style.userSelect="auto",this.canvas.removeEventListener("pointerdown",this._handlePointerStart),this.canvas.removeEventListener("pointermove",this._handlePointerMove),this.canvas.ownerDocument.removeEventListener("pointerup",this._handlePointerEnd),this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove),this.canvas.ownerDocument.removeEventListener("mouseup",this._handleMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove),this.canvas.removeEventListener("touchend",this._handleTouchEnd)}isEmpty(){return this._isEmpty}fromData(t,{clear:e=!0}={}){e&&this.clear(),this._fromData(t,this._drawCurve.bind(this),this._drawDot.bind(this)),this._data=this._data.concat(t)}toData(){return this._data}_getPointGroupOptions(t){return{penColor:t&&"penColor"in t?t.penColor:this.penColor,dotSize:t&&"dotSize"in t?t.dotSize:this.dotSize,minWidth:t&&"minWidth"in t?t.minWidth:this.minWidth,maxWidth:t&&"maxWidth"in t?t.maxWidth:this.maxWidth,velocityFilterWeight:t&&"velocityFilterWeight"in t?t.velocityFilterWeight:this.velocityFilterWeight}}_strokeBegin(t){this.dispatchEvent(new CustomEvent("beginStroke",{detail:t}));const e=this._getPointGroupOptions(),s=Object.assign(Object.assign({},e),{points:[]});this._data.push(s),this._reset(e),this._strokeUpdate(t)}_strokeUpdate(t){if(this._data.length===0){this._strokeBegin(t);return}this.dispatchEvent(new CustomEvent("beforeUpdateStroke",{detail:t}));const e=t.clientX,s=t.clientY,o=t.pressure!==void 0?t.pressure:t.force!==void 0?t.force:0,a=this._createPoint(e,s,o),r=this._data[this._data.length-1],f=r.points,c=f.length>0&&f[f.length-1],i=c?a.distanceTo(c)<=this.minDistance:!1,l=this._getPointGroupOptions(r);if(!c||!(c&&i)){const u=this._addPoint(a,l);c?u&&this._drawCurve(u,l):this._drawDot(a,l),f.push({time:a.time,x:a.x,y:a.y,pressure:a.pressure})}this.dispatchEvent(new CustomEvent("afterUpdateStroke",{detail:t}))}_strokeEnd(t){this._strokeUpdate(t),this.dispatchEvent(new CustomEvent("endStroke",{detail:t}))}_handlePointerEvents(){this._drawningStroke=!1,this.canvas.addEventListener("pointerdown",this._handlePointerStart),this.canvas.addEventListener("pointermove",this._handlePointerMove),this.canvas.ownerDocument.addEventListener("pointerup",this._handlePointerEnd)}_handleMouseEvents(){this._drawningStroke=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove),this.canvas.ownerDocument.addEventListener("mouseup",this._handleMouseUp)}_handleTouchEvents(){this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove),this.canvas.addEventListener("touchend",this._handleTouchEnd)}_reset(t){this._lastPoints=[],this._lastVelocity=0,this._lastWidth=(t.minWidth+t.maxWidth)/2,this._ctx.fillStyle=t.penColor}_createPoint(t,e,s){const o=this.canvas.getBoundingClientRect();return new $t(t-o.left,e-o.top,s,new Date().getTime())}_addPoint(t,e){const{_lastPoints:s}=this;if(s.push(t),s.length>2){s.length===3&&s.unshift(s[0]);const o=this._calculateCurveWidths(s[1],s[2],e),a=de.fromPoints(s,o);return s.shift(),a}return null}_calculateCurveWidths(t,e,s){const o=s.velocityFilterWeight*e.velocityFrom(t)+(1-s.velocityFilterWeight)*this._lastVelocity,a=this._strokeWidth(o,s),r={end:a,start:this._lastWidth};return this._lastVelocity=o,this._lastWidth=a,r}_strokeWidth(t,e){return Math.max(e.maxWidth/(t+1),e.minWidth)}_drawCurveSegment(t,e,s){const o=this._ctx;o.moveTo(t,e),o.arc(t,e,s,0,2*Math.PI,!1),this._isEmpty=!1}_drawCurve(t,e){const s=this._ctx,o=t.endWidth-t.startWidth,a=Math.ceil(t.length())*2;s.beginPath(),s.fillStyle=e.penColor;for(let r=0;r<a;r+=1){const f=r/a,c=f*f,i=c*f,l=1-f,u=l*l,h=u*l;let v=h*t.startPoint.x;v+=3*u*f*t.control1.x,v+=3*l*c*t.control2.x,v+=i*t.endPoint.x;let g=h*t.startPoint.y;g+=3*u*f*t.control1.y,g+=3*l*c*t.control2.y,g+=i*t.endPoint.y;const p=Math.min(t.startWidth+i*o,e.maxWidth);this._drawCurveSegment(v,g,p)}s.closePath(),s.fill()}_drawDot(t,e){const s=this._ctx,o=e.dotSize>0?e.dotSize:(e.minWidth+e.maxWidth)/2;s.beginPath(),this._drawCurveSegment(t.x,t.y,o),s.closePath(),s.fillStyle=e.penColor,s.fill()}_fromData(t,e,s){for(const o of t){const{points:a}=o,r=this._getPointGroupOptions(o);if(a.length>1)for(let f=0;f<a.length;f+=1){const c=a[f],i=new $t(c.x,c.y,c.pressure,c.time);f===0&&this._reset(r);const l=this._addPoint(i,r);l&&e(l,r)}else this._reset(r),s(a[0],r)}}toSVG({includeBackgroundColor:t=!1}={}){const e=this._data,s=Math.max(window.devicePixelRatio||1,1),o=0,a=0,r=this.canvas.width/s,f=this.canvas.height/s,c=document.createElementNS("http://www.w3.org/2000/svg","svg");if(c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),c.setAttribute("viewBox",`${o} ${a} ${r} ${f}`),c.setAttribute("width",r.toString()),c.setAttribute("height",f.toString()),t&&this.backgroundColor){const i=document.createElement("rect");i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("fill",this.backgroundColor),c.appendChild(i)}return this._fromData(e,(i,{penColor:l})=>{const u=document.createElement("path");if(!isNaN(i.control1.x)&&!isNaN(i.control1.y)&&!isNaN(i.control2.x)&&!isNaN(i.control2.y)){const h=`M ${i.startPoint.x.toFixed(3)},${i.startPoint.y.toFixed(3)} C ${i.control1.x.toFixed(3)},${i.control1.y.toFixed(3)} ${i.control2.x.toFixed(3)},${i.control2.y.toFixed(3)} ${i.endPoint.x.toFixed(3)},${i.endPoint.y.toFixed(3)}`;u.setAttribute("d",h),u.setAttribute("stroke-width",(i.endWidth*2.25).toFixed(3)),u.setAttribute("stroke",l),u.setAttribute("fill","none"),u.setAttribute("stroke-linecap","round"),c.appendChild(u)}},(i,{penColor:l,dotSize:u,minWidth:h,maxWidth:v})=>{const g=document.createElement("circle"),p=u>0?u:(h+v)/2;g.setAttribute("r",p.toString()),g.setAttribute("cx",i.x.toString()),g.setAttribute("cy",i.y.toString()),g.setAttribute("fill",l),c.appendChild(g)}),c.outerHTML}}const an={class:"list-content"},rn={class:"list-content-img"},cn={ref:"signatureCanvas",id:"signatureCanvas"},ln=dt({__name:"index",props:{modalShow:{required:!0,type:Boolean}},emits:["close","edit"],setup(n,{emit:t}){const e=n,{HammerIcon:s}=Ke.ionicons5,o=z(!1),a=it();let r;ht(()=>e.modalShow,i=>{o.value=i,i&&He(()=>{const l=document.getElementById("signatureCanvas");l.width=1e3,l.height=350,l.style.backgroundColor="#FFFFFF",r=new It(l,{penColor:"black",backgroundColor:"rgba(0, 0, 0, 0)",minWidth:2,maxWidth:5})})},{immediate:!0}),oe([{label:cs("global.r_edit"),key:"edit",icon:ls(s)}]);const f=()=>{const i=r.toDataURL();a.setSingCanvas(i),o.value=!1},c=()=>{t("close")};return(i,l)=>{const u=ct("n-text"),h=ct("n-space"),v=ct("n-button"),g=ct("n-card"),p=ct("n-modal");return D(),q(p,{class:"go-modal-box",show:o.value,"onUpdate:show":l[1]||(l[1]=y=>o.value=y),onAfterLeave:c},{default:O(()=>[Y(g,{hoverable:"",size:"small"},{action:O(()=>[Y(h,{class:"list-footer",justify:"space-between"},{default:O(()=>[Y(u,{depth:"3"}),Y(h,null,{default:O(()=>[Y(v,{type:"primary",ghost:"",onClick:l[0]||(l[0]=y=>f())},{default:O(()=>[Rt(" 保存并关闭 ")]),_:1})]),_:1})]),_:1})]),default:O(()=>[B("div",an,[Y(h,{class:"list-content-top go-px-0",justify:"center"},{default:O(()=>[Y(h,null,{default:O(()=>[Y(u,null,{default:O(()=>[Rt(" 签名 ")]),_:1})]),_:1})]),_:1}),B("div",rn,[B("canvas",cn,null,512)])])]),_:1})]),_:1},8,["show"])}}}),un=ft(ln,[["__scopeId","data-v-7177ee91"]]),dn=n=>n,hn=(n,t)=>{try{if(t.id){const e="vnodeBeforeMount"in t.events,s="vnodeMounted"in t.events;return e&&(n.events.advancedEvents.vnodeBeforeMount=t==null?void 0:t.events.vnodeBeforeMount),s&&(n.events.advancedEvents.vnodeMounted=t==null?void 0:t.events.vnodeMounted),(e||s)&&(t.events={baseEvent:{[Mt.ON_CLICK]:void 0,[Mt.ON_DBL_CLICK]:void 0,[Mt.ON_MOUSE_ENTER]:void 0,[Mt.ON_MOUSE_LEAVE]:void 0},advancedEvents:{[ye.VNODE_MOUNTED]:void 0,[ye.VNODE_BEFORE_MOUNT]:void 0},interactEvents:[]}),n}}catch(e){return n}},vt=(n,t,e=!1)=>{if(hn(n,t),e)return Nt(n,t);const s=t.option;if(!s)return Nt(n,t);if(t.option=void 0,s)return xt(U({},Nt(n,t)),{option:s})},qe=()=>{const n=it(),t=vs(),e=Ye();return{updateComponent:(o,a=!1,r=!1)=>lt(void 0,null,function*(){a&&(n.componentList=[],t.clearBackStack(),t.clearForwardStack()),o.editCanvasConfig=dn(o.editCanvasConfig),o.componentList.forEach(c=>lt(void 0,null,function*(){const i=l=>{window.$vue.component(l.chartConfig.chartKey)||(window.$vue.component(l.chartConfig.chartKey,Fe(l.chartConfig)),window.$vue.component(l.chartConfig.conKey,We(l.chartConfig)))};c.isGroup?c.groupList.forEach(l=>{i(l)}):i(c)}));const f=(c,i)=>lt(void 0,null,function*(){let l=yield le(c.chartConfig);i?i(r?vt(l,xt(U({},c),{id:Bt()})):vt(l,c)):r?n.addComponentList(vt(l,xt(U({},c),{id:Bt()})),!1,!0):n.addComponentList(vt(l,c),!1,!0)});for(const c in o)if(c===ps.COMPONENT_LIST){let i=0;const l=o[c].length;for(const u of o[c]){let h=parseInt((parseFloat(`${++i/l}`)*100).toString());if(e.setItemUnHandle(jt.PERCENTAGE,h),u.isGroup){let v=new ms;r?v=vt(v,xt(U({},u),{id:Bt()})):v=vt(v,u);const g=[];for(const p of u.groupList)yield f(p,y=>{g.push(y)});v.groupList=g,n.addComponentList(v,!1,!0)}else yield f(u)}}else{if(c!=="editCanvasConfig"&&c!=="requestGlobalConfig")return;vt(n[c],o[c],!0)}e.setItemUnHandle(jt.PERCENTAGE,0)})}},fn=()=>{const n=z(),{updateComponent:t}=qe();return{importUploadFileListRef:n,importBeforeUpload:({file:o})=>{n.value=[];const a=o.file.type;return a!==xe.JSON&&a!==xe.TXT?(window.$message.warning("仅支持上传 【JSON】 格式文件，请重新上传！"),!1):!0},importCustomRequest:o=>{const{file:a}=o;He(()=>{a.file?xs(a.file).then(r=>{Cs({message:"请选择导入方式:",positiveText:"新增（可撤回）",negativeText:"覆盖（不可撤回）",negativeButtonProps:{type:"info",ghost:!1},onPositiveCallback:()=>lt(void 0,null,function*(){try{r=zt(r),yield t(r,!1,!0),window.$message.success("导入成功！")}catch(f){console.log(f),window.$message.error("组件导入失败，请检查文件完整性!")}}),onNegativeCallback:()=>lt(void 0,null,function*(){try{r=zt(r),yield t(r,!0,!0),window.$message.success("导入成功！")}catch(f){console.log(f),window.$message.error("组件导入失败，请检查文件完整性!")}})})}):window.$message.error("导入失败，请检查数据或联系管理员！")})}}},{updateComponent:gn}=qe(),Ve=it(),De=()=>{dispatchEvent(new CustomEvent(Pt.CHART_TO_PREVIEW,{detail:Ve.getStorageInfo}))},vn=()=>{const n=a=>{window.$message.success("正在进行更新..."),gn(a.detail,!0)},t=()=>{Ve.setEditCanvas(st.IS_CODE_EDIT,!1)},e=()=>{addEventListener("blur",De),addEventListener(Pt.JSON,n),addEventListener(Pt.CLOSE,et(t,1e3))},s=()=>{removeEventListener("blur",De),removeEventListener(Pt.JSON,n)};return(a,r)=>{r==Ce.CHART_HOME_NAME&&s(),a==Ce.CHART_HOME_NAME&&e()}},pn=()=>{const n=Ue();ht(()=>n.name,vn(),{immediate:!0})};var yt=(n=>(n.BUTTON="button",n.IMPORTUPLOAD="importUpload",n))(yt||{});const he=n=>(re("data-v-3ae714b2"),n=n(),ie(),n),mn={class:"btn-item"},_n={class:"blt-modal"},yn={class:"blt-modal-main"},Cn=he(()=>B("img",{style:{width:"400px","margin-left":"20px"},src:"https://enjoyer.vueadmin.com/blt/1.png",alt:"#"},null,-1)),wn={class:"blt-modal-text"},En=he(()=>B("div",null,"太棒了,恭喜你生成了一张属于你的数字艺术作品",-1)),xn=he(()=>B("div",null,"扫描下方二维码带走它",-1)),Sn=dt({__name:"index",setup(n){const{DownloadIcon:t,ShareIcon:e,PawIcon:s,SettingsSharpIcon:o,CreateIcon:a,Refresh:r}=Ke.ionicons5,f=Ie(),c=it(),{getPackagesList:i}=Ss();Ue(),pn();const l=z(!1);let u=null;const h=z(!1),v=z(!0),g=z(!0),{importUploadFileListRef:p,importCustomRequest:y,importBeforeUpload:w}=fn(),L=z(""),N=z("https://enjoyer.vueadmin.com/FrrQqKCTnoYwmrGLfAZePxF6hjxV"),b=z(!1),F=z(6e4),W=A(()=>f.getChartToolsStatus===we.ASIDE),G=A(()=>f.getChartToolsStatusHide),K=A(()=>v.value&&G.value),S=A(()=>{if(!W.value)return $;const M=[];return $.map(H=>{M.unshift(H)}),M}),j=()=>{u=setTimeout(()=>{v.value&&(v.value=!1,g.value=!0)},200),setTimeout(()=>{g.value=!1},400)},k=()=>{clearTimeout(u),v.value||(v.value=!0)},R=()=>{c.emptyComponentList(),E()},P=()=>{l.value=!0},d=()=>{l.value=!1},_=M=>lt(this,null,function*(){try{Be();const H=["Backgrounds","Rabbits","Clothing","Informations","Other"];Ee(M.chartKey,Fe(M)),Ee(M.conKey,We(M));let I=yield le(M);c.addComponentList(I,!1,!0),c.setTargetSelectChart(I.id),H.includes(M.package)&&c.setLock(!0,!0),Jt()}catch(H){Ne(),window.$message.warning("图表正在研发中, 敬请期待...")}}),E=()=>{const H=c.getComponentList.map(I=>I.key);H.includes("TextGroup")||i.Informations.map(I=>{I.key==="TextGroup"&&_(I)}),H.includes("TextCommon")||i.Informations.map(I=>{I.key==="TextCommon"&&_(I)}),H.includes("Other1")||i.Other.map(I=>{I.key==="Other1"&&_(I)}),H.includes("Other2")||i.Other.map(I=>{I.key==="Other2"&&_(I)})},T=()=>lt(this,null,function*(){console.log("getPackagesList ===>",c.getComponentList)}),$=[{key:"refresh",type:yt.BUTTON,name:"重置",icon:r,handle:R},{key:"sign",type:yt.BUTTON,name:"签名",icon:a,handle:P},{key:"create",type:yt.BUTTON,name:"生成",icon:t,handle:T}];return(M,H)=>{const I=ct("n-icon"),gt=ct("n-text"),mt=ct("n-button"),_t=ct("n-upload"),Je=ct("n-tooltip"),je=ct("n-image"),Qe=ct("n-modal");return D(),nt(Et,null,[B("div",{class:ut(["go-chart-edit-tools",[C(f).getChartToolsStatus,K.value?"isMini":"unMini"]]),onClick:H[1]||(H[1]=rt=>v.value&&(v.value=!1)),onMouseenter:j,onMouseleave:k},[Yt(Y(I,{class:"asideLogo",size:"22"},{default:O(()=>[Y(C(s))]),_:1},512),[[Kt,C(f).getChartToolsStatus===C(we).ASIDE&&K.value]]),(D(!0),nt(Et,null,kt(S.value,(rt,Ze)=>(D(),q(Je,{key:rt.key+Ze,disabled:!W.value||G.value&&g.value,trigger:"hover",placement:"left"},{trigger:O(()=>[B("div",mn,[rt.type===C(yt).BUTTON?(D(),q(mt,{key:0,circle:W.value,secondary:"",onClick:rt.handle},{icon:O(()=>[W.value?(D(),q(I,{key:0,size:"22"},{default:O(()=>[(D(),q(Ct(rt.icon)))]),_:2},1024)):(D(),q(Ct(rt.icon),{key:1}))]),default:O(()=>[Yt(Y(gt,{depth:"3"},{default:O(()=>[Rt(Lt(rt.name),1)]),_:2},1536),[[Kt,!W.value]])]),_:2},1032,["circle","onClick"])):rt.type===C(yt).IMPORTUPLOAD?(D(),q(_t,{key:1,"file-list":C(p),"onUpdate:fileList":H[0]||(H[0]=ts=>us(p)?p.value=ts:null),"show-file-list":!1,customRequest:C(y),onBeforeUpload:C(w)},{default:O(()=>[Y(mt,{circle:W.value,secondary:""},{icon:O(()=>[W.value?(D(),q(I,{key:0,size:"22"},{default:O(()=>[(D(),q(Ct(rt.icon)))]),_:2},1024)):(D(),q(Ct(rt.icon),{key:1}))]),default:O(()=>[Yt(Y(gt,{depth:"3"},{default:O(()=>[Rt(Lt(rt.name),1)]),_:2},1536),[[Kt,!W.value]])]),_:2},1032,["circle"])]),_:2},1032,["file-list","customRequest","onBeforeUpload"])):Tt("",!0)])]),default:O(()=>[B("span",null,Lt(rt.name),1)]),_:2},1032,["disabled"]))),128)),Y(Qe,{show:b.value},{default:O(()=>[B("div",_n,[B("div",yn,[Y(je,{width:"700",height:"350",src:L.value},null,8,["src"]),Cn]),B("div",wn,[En,xn,B("div",null,"解锁倒计时："+Lt(F.value/1e3),1)]),Y(_s,{class:"blt-group-qrcode",value:N.value,size:150,level:"H"},null,8,["value"])])]),_:1},8,["show"])],34),Y(C(Es),{modelShow:h.value,"onUpdate:modelShow":H[2]||(H[2]=rt=>h.value=rt)},null,8,["modelShow"]),Y(C(un),{modalShow:l.value,onClose:d},null,8,["modalShow"])],64)}}}),Tn=ft(Sn,[["__scopeId","data-v-3ae714b2"]]);const kn=n=>(re("data-v-2568ce09"),n=n(),ie(),n),Mn=kn(()=>B("img",{src:"https://enjoyer.vueadmin.com/blt/2.png",style:{width:"800px","margin-bottom":"20px"}},null,-1)),Ln=dt({__name:"index",setup(n){const{GO_CHART_LAYOUT_STORE:t}=fs,e=it(),{handleContextMenu:s}=ce();ds(ys,null),Ts();const{mouseenterHandle:o,mouseleaveHandle:a,mousedownHandle:r,mouseClickHandle:f,touchstartHandle:c}=ue(),i=(v,g,p)=>{if(e.getTargetChart.selectId.length>1)return g.filter(w=>[x.GROUP,x.DELETE].includes(w.key));const y=[];return p.status.lock?y.push(x.LOCK):y.push(x.UNLOCK),p.status.hide?y.push(x.HIDE):y.push(x.SHOW),v.filter(w=>!y.includes(w.key))},l=A(()=>e.getEditCanvasConfig.chartThemeSetting),u=A(()=>Oe(e.getEditCanvasConfig.chartCustomThemeColorInfo)[e.getEditCanvasConfig.chartThemeColor]);A(()=>e.getEditCanvasConfig.filterShow);const h=A(()=>({width:"inherit",height:"inherit"}));return se(()=>{Ds(),hs(t,{layers:!1,charts:!0,details:!0,chartType:"double",layerType:"thumbnail",percentage:0,rePositionCanvas:!0})}),(v,g)=>(D(),q(C(ws),{id:"go-chart-edit-layout",flex:!0,showTop:!1,showBottom:!0,depth:1,xScroll:!0,disabledScroll:!0,onMousedown:C(Ge),onDrop:C(Ps),onDragover:C(Te),onDragenter:C(Te)},{aside:O(()=>[Y(C(Tn))]),default:O(()=>[Y(C(sn),null,{default:O(()=>[Mn,B("div",{id:"go-chart-edit-content",onContextmenu:g[0]||(g[0]=(...p)=>C(s)&&C(s)(...p))},[Y(C(qs),null,{default:O(()=>[B("div",{class:"content-edit-range",style:at(U(U({},C(At)(C(e).getEditCanvasConfig)),h.value))},[(D(!0),nt(Et,null,kt(C(e).getComponentList,(p,y)=>(D(),nt("div",{key:p.id},[p.isGroup?(D(),q(C(Us),{key:0,groupData:p,groupIndex:y},null,8,["groupData","groupIndex"])):(D(),q(C(Zt),{key:1,"data-id":p.id,index:y,style:at(U(U({},C(Ot)(p.attr,y)),C($e)(p.styles))),item:p,onClick:w=>C(f)(w,p),onMousedown:w=>C(r)(w,p),onMouseenter:w=>C(o)(w,p),onMouseleave:w=>C(a)(w,p),onContextmenu:w=>C(s)(w,p,i),onTouchstart:w=>C(c)(w,p)},{default:O(()=>[(D(),q(Ct(p.chartConfig.chartKey),{class:ut(["edit-content-chart",C(qt)(p.styles.animations)]),chartConfig:p,themeSetting:l.value,themeColor:u.value,style:at(U(U(U({},C(pt)(p.attr)),C(At)(p.styles)),C(Vt)(p.styles)))},null,8,["class","chartConfig","themeSetting","themeColor","style"]))]),_:2},1032,["data-id","index","style","item","onClick","onMousedown","onMouseenter","onMouseleave","onContextmenu","onTouchstart"]))]))),128))],4)]),_:1})],32)]),_:1})]),_:1},8,["onMousedown","onDrop","onDragover","onDragenter"]))}}),Jn=ft(Ln,[["__scopeId","data-v-2568ce09"]]);export{Jn as default};
