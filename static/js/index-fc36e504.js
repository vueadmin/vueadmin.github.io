var m=(C,w,s)=>new Promise((F,i)=>{var t=o=>{try{r(s.next(o))}catch(e){i(e)}},p=o=>{try{r(s.throw(o))}catch(e){i(e)}},r=o=>o.done?F(o.value):Promise.resolve(o.value).then(t,p);r((s=s.apply(C,w)).next())});import{M as A}from"./EditorWorker-ee092c69.js";import"./editorWorker-43a98755.js";import{c as T,d as $,l as I,aB as g,aC as V,S as P,aD as v,r as a,e as M,g as n,w as u,ay as J,aE as L,o as f,q as R,h as _,u as c,E as y,a3 as D}from"./index-12776f38.js";import{g as j}from"./storage-f487701d.js";import{g as S}from"./plugin-ebadb7ac.js";import{i as z}from"./icon-54d2b417.js";import"./chartEditStore-3ab88adb.js";const G={class:"go-edit"},H=$({__name:"index",setup(C){const{ChevronBackOutlineIcon:w,DownloadIcon:s,AnalyticsIcon:F}=z.ionicons5,i=window.showOpenFilePicker,t=I("");window.$message.warning("请不要刷新此窗口！");function p(){return m(this,null,function*(){const e=yield j();J(`编辑-${e.editCanvasConfig.projectName}`),t.value=v(e)})}setTimeout(p);function r(){S({message:"导入数据将覆盖内容，此操作不可撤回，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>m(this,null,function*(){try{const d=yield(yield i())[0].getFile(),l=new FileReader;l.readAsText(d),l.onloadend=()=>{t.value=(l.result||"").toString()},window.$message.success("导入成功！")}catch(e){window.$message.error("导入失败，请检查文件是否损坏！"),console.log(e)}})})}window.opener.addEventListener(g.CHART,e=>{window.$message.success("正在进行更新..."),V(P.GO_CHART_STORAGE_LIST,[e.detail]),t.value=v(e.detail)}),document.addEventListener("keydown",function(e){e.keyCode==83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),o())});function o(){return m(this,null,function*(){if(!window.opener)return window.$message.error("源窗口已关闭，视图同步失败！");S({message:"是否覆盖源视图内容? 此操作不可撤！",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{try{const e=L(t.value);delete e.id,window.opener.dispatchEvent(new CustomEvent(g.JSON,{detail:e})),window.$message.success("正在同步内容...")}catch(e){window.$message.error("内容格式有误"),console.log(e)}}})})}return window.onbeforeunload=()=>{window.opener&&window.opener.dispatchEvent(new CustomEvent(g.CLOSE))},(e,d)=>{const l=a("n-text"),E=a("n-icon"),B=a("n-button"),k=a("n-tag"),x=a("n-space"),b=a("n-layout-header"),h=a("n-layout-content"),O=a("n-layout");return f(),M("div",G,[n(O,null,{default:u(()=>[n(b,{class:"go-edit-header go-px-5 go-flex-items-center",bordered:""},{default:u(()=>[R("div",null,[n(l,{class:"go-edit-title go-mr-4"},{default:u(()=>[_("页面在线编辑器")]),_:1}),c(i)?(f(),y(B,{key:0,class:"go-mr-3",size:"medium",onClick:r},{icon:u(()=>[n(E,null,{default:u(()=>[n(c(s))]),_:1})]),default:u(()=>[_(" 导入 ")]),_:1})):D("",!0)]),n(x,null,{default:u(()=>[n(k,{bordered:!1,type:"warning"},{default:u(()=>[_(" 「Ctrl + S 更新视图」 ")]),_:1}),c(i)?(f(),y(B,{key:0,class:"go-mr-3",size:"medium",onClick:o},{icon:u(()=>[n(E,null,{default:u(()=>[n(c(F))]),_:1})]),default:u(()=>[_(" 保存 ")]),_:1})):D("",!0)]),_:1})]),_:1}),n(h,null,{default:u(()=>[n(c(A),{modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=N=>t.value=N),language:"json",editorOptions:{lineNumbers:"on",minimap:{enabled:!0}}},null,8,["modelValue"])]),_:1})]),_:1})])}}}),ee=T(H,[["__scopeId","data-v-fb30eb60"]]);export{ee as default};
