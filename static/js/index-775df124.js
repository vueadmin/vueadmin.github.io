var me=Object.defineProperty,fe=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var se=(s,d,u)=>d in s?me(s,d,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[d]=u,Q=(s,d)=>{for(var u in d||(d={}))he.call(d,u)&&se(s,u,d[u]);if(oe)for(var u of oe(d))ve.call(d,u)&&se(s,u,d[u]);return s},Y=(s,d)=>fe(s,ge(d));var le=(s,d,u)=>new Promise((q,x)=>{var b=c=>{try{h(u.next(c))}catch(y){x(y)}},_=c=>{try{h(u.throw(c))}catch(y){x(y)}},h=c=>c.done?q(c.value):Promise.resolve(c.value).then(b,_);h((u=u.apply(s,d)).next())});import{d as L,j as R,J as X,a as o,o as i,D as T,w as a,b as e,c as C,n as f,u as t,e as v,h as V,bh as ie,O as _e,$ as K,a1 as G,a9 as te,F as J,q as ae,a5 as de,t as A,s as be,x as ye,l as qe,b_ as B,aT as W,bZ as ce,aU as M,L as xe,aQ as re,ae as Z,ag as we,bb as Pe,bz as De,bs as Ie,bt as Ce}from"./index-20fb0306.js";import{i as ee}from"./icon-cb727678.js";/* empty css                                                                      */import{S as U}from"./SettingItemBox-6e9bb9c5.js";import{r as Se}from"./chartEditStore-eb4e0443.js";import{n as $e}from"./noData-e5cefb25.js";import{u as ne}from"./useTargetData.hook-5df848dd.js";import{g as pe}from"./plugin-2033e7b2.js";import"./index-70c15a63.js";import{R as ke,a as Re}from"./pondIndex.vue_vue_type_style_index_0_scoped_bc18493e_lang-b0fac76f.js";import"./EditorWorker-26637c3c.js";import"./editorWorker-43a98755.js";import"./chartLayoutStore-b4f2137a.js";import"./index-63f16b81.js";import{u as Oe}from"./useSync.hook-b03903fa.js";import{S as j}from"./SettingItem-11e342fe.js";import{l as Ee}from"./lodash-819dc23a.js";import{C as Te}from"./index-210c33dd.js";import"./index-e3d67d15.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-561b5bfa.js";import"./chart-169a825c.js";import"./project.api-bcdd5979.js";import"./fileTypeEnum-21359a08.js";import"./file-84751f49.js";const Ue={class:"go-pr-3"},He=v("名称："),ze={key:1},Ne=v("取消"),Be=v("保存"),Ae=L({__name:"pondIndex",props:{modelShow:Boolean,targetDataRequest:Object},emits:["update:modelShow","editSaveHandle"],setup(s,{emit:d}){const u=s,{dataSyncUpdate:q}=Oe();R();const x=R(),b=R(!1);X(()=>u.modelShow,c=>{b.value=c});const _=()=>{d("update:modelShow",!1)},h=()=>{var c,y;if(!((c=u.targetDataRequest)!=null&&c.dataPondName)){window.$message.warning("请在左下角输入名称！"),(y=x.value)==null||y.focus();return}pe({message:"保存内容将同步修改所有使用此接口的组件, 是否继续?",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{d("update:modelShow",!1),d("editSaveHandle",u.targetDataRequest),q()}})};return(c,y)=>{const w=o("n-space"),p=o("n-scrollbar"),P=o("n-tag"),D=o("n-input"),I=o("n-button"),O=o("n-card"),E=o("n-modal");return i(),T(E,{class:"go-chart-data-request",show:b.value,"onUpdate:show":y[1]||(y[1]=g=>b.value=g),"mask-closable":!1,closeOnEsc:!1},{default:a(()=>[e(O,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:a(()=>[]),"header-extra":a(()=>[]),action:a(()=>[e(w,{justify:"space-between"},{default:a(()=>[s.targetDataRequest?(i(),T(w,{key:0},{default:a(()=>[e(P,{bordered:!1,type:"primary"},{default:a(()=>[He]),_:1}),e(D,{value:s.targetDataRequest.dataPondName,"onUpdate:value":y[0]||(y[0]=g=>s.targetDataRequest.dataPondName=g),ref_key:"inputInstRef",ref:x,type:"text",size:"small",autofocus:!0,clearable:!0,minlength:1,maxlength:16,placeholder:"请输入名称"},null,8,["value"])]),_:1})):(i(),C("span",ze)),e(w,null,{default:a(()=>[e(I,{onClick:_},{default:a(()=>[Ne]),_:1}),e(I,{type:"primary",onClick:h},{default:a(()=>[Be]),_:1})]),_:1})]),_:1})]),default:a(()=>[e(p,{style:{"max-height":"718px"}},{default:a(()=>[f("div",Ue,[e(w,{vertical:""},{default:a(()=>{var g;return[e(t(ke)),e(t(Re),{"target-data-request":(g=s.targetDataRequest)==null?void 0:g.dataPondRequestConfig},null,8,["target-data-request"])]}),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),Fe=V(Ae,[["__scopeId","data-v-bc18493e"]]),je=s=>(be("data-v-43dfb7fe"),s=s(),ye(),s),Le={class:"go-chart-data-pond-list"},Me={class:"pond-item-box"},Ge=je(()=>f("span",null," 创建 ",-1)),Ve=v(" 暂无数据内容， "),Je=v("立即创建"),Qe=["onClick"],Ye={class:"item-content"},We={class:"item-content-body"},Xe=v(" 名称 "),Ze=v(" 地址 "),Ke=["onClick"],et=L({__name:"index",emits:["createPond","deletePond"],setup(s,{emit:d}){ie(D=>({"1013e1a5":t(y)}));const{DuplicateOutlineIcon:u,TrashIcon:q}=ee.ionicons5,x=_e(),{chartEditStore:b,targetData:_}=ne(),{requestDataPond:h}=K(b.getRequestGlobalConfig),c=G(()=>_.value.request.requestDataPondId),y=G(()=>x.getAppTheme),w=()=>{d("createPond",!0)},p=(D,I)=>{D.stopPropagation(),D.preventDefault(),d("deletePond",I)},P=D=>{_.value.request.requestDataPondId=D.dataPondId};return(D,I)=>{const O=o("n-timeline-item"),E=o("n-timeline"),g=o("n-icon"),z=o("n-button"),H=o("n-divider"),n=o("n-a"),l=o("n-text"),m=o("n-space"),$=o("n-tag"),S=o("n-ellipsis"),N=o("n-scrollbar");return i(),C("div",Le,[e(E,{class:"pond-item-timeline",style:{width:"20px"}},{default:a(()=>[e(O,{type:"info"}),e(O,{type:"success"})]),_:1}),f("div",Me,[e(z,{class:"create-btn go-py-4",ghost:"",onClick:w},{icon:a(()=>[e(g,null,{default:a(()=>[e(t(u))]),_:1})]),default:a(()=>[Ge]),_:1}),e(H,{style:{margin:"10px 0"}}),t(h).length?te("",!0):(i(),T(m,{key:0,justify:"center"},{default:a(()=>[e(l,{class:"not-layer-text",depth:3},{default:a(()=>[Ve,e(n,{onClick:w},{default:a(()=>[Je]),_:1})]),_:1})]),_:1})),e(N,{style:{"max-height":"490px"}},{default:a(()=>[(i(!0),C(J,null,ae(t(h),r=>(i(),C("div",{key:r.dataPondId,class:de([{select:r.dataPondId===t(c)},"pond-item"]),onClick:F=>P(r)},[f("div",Ye,[f("div",We,[f("div",null,[e($,{class:"go-mr-1",type:r.dataPondId===t(c)?"warning":"",bordered:!1},{default:a(()=>[Xe]),_:2},1032,["type"]),e(S,{style:{"max-width":"180px"}},{default:a(()=>[v(A(r.dataPondName||"暂无"),1)]),_:2},1024)]),f("div",null,[e($,{class:"go-mr-1",type:r.dataPondId===t(c)?"warning":"",bordered:!1},{default:a(()=>[Ze]),_:2},1032,["type"]),e(S,{style:{"max-width":"180px"}},{default:a(()=>[v(A(r.dataPondRequestConfig.requestUrl||"暂无"),1)]),_:2},1024)])]),f("div",{class:"item-content-icon go-transition-quick",onClick:F=>p(F,r)},[e(g,null,{default:a(()=>[e(t(q))]),_:1})],8,Ke)]),f("div",{class:de({"select-modal":r.dataPondId===t(c)})},null,2)],10,Qe))),128))]),_:1})])])}}});const tt=V(et,[["__scopeId","data-v-43dfb7fe"]]),at=f("thead",null,[f("tr",null,[f("th",null,"key"),f("th",null,"value")])],-1),ue=L({__name:"displayTable",props:{target:Object},setup(s){const d=s,u={key:"",value:""},q=qe({content:[]});return X(()=>d.target,x=>{q.content=[];for(const b in x)q.content.push({key:b,value:x[b]});q.content.length||(q.content=[JSON.parse(JSON.stringify(u))])},{immediate:!0,deep:!0}),(x,b)=>{const _=o("n-table");return i(),T(_,{bordered:!1,"single-line":!1,size:"small",style:{"border-bottom-right-radius":"7px","border-bottom-left-radius":"7px"}},{default:a(()=>[at,f("tbody",null,[(i(!0),C(J,null,ae(q.content,(h,c)=>(i(),C("tr",{key:c},[f("td",null,A(h.key||"暂无"),1),f("td",null,A(h.value||"暂无"),1)]))),128))])]),_:1})}}}),nt={class:"go-chart-data-display"},ot={class:"go-mr-3"},st={key:0},lt={class:"go-mt-3"},dt={key:0},ct={key:1},rt=v("该接口没有 Body 体"),ut={key:1},it=v("sql"),_t=L({__name:"index",props:{globalData:Object,targetData:Object},setup(s){const d=s,{HelpOutlineIcon:u,FlashIcon:q,PulseIcon:x}=ee.ionicons5,{requestUrl:b,requestInterval:_,requestHttpType:h,requestContentType:c,requestSQLContent:y,requestParams:w,requestParamsBodyType:p,requestIntervalUnit:P}=K(d.targetData.dataPondRequestConfig);B.HEADER;const D={[W.DEFAULT]:"普通请求",[W.SQL]:"SQL 请求"},I=R(B.PARAMS);return(O,E)=>{const g=o("n-input"),z=o("n-icon"),H=o("n-divider"),n=o("n-tab"),l=o("n-tabs"),m=o("n-text"),$=o("n-card"),S=o("n-code"),N=o("n-scrollbar");return i(),C("div",nt,[e(N,{style:{"max-height":"570px"}},{default:a(()=>[f("div",ot,[f("div",null,[e(t(U),{name:"主体信息"},{default:a(()=>[e(t(j),{name:"接口名称"},{default:a(()=>{var r;return[e(g,{size:"small",placeholder:((r=s.targetData)==null?void 0:r.dataPondName)||"暂无",disabled:!0},null,8,["placeholder"])]}),_:1}),e(t(j),{name:"接口类型"},{default:a(()=>[e(g,{size:"small",placeholder:t(h)||"暂无",disabled:!0},null,8,["placeholder"])]),_:1})]),_:1}),e(t(U),null,{default:a(()=>[e(t(j),{name:"组件间隔"},{default:a(()=>[e(g,{size:"small",placeholder:`${t(_)||"暂无"}`,disabled:!0},{suffix:a(()=>[v(A(s.targetData&&t(ce)[t(P)]),1)]),_:1},8,["placeholder"])]),_:1}),e(t(j),{name:"全局间隔（默认）"},{default:a(()=>{var r;return[e(g,{size:"small",placeholder:`${((r=s.globalData)==null?void 0:r.requestInterval)||"暂无"}`,disabled:!0},{suffix:a(()=>[v(A(s.globalData&&t(ce)[s.globalData.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]}),_:1})]),_:1}),e(t(U),{name:"源地址",alone:!0},{default:a(()=>{var r;return[e(g,{size:"small",placeholder:((r=s.globalData)==null?void 0:r.requestOriginUrl)||"暂无",disabled:!0},{prefix:a(()=>[e(z,{component:t(x)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(t(U),{name:"接口地址",alone:!0},{default:a(()=>[e(g,{size:"small",placeholder:t(b)||"暂无",disabled:!0},{prefix:a(()=>[e(z,{component:t(q)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1})]),e(H),e(t(U),{name:"类型"},{default:a(()=>[e(t(j),{name:"配置类型"},{default:a(()=>[e(g,{size:"small",placeholder:s.targetData&&D[t(c)],disabled:!0},null,8,["placeholder"])]),_:1}),t(c)===t(W).DEFAULT?(i(),T(t(j),{key:0,name:"body 类型"},{default:a(()=>[e(g,{size:"small",placeholder:s.targetData&&t(p),disabled:!0},null,8,["placeholder"])]),_:1})):te("",!0)]),_:1}),t(c)===t(W).DEFAULT?(i(),C("div",st,[e(l,{type:"line",animated:"",value:I.value,"onUpdate:value":E[0]||(E[0]=r=>I.value=r)},{default:a(()=>[(i(!0),C(J,null,ae(t(B),r=>(i(),T(n,{key:r,name:r,tab:r},{default:a(()=>[v(A(r),1)]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),f("div",lt,[I.value!==t(B).BODY?(i(),C("div",dt,[e(ue,{class:"go-my-3",target:t(w)[I.value]},null,8,["target"])])):(i(),C("div",ct,[t(p)===t(M).NONE?(i(),T($,{key:0,class:"go-mt-3 go-pb-3"},{default:a(()=>[e(m,{depth:"3"},{default:a(()=>[rt]),_:1})]),_:1})):t(p)===t(M).FORM_DATA||t(p)===t(M).X_WWW_FORM_URLENCODED?(i(),T(ue,{key:1,class:"go-my-3",target:t(w)[t(B).BODY][t(p)]},null,8,["target"])):t(p)===t(M).JSON?(i(),T($,{key:2,size:"small",style:{"padding-bottom":"7px"}},{default:a(()=>[e(S,{code:t(w)[t(B).BODY][t(p)]||"暂无内容",language:"json"},null,8,["code"])]),_:1})):t(p)===t(M).XML?(i(),T(S,{key:3,code:t(w)[t(B).BODY][t(p)]||"",language:"html"},null,8,["code"])):te("",!0)]))])])):(i(),C("div",ut,[e(t(U),{name:"键名"},{default:a(()=>[e(m,null,{default:a(()=>[it]),_:1})]),_:1}),e(t(U),{name:"键值"},{default:a(()=>[e(S,{code:t(y).sql||"",language:"sql"},null,8,["code"])]),_:1})]))])]),_:1})])}}});const pt=V(_t,[["__scopeId","data-v-cc877db2"]]),mt={class:"pond-content"},ft={key:1,class:"no-data go-flex-center"},gt=["src"],ht=v("暂未选择公共接口"),vt=v(" 编辑内容 "),bt=v("保存 & 发送请求"),yt=L({__name:"index",props:{modelShow:Boolean},emits:["update:modelShow","sendHandle"],setup(s,{emit:d}){const u=s,{PencilIcon:q}=ee.ionicons5,{chartEditStore:x,targetData:b}=ne(),{requestDataPond:_}=K(x.getRequestGlobalConfig),h=R(!1),c=R(!1),y=R(!1),w=R(!1),p=R(),P=G(()=>{var m,$;const n=($=(m=b==null?void 0:b.value)==null?void 0:m.request)==null?void 0:$.requestDataPondId;return n?_.value.filter(S=>n===S.dataPondId)[0]:void 0});X(()=>u.modelShow,n=>{c.value=n}),X(()=>P.value,n=>{y.value=!0,p.value=n,we(()=>{y.value=!1})},{immediate:!0});const D=(n=!1)=>{w.value=!!n,h.value=!0},I=()=>{const n=xe();p.value={dataPondId:n,dataPondName:n,dataPondRequestConfig:Ee.cloneDeep(Y(Q({},Se),{requestDataType:re.Pond}))},D()},O=n=>{w.value?E(n):g(n),w.value=!1,h.value=!1},E=n=>{try{const l=_.value.findIndex(m=>m.dataPondId===n.dataPondId);l!==-1?(_.value.splice(l,1,n),x.getComponentList.forEach(m=>{m.request.requestDataType===re.Pond&&m.request.requestDataPondId===n.dataPondId&&(m.request=Y(Q({},Z(n.dataPondRequestConfig)),{requestDataPondId:n.dataPondId}))}),window.$message.success("保存成功！")):window.$message.error("编辑失败，请稍后重试！")}catch(l){window.$message.error("编辑失败，请稍后重试！")}},g=n=>{try{p.value?(_.value.unshift(n),window.$message.success("创建成功!")):window.$message.error("创建失败，请稍后重试!")}catch(l){window.$message.error("创建失败，请稍后重试!")}},z=n=>{pe({message:"删除数据后，需手动处理使用改接口的组件，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{const l=_.value.findIndex(m=>m.dataPondId===n.dataPondId);l!==-1?(_.value.splice(l,1),window.$message.success("删除成功!")):window.$message.error("删除失败，请稍后重试！")}})},H=()=>{P.value&&(b.value.request=Y(Q({},Z(P.value.dataPondRequestConfig)),{requestDataPondId:P.value.dataPondId})),d("update:modelShow",!1),d("sendHandle")};return(n,l)=>{const m=o("n-text"),$=o("n-icon"),S=o("n-button"),N=o("n-space"),r=o("n-card"),F=o("n-modal");return i(),C(J,null,[e(F,{class:"go-chart-data-pond-control",show:c.value,"onUpdate:show":l[1]||(l[1]=k=>c.value=k),"mask-closable":!1},{default:a(()=>[e(r,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"900px",height:"650px"}},{header:a(()=>[]),"header-extra":a(()=>[]),action:a(()=>[e(N,{justify:"space-between"},{default:a(()=>[e(S,{type:"info",secondary:"",disabled:!t(P),onClick:l[0]||(l[0]=k=>D(!0))},{icon:a(()=>[e($,null,{default:a(()=>[e(t(q))]),_:1})]),default:a(()=>[vt]),_:1},8,["disabled"]),e(S,{type:"primary",onClick:H},{default:a(()=>[bt]),_:1})]),_:1})]),default:a(()=>[f("div",mt,[t(P)&&!y.value?(i(),T(t(pt),{key:0,targetData:t(P),globalData:t(x).getRequestGlobalConfig},null,8,["targetData","globalData"])):(i(),C("div",ft,[f("img",{src:t($e),alt:"暂无数据"},null,8,gt),e(m,{depth:3},{default:a(()=>[ht]),_:1})])),e(t(tt),{onCreatePond:I,onDeletePond:z})])]),_:1})]),_:1},8,["show"]),e(t(Fe),{modelShow:h.value,"onUpdate:modelShow":l[2]||(l[2]=k=>h.value=k),targetDataRequest:p.value,isEdit:w.value,onEditSaveHandle:O},null,8,["modelShow","targetDataRequest","isEdit"])],64)}}});const qt=V(yt,[["__scopeId","data-v-f251a5df"]]),xt={class:"go-chart-data-pond"},wt={class:"go-absolute-center"},Pt=v("编辑配置"),Dt=v(" 测试 "),It=v(" 默认赋值给 dataset 字段 "),Ct=v(" 发送请求 "),St=L({__name:"index",setup(s){ie(n=>({"5189590e":t(g)}));const d=_e(),{HelpOutlineIcon:u,FlashIcon:q,PulseIcon:x,FishIcon:b}=ee.ionicons5,{targetData:_,chartEditStore:h}=ne(),{requestDataPond:c,requestInterval:y,requestIntervalUnit:w}=K(h.getRequestGlobalConfig),p=R(!1),P=R(!1),D=R(!1);let I=0,O;const E=G(()=>{const n=_.value.request.requestDataPondId;return n?c.value.filter(m=>n===m.dataPondId)[0]:void 0}),g=G(()=>d.getAppTheme),z=()=>{P.value=!0},H=()=>le(this,null,function*(){var n;if(!((n=_.value)!=null&&n.request)){window.$message.warning("请选择一个公共接口！");return}p.value=!0;try{const l=yield Ie(Z(_.value.request),Z(h.getRequestGlobalConfig));if(p.value=!1,l){if(!(l!=null&&l.data)&&!_.value.filter){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),D.value=!0;return}_.value.option.dataset=Ce(l==null?void 0:l.data,l,_.value.filter),D.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(l){console.error(l),p.value=!1,window.$message.warning("数据异常，请检查参数！")}});return Pe(()=>{var l;const n=(l=_.value)==null?void 0:l.filter;O!==n&&I&&(O=n,H()),I++}),De(()=>{O=null}),(n,l)=>{const m=o("n-icon"),$=o("n-input"),S=o("n-button"),N=o("n-card"),r=o("n-tooltip"),F=o("go-skeleton");return i(),C(J,null,[f("div",xt,[e(N,{class:"n-card-shallow"},{default:a(()=>[e(t(U),{name:"请求名称",alone:!0},{default:a(()=>{var k;return[e($,{size:"small",placeholder:((k=t(E))==null?void 0:k.dataPondName)||"暂无",disabled:!0},{prefix:a(()=>[e(m,{component:t(b)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(t(U),{name:"接口地址",alone:!0},{default:a(()=>{var k;return[e($,{size:"small",placeholder:((k=t(E))==null?void 0:k.dataPondRequestConfig.requestUrl)||"暂无",disabled:!0},{prefix:a(()=>[e(m,{component:t(q)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),f("div",{class:"edit-text",onClick:z},[f("div",wt,[e(S,{type:"primary",secondary:""},{default:a(()=>[Pt]),_:1})])])]),_:1})]),e(t(U),{alone:!0},{name:a(()=>[Dt,e(r,{trigger:"hover"},{trigger:a(()=>[e(m,{size:"21",depth:3},{default:a(()=>[e(t(u))]),_:1})]),default:a(()=>[It]),_:1})]),default:a(()=>[e(S,{type:"primary",ghost:"",onClick:H},{icon:a(()=>[e(m,null,{default:a(()=>[e(t(q))]),_:1})]),default:a(()=>[Ct]),_:1})]),_:1}),e(t(Te),{show:D.value&&!p.value,ajax:!0},null,8,["show"]),e(F,{load:p.value,repeat:3},null,8,["load"]),e(t(qt),{modelShow:P.value,"onUpdate:modelShow":l[0]||(l[0]=k=>P.value=k),onSendHandle:H},null,8,["modelShow"])],64)}}});const ea=V(St,[["__scopeId","data-v-19fefd48"]]);export{ea as default};
