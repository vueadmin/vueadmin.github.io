var Q=(v,_,x)=>new Promise((R,f)=>{var g=i=>{try{p(x.next(i))}catch(h){f(h)}},s=i=>{try{p(x.throw(i))}catch(h){f(h)}},p=i=>i.done?R(i.value):Promise.resolve(i.value).then(g,s);p((x=x.apply(v,_)).next())});import{d as oe,$ as X,j as S,a1 as J,J as ne,a,o as b,c as A,u as n,D as E,w as e,b as t,n as r,c0 as B,F as P,e as l,s as ue,x as de,af as _e,bs as fe,ae as K,h as ae,ag as pe,aN as me,aM as he,Q as W,U as Y,q as Z,t as D,bm as ve,a9 as ge,aQ as ye,b6 as we}from"./index-20fb0306.js";import{e as ee}from"./chartEditStore-eb4e0443.js";import{i as L}from"./icon-cb727678.js";import{T as H,D as z}from"./index-70c15a63.js";import{u as se}from"./useTargetData.hook-5df848dd.js";import{M as be}from"./EditorWorker-26637c3c.js";import"./editorWorker-43a98755.js";import{g as xe}from"./plugin-2033e7b2.js";import{F as te}from"./fileTypeEnum-21359a08.js";import{r as Ce,d as Se}from"./file-84751f49.js";const G=v=>(ue("data-v-eac7a30e"),v=v(),de(),v),ke=G(()=>r("p",null,[r("span",{class:"func-keyword"},"function"),l("  filter(data, res)  {")],-1)),Fe={class:"go-ml-4"},Te=G(()=>r("p",null,"}",-1)),Re=l(" 编辑 "),Ee=l(" 删除 "),$e=l(" 新增过滤器 "),qe=l("过滤器函数编辑器"),je=G(()=>r("span",{class:"func-keyword"},"function",-1)),Ie=l("  filter(data, res)  { "),Ne=l("}"),Ue={class:"editor-data-show"},De=l("默认过滤数据(data)："),ze={class:"editor-data-show"},Ae=l("接口返回数据(res)："),Be={class:"editor-data-show"},Le=l("过滤器结果："),Me={class:"go-flex-items-center"},Oe=l(" 规则 "),Ve=l("过滤器默认处理接口返回值的「data」字段"),He=l("取消"),Je=l("保存"),Pe=oe({__name:"index",setup(v){const{DocumentTextIcon:_}=L.ionicons5,{FilterIcon:x,FilterEditIcon:R}=L.carbon,{targetData:f,chartEditStore:g}=se();X(f.value.request),X(g.getRequestGlobalConfig);const s=S(!1),p=S(f.value.filter||"return data"),i=S(!1),h=S(""),$=()=>Q(this,null,function*(){try{const m=yield fe(K(f.value.request),K(g.getRequestGlobalConfig));if(m){h.value=m;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(m){console.error(m),window.$message.warning("数据异常，请检查参数！")}}),M=J(()=>{try{const m=new Function("data","res",p.value),y=_e(h.value),o=m(y==null?void 0:y.data,y);return i.value=!1,B(o)}catch(m){return i.value=!0,`过滤函数错误，日志：${m}`}}),j=()=>{s.value=!0},O=()=>{xe({message:"是否删除过滤器",onPositiveCallback:()=>{f.value.filter=void 0}})},I=()=>{s.value=!1},N=()=>{if(i.value){window.$message.error("过滤函数错误，无法进行保存");return}f.value.filter=p.value,I()};return ne(()=>s.value,m=>{m&&($(),p.value=f.value.filter||"return data")}),(m,y)=>{const o=a("n-code"),c=a("n-icon"),d=a("n-button"),u=a("n-space"),C=a("n-card"),F=a("n-text"),T=a("n-tag"),q=a("n-divider"),U=a("n-scrollbar"),V=a("n-modal");return b(),A(P,null,[n(f).filter?(b(),E(C,{key:0},{footer:e(()=>[t(u,{justify:"end"},{default:e(()=>[t(d,{type:"primary",tertiary:"",size:"small",onClick:j},{icon:e(()=>[t(c,null,{default:e(()=>[t(n(R))]),_:1})]),default:e(()=>[Re]),_:1}),t(d,{tertiary:"",size:"small",onClick:O},{default:e(()=>[Ee]),_:1})]),_:1})]),default:e(()=>[ke,r("div",Fe,[t(o,{code:n(f).filter,language:"typescript"},null,8,["code"])]),Te]),_:1})):(b(),E(d,{key:1,class:"go-ml-3",onClick:j},{icon:e(()=>[t(c,null,{default:e(()=>[t(n(x))]),_:1})]),default:e(()=>[$e]),_:1})),t(V,{class:"go-chart-data-monaco-editor",show:s.value,"onUpdate:show":y[1]||(y[1]=k=>s.value=k),"mask-closable":!1,closeOnEsc:!1},{default:e(()=>[t(C,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"600px"}},{header:e(()=>[t(u,null,{default:e(()=>[t(F,null,{default:e(()=>[qe]),_:1})]),_:1})]),"header-extra":e(()=>[]),action:e(()=>[t(u,{justify:"space-between"},{default:e(()=>[r("div",Me,[t(T,{bordered:!1,type:"primary"},{icon:e(()=>[t(c,{component:n(_)},null,8,["component"])]),default:e(()=>[Oe]),_:1}),t(F,{class:"go-ml-2",depth:"2"},{default:e(()=>[Ve]),_:1})]),t(u,null,{default:e(()=>[t(d,{size:"medium",onClick:I},{default:e(()=>[He]),_:1}),t(d,{size:"medium",type:"primary",onClick:N},{default:e(()=>[Je]),_:1})]),_:1})]),_:1})]),default:e(()=>[t(u,{size:"small",vertical:""},{default:e(()=>[t(u,{justify:"space-between"},{default:e(()=>[r("div",null,[t(u,{vertical:""},{default:e(()=>[t(T,{type:"info"},{default:e(()=>[je,Ie]),_:1}),t(n(be),{modelValue:p.value,"onUpdate:modelValue":y[0]||(y[0]=k=>p.value=k),width:"460px",height:"380px",language:"javascript"},null,8,["modelValue"]),t(T,{type:"info"},{default:e(()=>[Ne]),_:1})]),_:1})]),t(q,{vertical:"",style:{height:"480px"}}),t(U,{style:{"max-height":"480px"}},{default:e(()=>[t(u,{size:15,vertical:""},{default:e(()=>[r("div",Ue,[t(u,null,{default:e(()=>{var k;return[t(F,{depth:"3"},{default:e(()=>[De]),_:1}),t(o,{code:n(B)((k=h.value)==null?void 0:k.data)||"暂无",language:"json","word-wrap":!0},null,8,["code"])]}),_:1})]),r("div",ze,[t(u,null,{default:e(()=>[t(F,{depth:"3"},{default:e(()=>[Ae]),_:1}),t(o,{code:n(B)(h.value)||"暂无",language:"json","word-wrap":!0},null,8,["code"])]),_:1})]),r("div",Be,[t(u,null,{default:e(()=>[t(F,{depth:"3"},{default:e(()=>[Le]),_:1}),t(o,{code:n(M)||"暂无",language:"json","word-wrap":!0},null,8,["code"])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])],64)}}});const Ge=ae(Pe,[["__scopeId","data-v-eac7a30e"]]),Qe=v=>{const _=S();return{uploadFileListRef:_,beforeUpload:({file:g})=>{_.value=[];const s=g.file.type;return s!==te.JSON&&s!==te.TXT?(window.$message.warning("仅支持上传 【JSON】 格式文件，请重新上传！"),!1):!0},customRequest:g=>{const{file:s}=g;pe(()=>{s.file?Ce(s.file).then(p=>{v.value.option.dataset=me(p)}):window.$message.error("导入数据失败，请稍后重试或联系管理员！")})},download:()=>{try{window.$message.success("下载中，请耐心等待..."),Se(he(v.value.option.dataset),void 0,"json")}catch(g){window.$message.error("下载失败，数据错误！")}}}},Xe=l("无"),Ke=l("过滤器默认处理接口返回值的「data」字段"),We=l(" 导入（json / txt） "),Ye=l(" 下载 "),Ze=l("点击【下载】查看完整数据"),et=oe({__name:"index",props:{show:{type:Boolean,required:!1},ajax:{type:Boolean,required:!0}},setup(v){const{targetData:_}=se(),x=["字段","映射","状态"],{HelpOutlineIcon:R}=L.ionicons5,{DocumentAddIcon:f,DocumentDownloadIcon:g}=L.carbon,s=S(),p=S(),i=S(),h=S(!1),{uploadFileListRef:$,customRequest:M,beforeUpload:j,download:O}=Qe(_),I=J(()=>_.value.request.requestDataType!==ye.STATIC),N=J(()=>_.value.chartConfig.chartFrame===ee.ECHARTS),m=o=>{let c=z.SUCCESS;for(let d=0;d<s.value.length;d++)if(s.value[d][o]===void 0)return c=z.FAILURE,c;return z.SUCCESS},y=()=>{try{return p.value.map((o,c)=>c===0?{field:"通用标识",mapping:o,result:z.NULL}:{field:`数据项-${c}`,mapping:o,result:m(o)})}catch(o){return[]}};return ne(()=>{var o,c;return(c=(o=_.value)==null?void 0:o.option)==null?void 0:c.dataset},o=>{var c,d;o&&((d=(c=_==null?void 0:_.value)==null?void 0:c.chartConfig)==null?void 0:d.chartFrame)===ee.ECHARTS?(s.value=o,N.value&&(p.value=o.dimensions,i.value=y())):o!=null?(i.value=null,s.value=o):(h.value=!0,s.value="此组件无数据源"),we(o)&&(i.value=null)},{immediate:!0}),(o,c)=>{const d=a("n-badge"),u=a("n-text"),C=a("n-space"),F=a("n-table"),T=a("n-timeline-item"),q=a("n-icon"),U=a("n-button"),V=a("n-upload"),k=a("n-tooltip"),le=a("n-code"),ce=a("n-card"),re=a("n-timeline");return b(),E(re,{class:"go-chart-configurations-timeline"},{default:e(()=>[W(t(T,{type:"info",title:n(H).MAPPING},{default:e(()=>[t(F,{striped:""},{default:e(()=>[r("thead",null,[r("tr",null,[(b(),A(P,null,Z(x,w=>r("th",{key:w},D(w),1)),64))])]),r("tbody",null,[(b(!0),A(P,null,Z(i.value,(w,ie)=>(b(),A("tr",{key:ie},[r("td",null,D(w.field),1),r("td",null,D(w.mapping),1),r("td",null,[w.result===0?(b(),E(C,{key:0},{default:e(()=>[t(d,{dot:"",type:"success"}),t(u,null,{default:e(()=>[Xe]),_:1})]),_:1})):(b(),E(C,{key:1},{default:e(()=>[t(d,{dot:"",type:w.result===1?"success":"error"},null,8,["type"]),t(u,null,{default:e(()=>[l("匹配"+D(w.result===1?"成功":"失败"),1)]),_:2},1024)]),_:2},1024))])]))),128))])]),_:1})]),_:1},8,["title"]),[[Y,n(N)&&i.value]]),W(t(T,{color:"#97846c",title:n(H).FILTER},{default:e(()=>[t(C,{size:18,vertical:""},{default:e(()=>[t(u,{depth:"3"},{default:e(()=>[Ke]),_:1}),t(n(Ge))]),_:1})]),_:1},8,["title"]),[[Y,n(I)]]),t(T,{type:"success",title:n(H).CONTENT},{default:e(()=>[t(C,{vertical:""},{default:e(()=>[t(C,{class:"source-btn-box"},{default:e(()=>[t(V,{"file-list":n($),"onUpdate:file-list":c[0]||(c[0]=w=>ve($)?$.value=w:null),"show-file-list":!1,customRequest:n(M),onBeforeUpload:n(j)},{default:e(()=>[t(C,null,{default:e(()=>[v.ajax?ge("",!0):(b(),E(U,{key:0,class:"sourceBtn-item",disabled:h.value},{icon:e(()=>[t(q,null,{default:e(()=>[t(n(f))]),_:1})]),default:e(()=>[We]),_:1},8,["disabled"]))]),_:1})]),_:1},8,["file-list","customRequest","onBeforeUpload"]),r("div",null,[t(U,{class:"sourceBtn-item",disabled:h.value,onClick:n(O)},{icon:e(()=>[t(q,null,{default:e(()=>[t(n(g))]),_:1})]),default:e(()=>[Ye]),_:1},8,["disabled","onClick"]),t(k,{trigger:"hover"},{trigger:e(()=>[t(q,{class:"go-ml-1",size:"21",depth:3},{default:e(()=>[t(n(R))]),_:1})]),default:e(()=>[t(u,{depth:"3"},{default:e(()=>[Ze]),_:1})]),_:1})])]),_:1}),t(ce,{size:"small"},{default:e(()=>[t(le,{code:n(B)(s.value),language:"json"},null,8,["code"])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1})}}});const _t=ae(et,[["__scopeId","data-v-f6d90859"]]);export{_t as C};
