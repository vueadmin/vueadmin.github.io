var _=(w,C,s)=>new Promise((F,i)=>{var t=u=>{try{c(s.next(u))}catch(e){i(e)}},p=u=>{try{c(s.throw(u))}catch(e){i(e)}},c=u=>u.done?F(u.value):Promise.resolve(u.value).then(t,p);c((s=s.apply(w,C)).next())});import{M as N}from"./EditorWorker-5fae4ca7.js";import"./editorWorker-09f50f3f.js";import{c as T,d as $,l as I,az as g,aA as V,S as P,aB as v,e as M,g as n,w as o,aw as J,aC as L,r as a,o as f,q as R,u as l,B as y,a3 as D,h as m}from"./index-c9dad8bf.js";import{g as z}from"./storage-3ddc89e2.js";import{g as S}from"./plugin-1eef16fd.js";import{i as j}from"./icon-15886a8d.js";import"./chartEditStore-0e5a0895.js";const G={class:"go-edit"},H=m("页面在线编辑器"),K=m(" 导入 "),q=m(" 「Ctrl + S 更新视图」 "),U=m(" 保存 "),Q=$({__name:"index",setup(w){const{ChevronBackOutlineIcon:C,DownloadIcon:s,AnalyticsIcon:F}=j.ionicons5,i=window.showOpenFilePicker,t=I("");window.$message.warning("请不要刷新此窗口！");function p(){return _(this,null,function*(){const e=yield z();J(`编辑-${e.editCanvasConfig.projectName}`),t.value=v(e)})}setTimeout(p);function c(){S({message:"导入数据将覆盖内容，此操作不可撤回，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>_(this,null,function*(){try{const d=yield(yield i())[0].getFile(),r=new FileReader;r.readAsText(d),r.onloadend=()=>{t.value=(r.result||"").toString()},window.$message.success("导入成功！")}catch(e){window.$message.error("导入失败，请检查文件是否损坏！"),console.log(e)}})})}window.opener.addEventListener(g.CHART,e=>{window.$message.success("正在进行更新..."),V(P.GO_CHART_STORAGE_LIST,[e.detail]),t.value=v(e.detail)}),document.addEventListener("keydown",function(e){e.keyCode==83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),u())});function u(){return _(this,null,function*(){if(!window.opener)return window.$message.error("源窗口已关闭，视图同步失败！");S({message:"是否覆盖源视图内容? 此操作不可撤！",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{try{const e=L(t.value);delete e.id,window.opener.dispatchEvent(new CustomEvent(g.JSON,{detail:e})),window.$message.success("正在同步内容...")}catch(e){window.$message.error("内容格式有误"),console.log(e)}}})})}return window.onbeforeunload=()=>{window.opener&&window.opener.dispatchEvent(new CustomEvent(g.CLOSE))},(e,d)=>{const r=a("n-text"),B=a("n-icon"),E=a("n-button"),h=a("n-tag"),k=a("n-space"),x=a("n-layout-header"),b=a("n-layout-content"),O=a("n-layout");return f(),M("div",G,[n(O,null,{default:o(()=>[n(x,{class:"go-edit-header go-px-5 go-flex-items-center",bordered:""},{default:o(()=>[R("div",null,[n(r,{class:"go-edit-title go-mr-4"},{default:o(()=>[H]),_:1}),l(i)?(f(),y(E,{key:0,class:"go-mr-3",size:"medium",onClick:c},{icon:o(()=>[n(B,null,{default:o(()=>[n(l(s))]),_:1})]),default:o(()=>[K]),_:1})):D("",!0)]),n(k,null,{default:o(()=>[n(h,{bordered:!1,type:"warning"},{default:o(()=>[q]),_:1}),l(i)?(f(),y(E,{key:0,class:"go-mr-3",size:"medium",onClick:u},{icon:o(()=>[n(B,null,{default:o(()=>[n(l(F))]),_:1})]),default:o(()=>[U]),_:1})):D("",!0)]),_:1})]),_:1}),n(b,null,{default:o(()=>[n(l(N),{modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=A=>t.value=A),language:"json",editorOptions:{lineNumbers:"on",minimap:{enabled:!0}}},null,8,["modelValue"])]),_:1})]),_:1})])}}}),te=T(Q,[["__scopeId","data-v-fb30eb60"]]);export{te as default};
