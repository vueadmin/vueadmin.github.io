var me=Object.defineProperty,fe=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var ue=(u,d,r)=>d in u?me(u,d,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[d]=r,J=(u,d)=>{for(var r in d||(d={}))he.call(d,r)&&ue(u,r,d[r]);if(oe)for(var r of oe(d))ve.call(d,r)&&ue(u,r,d[r]);return u},Q=(u,d)=>fe(u,ge(d));var se=(u,d,r)=>new Promise((v,F)=>{var D=l=>{try{p(r.next(l))}catch(E){F(E)}},_=l=>{try{p(r.throw(l))}catch(E){F(E)}},p=l=>l.done?v(l.value):Promise.resolve(l.value).then(D,_);p((r=r.apply(u,d)).next())});import{c as V,d as L,l as k,L as X,r as o,o as i,B as A,w as a,g as e,e as x,q as g,u as t,h,b0 as ie,m as _e,Z as K,a0 as G,a3 as te,F as Y,s as ae,ag as le,t as z,z as Fe,A as De,p as Ee,cI as U,aH as W,cH as de,aI as M,al as be,M as Ce,aE as ce,aj as Z,cl as ye,co as Be,bd as qe}from"./index-db98ece3.js";import{i as ee}from"./icon-fb380718.js";import{c as xe}from"./http-8bb7445e.js";/* empty css                                                                   */import{S as R}from"./SettingItemBox-42414ad4.js";import{r as we}from"./chartEditStore-773be825.js";import{n as Pe}from"./noData-9e194391.js";import{u as ne}from"./useTargetData.hook-507ced02.js";import{g as pe}from"./plugin-54402248.js";import"./index-f28d946e.js";import{R as Ie,a as $e}from"./pondIndex.vue_vue_type_style_index_0_scoped_true_lang-dd10eaba.js";import"./EditorWorker-fd7db490.js";import"./editorWorker-09f50f3f.js";import{S as j}from"./SettingItem-34f55708.js";import{l as ke}from"./lodash-9426ef50.js";import{C as Se}from"./index-6c2599b1.js";import"./components-a3cd2bb7.js";import"./fileTypeEnum-21359a08.js";import"./file-84751f49.js";const Ae={class:"go-pr-3"},Re=h("名称："),He={key:1},Oe=h("取消"),Te=h("保存"),Ue=L({__name:"pondIndex",props:{modelShow:Boolean,targetDataRequest:Object},emits:["update:modelShow","editSaveHandle"],setup(u,{emit:d}){const r=u;k();const v=k(),F=k(!1);X(()=>r.modelShow,p=>{F.value=p});const D=()=>{d("update:modelShow",!1)},_=()=>{var p,l;if(!((p=r.targetDataRequest)!=null&&p.dataPondName)){window.$message.warning("请在左下角输入名称！"),(l=v.value)==null||l.focus();return}pe({message:"保存内容将同步修改所有使用此接口的组件, 是否继续?",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{d("update:modelShow",!1),d("editSaveHandle",r.targetDataRequest)}})};return(p,l)=>{const E=o("n-space"),B=o("n-scrollbar"),m=o("n-tag"),b=o("n-input"),C=o("n-button"),w=o("n-card"),S=o("n-modal");return i(),A(S,{class:"go-chart-data-request",show:F.value,"onUpdate:show":l[1]||(l[1]=y=>F.value=y),"mask-closable":!1,closeOnEsc:!1},{default:a(()=>[e(w,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:a(()=>[]),"header-extra":a(()=>[]),action:a(()=>[e(E,{justify:"space-between"},{default:a(()=>[u.targetDataRequest?(i(),A(E,{key:0},{default:a(()=>[e(m,{bordered:!1,type:"primary"},{default:a(()=>[Re]),_:1}),e(b,{value:u.targetDataRequest.dataPondName,"onUpdate:value":l[0]||(l[0]=y=>u.targetDataRequest.dataPondName=y),ref_key:"inputInstRef",ref:v,type:"text",size:"small",autofocus:!0,clearable:!0,minlength:1,maxlength:16,placeholder:"请输入名称"},null,8,["value"])]),_:1})):(i(),x("span",He)),e(E,null,{default:a(()=>[e(C,{onClick:D},{default:a(()=>[Oe]),_:1}),e(C,{type:"primary",onClick:_},{default:a(()=>[Te]),_:1})]),_:1})]),_:1})]),default:a(()=>[e(B,{style:{"max-height":"718px"}},{default:a(()=>[g("div",Ae,[e(E,{vertical:""},{default:a(()=>{var y;return[e(t(Ie)),e(t($e),{"target-data-request":(y=u.targetDataRequest)==null?void 0:y.dataPondRequestConfig},null,8,["target-data-request"])]}),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),ze=V(Ue,[["__scopeId","data-v-bdedbc94"]]);const Ne=u=>(Fe("data-v-5b8bb209"),u=u(),De(),u),je={class:"go-chart-data-pond-list"},Le={class:"pond-item-box"},Me=Ne(()=>g("span",null," 创建 ",-1)),Ge=h(" 暂无数据内容， "),Ve=h("立即创建"),Ye=["onClick"],Je={class:"item-content"},Qe={class:"item-content-body"},We=h(" 名称 "),Xe=h(" 地址 "),Ze=["onClick"],Ke=L({__name:"index",emits:["createPond","deletePond"],setup(u,{emit:d}){ie(C=>({d0020240:t(E)}));const{DuplicateOutlineIcon:r,TrashIcon:v}=ee.ionicons5,F=_e(),{chartEditStore:D,targetData:_}=ne(),{requestDataPond:p}=K(D.getRequestGlobalConfig),l=G(()=>_.value.request.requestDataPondId),E=G(()=>F.getAppTheme),B=()=>{d("createPond",!0)},m=(C,w)=>{C.stopPropagation(),C.preventDefault(),d("deletePond",w)},b=C=>{_.value.request.requestDataPondId=C.dataPondId};return(C,w)=>{const S=o("n-timeline-item"),y=o("n-timeline"),q=o("n-icon"),O=o("n-button"),H=o("n-divider"),n=o("n-a"),s=o("n-text"),f=o("n-space"),I=o("n-tag"),P=o("n-ellipsis"),T=o("n-scrollbar");return i(),x("div",je,[e(y,{class:"pond-item-timeline",style:{width:"20px"}},{default:a(()=>[e(S,{type:"info"}),e(S,{type:"success"})]),_:1}),g("div",Le,[e(O,{class:"create-btn go-py-4",ghost:"",onClick:B},{icon:a(()=>[e(q,null,{default:a(()=>[e(t(r))]),_:1})]),default:a(()=>[Me]),_:1}),e(H,{style:{margin:"10px 0"}}),t(p).length?te("",!0):(i(),A(f,{key:0,justify:"center"},{default:a(()=>[e(s,{class:"not-layer-text",depth:3},{default:a(()=>[Ge,e(n,{onClick:B},{default:a(()=>[Ve]),_:1})]),_:1})]),_:1})),e(T,{style:{"max-height":"490px"}},{default:a(()=>[(i(!0),x(Y,null,ae(t(p),c=>(i(),x("div",{key:c.dataPondId,class:le([{select:c.dataPondId===t(l)},"pond-item"]),onClick:N=>b(c)},[g("div",Je,[g("div",Qe,[g("div",null,[e(I,{class:"go-mr-1",type:c.dataPondId===t(l)?"warning":"",bordered:!1},{default:a(()=>[We]),_:2},1032,["type"]),e(P,{style:{"max-width":"180px"}},{default:a(()=>[h(z(c.dataPondName||"暂无"),1)]),_:2},1024)]),g("div",null,[e(I,{class:"go-mr-1",type:c.dataPondId===t(l)?"warning":"",bordered:!1},{default:a(()=>[Xe]),_:2},1032,["type"]),e(P,{style:{"max-width":"180px"}},{default:a(()=>[h(z(c.dataPondRequestConfig.requestUrl||"暂无"),1)]),_:2},1024)])]),g("div",{class:"item-content-icon go-transition-quick",onClick:N=>m(N,c)},[e(q,null,{default:a(()=>[e(t(v))]),_:1})],8,Ze)]),g("div",{class:le({"select-modal":c.dataPondId===t(l)})},null,2)],10,Ye))),128))]),_:1})])])}}}),et=V(Ke,[["__scopeId","data-v-5b8bb209"]]),tt=g("thead",null,[g("tr",null,[g("th",null,"key"),g("th",null,"value")])],-1),re=L({__name:"displayTable",props:{target:Object},setup(u){const d=u,r={key:"",value:""},v=Ee({content:[]});return X(()=>d.target,F=>{v.content=[];for(const D in F)v.content.push({key:D,value:F[D]});v.content.length||(v.content=[JSON.parse(JSON.stringify(r))])},{immediate:!0,deep:!0}),(F,D)=>{const _=o("n-table");return i(),A(_,{bordered:!1,"single-line":!1,size:"small",style:{"border-bottom-right-radius":"7px","border-bottom-left-radius":"7px"}},{default:a(()=>[tt,g("tbody",null,[(i(!0),x(Y,null,ae(v.content,(p,l)=>(i(),x("tr",{key:l},[g("td",null,z(p.key||"暂无"),1),g("td",null,z(p.value||"暂无"),1)]))),128))])]),_:1})}}});const at={class:"go-chart-data-display"},nt={class:"go-mr-3"},ot={key:0},ut={class:"go-mt-3"},st={key:0},lt={key:1},dt=h("该接口没有 Body 体"),ct={key:1},rt=h("sql"),it=L({__name:"index",props:{globalData:Object,targetData:Object},setup(u){const d=u,{HelpOutlineIcon:r,FlashIcon:v,PulseIcon:F}=ee.ionicons5,{requestUrl:D,requestInterval:_,requestHttpType:p,requestContentType:l,requestSQLContent:E,requestParams:B,requestParamsBodyType:m,requestIntervalUnit:b}=K(d.targetData.dataPondRequestConfig);U.HEADER;const C={[W.DEFAULT]:"普通请求",[W.SQL]:"SQL 请求"},w=k(U.PARAMS);return(S,y)=>{const q=o("n-input"),O=o("n-icon"),H=o("n-divider"),n=o("n-tab"),s=o("n-tabs"),f=o("n-text"),I=o("n-card"),P=o("n-code"),T=o("n-scrollbar");return i(),x("div",at,[e(T,{style:{"max-height":"570px"}},{default:a(()=>[g("div",nt,[g("div",null,[e(t(R),{name:"主体信息"},{default:a(()=>[e(t(j),{name:"接口名称"},{default:a(()=>{var c;return[e(q,{size:"small",placeholder:((c=u.targetData)==null?void 0:c.dataPondName)||"暂无",disabled:!0},null,8,["placeholder"])]}),_:1}),e(t(j),{name:"接口类型"},{default:a(()=>[e(q,{size:"small",placeholder:t(p)||"暂无",disabled:!0},null,8,["placeholder"])]),_:1})]),_:1}),e(t(R),null,{default:a(()=>[e(t(j),{name:"组件间隔"},{default:a(()=>[e(q,{size:"small",placeholder:`${t(_)||"暂无"}`,disabled:!0},{suffix:a(()=>[h(z(u.targetData&&t(de)[t(b)]),1)]),_:1},8,["placeholder"])]),_:1}),e(t(j),{name:"全局间隔（默认）"},{default:a(()=>{var c;return[e(q,{size:"small",placeholder:`${((c=u.globalData)==null?void 0:c.requestInterval)||"暂无"}`,disabled:!0},{suffix:a(()=>[h(z(u.globalData&&t(de)[u.globalData.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]}),_:1})]),_:1}),e(t(R),{name:"源地址",alone:!0},{default:a(()=>{var c;return[e(q,{size:"small",placeholder:((c=u.globalData)==null?void 0:c.requestOriginUrl)||"暂无",disabled:!0},{prefix:a(()=>[e(O,{component:t(F)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(t(R),{name:"接口地址",alone:!0},{default:a(()=>[e(q,{size:"small",placeholder:t(D)||"暂无",disabled:!0},{prefix:a(()=>[e(O,{component:t(v)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1})]),e(H),e(t(R),{name:"类型"},{default:a(()=>[e(t(j),{name:"配置类型"},{default:a(()=>[e(q,{size:"small",placeholder:u.targetData&&C[t(l)],disabled:!0},null,8,["placeholder"])]),_:1}),t(l)===t(W).DEFAULT?(i(),A(t(j),{key:0,name:"body 类型"},{default:a(()=>[e(q,{size:"small",placeholder:u.targetData&&t(m),disabled:!0},null,8,["placeholder"])]),_:1})):te("",!0)]),_:1}),t(l)===t(W).DEFAULT?(i(),x("div",ot,[e(s,{type:"line",animated:"",value:w.value,"onUpdate:value":y[0]||(y[0]=c=>w.value=c)},{default:a(()=>[(i(!0),x(Y,null,ae(t(U),c=>(i(),A(n,{key:c,name:c,tab:c},{default:a(()=>[h(z(c),1)]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),g("div",ut,[w.value!==t(U).BODY?(i(),x("div",st,[e(re,{class:"go-my-3",target:t(B)[w.value]},null,8,["target"])])):(i(),x("div",lt,[t(m)===t(M).NONE?(i(),A(I,{key:0,class:"go-mt-3 go-pb-3"},{default:a(()=>[e(f,{depth:"3"},{default:a(()=>[dt]),_:1})]),_:1})):t(m)===t(M).FORM_DATA||t(m)===t(M).X_WWW_FORM_URLENCODED?(i(),A(re,{key:1,class:"go-my-3",target:t(B)[t(U).BODY][t(m)]},null,8,["target"])):t(m)===t(M).JSON?(i(),A(I,{key:2,size:"small",style:{"padding-bottom":"7px"}},{default:a(()=>[e(P,{code:t(B)[t(U).BODY][t(m)]||"暂无内容",language:"json"},null,8,["code"])]),_:1})):t(m)===t(M).XML?(i(),A(P,{key:3,code:t(B)[t(U).BODY][t(m)]||"",language:"html"},null,8,["code"])):te("",!0)]))])])):(i(),x("div",ct,[e(t(R),{name:"键名"},{default:a(()=>[e(f,null,{default:a(()=>[rt]),_:1})]),_:1}),e(t(R),{name:"键值"},{default:a(()=>[e(P,{code:t(E).sql||"",language:"sql"},null,8,["code"])]),_:1})]))])]),_:1})])}}}),_t=V(it,[["__scopeId","data-v-9f32ef20"]]);const pt={class:"pond-content"},mt={key:1,class:"no-data go-flex-center"},ft=["src"],gt=h("暂未选择公共接口"),ht=h(" 编辑内容 "),vt=h("保存 & 发送请求"),Ft=L({__name:"index",props:{modelShow:Boolean},emits:["update:modelShow","sendHandle"],setup(u,{emit:d}){const r=u,{PencilIcon:v}=ee.ionicons5,{chartEditStore:F,targetData:D}=ne(),{requestDataPond:_}=K(F.getRequestGlobalConfig),p=k(!1),l=k(!1),E=k(!1),B=k(!1),m=k(),b=G(()=>{var f,I;const n=(I=(f=D==null?void 0:D.value)==null?void 0:f.request)==null?void 0:I.requestDataPondId;return n?_.value.filter(P=>n===P.dataPondId)[0]:void 0});X(()=>r.modelShow,n=>{l.value=n}),X(()=>b.value,n=>{E.value=!0,m.value=n,be(()=>{E.value=!1})},{immediate:!0});const C=(n=!1)=>{B.value=!!n,p.value=!0},w=()=>{const n=Ce();m.value={dataPondId:n,dataPondName:n,dataPondRequestConfig:ke.cloneDeep(Q(J({},we),{requestDataType:ce.Pond}))},C()},S=n=>{B.value?y(n):q(n),B.value=!1,p.value=!1},y=n=>{try{const s=_.value.findIndex(f=>f.dataPondId===n.dataPondId);s!==-1?(_.value.splice(s,1,n),F.getComponentList.forEach(f=>{f.request.requestDataType===ce.Pond&&f.request.requestDataPondId===n.dataPondId&&(f.request=Q(J({},Z(n.dataPondRequestConfig)),{requestDataPondId:n.dataPondId}))}),window.$message.success("保存成功！")):window.$message.error("编辑失败，请稍后重试！")}catch(s){window.$message.error("编辑失败，请稍后重试！")}},q=n=>{try{m.value?(_.value.unshift(n),window.$message.success("创建成功!")):window.$message.error("创建失败，请稍后重试!")}catch(s){window.$message.error("创建失败，请稍后重试!")}},O=n=>{pe({message:"删除数据后，需手动处理使用改接口的组件，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{const s=_.value.findIndex(f=>f.dataPondId===n.dataPondId);s!==-1?(_.value.splice(s,1),window.$message.success("删除成功!")):window.$message.error("删除失败，请稍后重试！")}})},H=()=>{b.value&&(D.value.request=Q(J({},Z(b.value.dataPondRequestConfig)),{requestDataPondId:b.value.dataPondId})),d("update:modelShow",!1),d("sendHandle")};return(n,s)=>{const f=o("n-text"),I=o("n-icon"),P=o("n-button"),T=o("n-space"),c=o("n-card"),N=o("n-modal");return i(),x(Y,null,[e(N,{class:"go-chart-data-pond-control",show:l.value,"onUpdate:show":s[1]||(s[1]=$=>l.value=$),"mask-closable":!1},{default:a(()=>[e(c,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"900px",height:"650px"}},{header:a(()=>[]),"header-extra":a(()=>[]),action:a(()=>[e(T,{justify:"space-between"},{default:a(()=>[e(P,{type:"info",secondary:"",disabled:!t(b),onClick:s[0]||(s[0]=$=>C(!0))},{icon:a(()=>[e(I,null,{default:a(()=>[e(t(v))]),_:1})]),default:a(()=>[ht]),_:1},8,["disabled"]),e(P,{type:"primary",onClick:H},{default:a(()=>[vt]),_:1})]),_:1})]),default:a(()=>[g("div",pt,[t(b)&&!E.value?(i(),A(t(_t),{key:0,targetData:t(b),globalData:t(F).getRequestGlobalConfig},null,8,["targetData","globalData"])):(i(),x("div",mt,[g("img",{src:t(Pe),alt:"暂无数据"},null,8,ft),e(f,{depth:3},{default:a(()=>[gt]),_:1})])),e(t(et),{onCreatePond:w,onDeletePond:O})])]),_:1})]),_:1},8,["show"]),e(t(ze),{modelShow:p.value,"onUpdate:modelShow":s[2]||(s[2]=$=>p.value=$),targetDataRequest:m.value,isEdit:B.value,onEditSaveHandle:S},null,8,["modelShow","targetDataRequest","isEdit"])],64)}}}),Dt=V(Ft,[["__scopeId","data-v-aadb3f02"]]);const Et={class:"go-chart-data-pond"},bt={class:"go-absolute-center"},Ct=h("编辑配置"),yt=h(" 测试 "),Bt=h(" 默认赋值给 dataset 字段 "),qt=h(" 发送请求 "),xt=L({__name:"index",setup(u){ie(n=>({"2b640308":t(q)}));const d=_e(),{HelpOutlineIcon:r,FlashIcon:v,PulseIcon:F,FishIcon:D}=ee.ionicons5,{targetData:_,chartEditStore:p}=ne(),{requestDataPond:l,requestInterval:E,requestIntervalUnit:B}=K(p.getRequestGlobalConfig),m=k(!1),b=k(!1),C=k(!1);let w=0,S;const y=G(()=>{const n=_.value.request.requestDataPondId;return n?l.value.filter(f=>n===f.dataPondId)[0]:void 0}),q=G(()=>d.getAppTheme),O=()=>{b.value=!0},H=()=>se(this,null,function*(){var n;if(!((n=_.value)!=null&&n.request)){window.$message.warning("请选择一个公共接口！");return}m.value=!0;try{const s=yield xe(Z(_.value.request),Z(p.getRequestGlobalConfig));if(m.value=!1,s){!(s!=null&&s.data)&&!_.value.filter&&window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),_.value.option.dataset=qe(s==null?void 0:s.data,s,_.value.filter),C.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(s){console.error(s),m.value=!1,window.$message.warning("数据异常，请检查参数！")}});return ye(()=>{var s;const n=(s=_.value)==null?void 0:s.filter;S!==n&&w&&(S=n,H()),w++}),Be(()=>{S=null}),(n,s)=>{const f=o("n-icon"),I=o("n-input"),P=o("n-button"),T=o("n-card"),c=o("n-tooltip"),N=o("go-skeleton");return i(),x(Y,null,[g("div",Et,[e(T,{class:"n-card-shallow"},{default:a(()=>[e(t(R),{name:"请求名称",alone:!0},{default:a(()=>{var $;return[e(I,{size:"small",placeholder:(($=t(y))==null?void 0:$.dataPondName)||"暂无",disabled:!0},{prefix:a(()=>[e(f,{component:t(D)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(t(R),{name:"接口地址",alone:!0},{default:a(()=>{var $;return[e(I,{size:"small",placeholder:(($=t(y))==null?void 0:$.dataPondRequestConfig.requestUrl)||"暂无",disabled:!0},{prefix:a(()=>[e(f,{component:t(v)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),g("div",{class:"edit-text",onClick:O},[g("div",bt,[e(P,{type:"primary",secondary:""},{default:a(()=>[Ct]),_:1})])])]),_:1})]),e(t(R),{alone:!0},{name:a(()=>[yt,e(c,{trigger:"hover"},{trigger:a(()=>[e(f,{size:"21",depth:3},{default:a(()=>[e(t(r))]),_:1})]),default:a(()=>[Bt]),_:1})]),default:a(()=>[e(P,{type:"primary",ghost:"",onClick:H},{icon:a(()=>[e(f,null,{default:a(()=>[e(t(v))]),_:1})]),default:a(()=>[qt]),_:1})]),_:1}),e(t(Se),{show:C.value&&!m.value,ajax:!0},null,8,["show"]),e(N,{load:m.value,repeat:3},null,8,["load"]),e(t(Dt),{modelShow:b.value,"onUpdate:modelShow":s[0]||(s[0]=$=>b.value=$),onSendHandle:H},null,8,["modelShow"])],64)}}}),Jt=V(xt,[["__scopeId","data-v-28fb2afa"]]);export{Jt as default};
